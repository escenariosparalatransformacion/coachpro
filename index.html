<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COACH PRO Portal - AI Negotiation Challenge Malta</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary-color: #1e3a8a; /* Dark Blue */
            --secondary-color: #dc2626; /* Red */
            --accent-color: #f59e0b; /* Amber */
            --success-color: #10b981; /* Green */
            --warning-color: #f59e0b; /* Amber */
            --danger-color: #ef4444; /* Lighter Red */
            --bg-dark: #0f172a; /* Very Dark Blue */
            --bg-medium: #1e293b; /* Dark Slate Blue */
            --bg-light: #f8fafc; /* Almost White */
            --text-dark: #0f172a;
            --text-light: #f8fafc;
            --border-color: #e2e8f0; /* Light Gray */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --tunisia-red: #e70013;
            --senegal-green: #00853f;
            --senegal-yellow: #fdef42;
            --senegal-red-flag: #e70013; /* Senegal flag also has red */
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.95); /* Slightly more opaque */
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.7s ease-in-out;
        }
        .loading-content {
            text-align: center;
            color: white;
        }
        .loader {
            width: 70px; /* Slightly larger */
            height: 70px;
            border: 5px solid rgba(255, 255, 255, 0.15);
            border-top-color: var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .top-bar {
            background: var(--bg-dark);
            color: white;
            padding: 12px 0; /* Slightly more padding */
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1002;
            box-shadow: var(--shadow-md); /* Consistent shadow naming */
        }
        .top-bar-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 25px; /* Consistent padding */
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }
        .notification-badge {
            background: var(--danger-color);
            color: white;
            padding: 3px 9px; /* Slightly larger */
            border-radius: 12px;
            font-size: 0.8rem; /* Slightly larger */
            font-weight: bold;
            animation: pulse 2s infinite ease-in-out;
        }
        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, #2563eb 50%, var(--secondary-color) 100%);
            color: var(--text-light);
            padding: 45px 0; /* Slightly more padding */
            margin-top: 55px; /* Adjusted for fixed top-bar height */
            position: relative;
            overflow: hidden;
        }
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.08) 0%, transparent 65%); /* Subtle effect */
            animation: float 25s linear infinite;
        }
        @keyframes float {
            to { transform: translate(50%, 50%) rotate(360deg); }
        }
        .header-content {
            position: relative;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 25px; /* Consistent padding */
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 40px;
            align-items: center;
        }
        .header-title h1 {
            font-size: 3rem; /* Slightly larger */
            font-weight: 800;
            margin-bottom: 12px;
            text-shadow: 2px 2px 5px rgba(0,0,0,0.35);
            letter-spacing: -0.02em;
        }
        .header-title .subtitle {
            font-size: 1.2rem; /* Slightly larger */
            opacity: 0.95;
            margin-bottom: 8px;
        }
        .delegation-selector {
            background: rgba(255,255,255,0.1); /* More subtle */
            backdrop-filter: blur(12px);
            border-radius: 18px; /* Smoother radius */
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.15);
            box-shadow: var(--shadow-lg);
        }
        .delegation-buttons {
            display: flex;
            gap: 18px; /* More spacing */
            margin-bottom: 18px;
        }
        .delegation-btn {
            padding: 14px 28px; /* Larger buttons */
            border: 2px solid rgba(255,255,255,0.25);
            background: rgba(255,255,255,0.08);
            color: white;
            border-radius: 14px; /* Smoother radius */
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }
        .delegation-btn:hover {
            transform: translateY(-3px) scale(1.03); /* More pronounced hover */
            box-shadow: 0 6px 20px rgba(0,0,0,0.35);
            border-color: rgba(255,255,255,0.5);
        }
        .delegation-btn.active {
            background: white;
            color: var(--primary-color);
            border-color: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .delegation-btn.tunisia.active {
            background: var(--tunisia-red);
            color: white;
            border-color: var(--tunisia-red);
        }
        .delegation-btn.senegal.active {
            background: var(--senegal-green);
            color: white;
            border-color: var(--senegal-green);
        }
        .flag-icon {
            width: 28px; /* Larger flag */
            height: 18px;
            border-radius: 3px;
            object-fit: cover;
            box-shadow: var(--shadow-sm);
        }
        .time-display {
            background: rgba(255,255,255,0.12); /* More subtle */
            backdrop-filter: blur(8px);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.18);
        }
        .time-zones {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        .time-zone {
            text-align: center;
        }
        .time-zone h3 {
            font-size: 0.95rem; /* Slightly larger */
            margin-bottom: 6px;
            opacity: 0.9;
        }
        .time-zone .time {
            font-size: 2.2rem; /* Larger time */
            font-weight: bold;
            font-variant-numeric: tabular-nums;
            font-family: 'SF Mono', Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
        }
        .time-zone .date {
            font-size: 0.9rem; /* Slightly larger */
            opacity: 0.85;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 25px; /* Consistent padding */
        }
        .dashboard-grid {
            display: grid;
            grid-template-columns: 260px 1fr; /* Slightly wider sidebar */
            gap: 25px;
            margin-top: 25px;
        }
        .sidebar {
            background: white;
            border-radius: 18px;
            padding: 25px;
            box-shadow: var(--shadow);
            position: sticky;
            top: 80px; /* Account for taller top-bar and some margin */
            height: fit-content;
            max-height: calc(100vh - 105px); /* Adjust for top-bar and padding */
            overflow-y: auto;
        }
        .nav-section {
            margin-bottom: 28px;
        }
        .nav-section-title {
            font-size: 0.8rem; /* Slightly larger */
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: #64748b; /* Slate Gray */
            margin-bottom: 12px;
            padding-left: 5px;
        }
        .nav-item {
            display: flex;
            align-items: center;
            gap: 14px; /* More gap */
            padding: 12px 15px; /* More padding */
            margin-bottom: 5px;
            border-radius: 10px; /* Smoother radius */
            cursor: pointer;
            transition: all 0.25s ease;
            font-weight: 500;
            color: var(--text-dark);
            text-decoration: none;
            position: relative;
        }
        .nav-item:hover {
            background: #eef2ff; /* Indigo light */
            transform: translateX(5px);
            color: var(--primary-color);
        }
        .nav-item.active {
            background: var(--primary-color);
            color: white;
            box-shadow: var(--shadow-sm);
        }
        .nav-item .icon {
            width: 22px; /* Larger icon */
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        .nav-item .badge {
            margin-left: auto;
            background: var(--danger-color);
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: bold;
        }
        .main-content {
            background: white;
            border-radius: 18px;
            padding: 35px; /* More padding */
            box-shadow: var(--shadow);
            min-height: 650px; /* Increased min-height */
        }
        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 35px;
            padding-bottom: 25px;
            border-bottom: 2px solid var(--border-color);
        }
        .content-title {
            font-size: 2.2rem; /* Larger title */
            font-weight: 700;
            color: var(--text-dark);
        }
        .content-actions {
            display: flex;
            gap: 12px;
        }
        .btn {
            padding: 12px 22px; /* Larger buttons */
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            box-shadow: var(--shadow-sm);
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        .btn-primary {
            background: var(--primary-color);
            color: white;
        }
        .btn-primary:hover {
            background: #1e40af; /* Darker shade of primary */
        }
        .btn-secondary {
            background: var(--bg-light);
            color: var(--text-dark);
            border: 1px solid var(--border-color);
        }
        .btn-secondary:hover {
            background: #e2e8f0; /* Darker bg-light */
            border-color: #cbd5e1;
        }
        .btn-success {
            background: var(--success-color);
            color: white;
        }
        .btn-success:hover {
            background: #059669; /* Darker success */
        }
        .btn-danger {
            background: var(--danger-color);
            color: white;
        }
        .btn-danger:hover {
            background: #c53030; /* Darker danger */
        }
        .tab-content {
            display: none;
            animation: fadeIn 0.6s ease-out; /* Smoother fade */
        }
        .tab-content.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }
        .alert {
            padding: 18px 22px; /* More padding */
            border-radius: 14px; /* Smoother radius */
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 500;
            border-left-width: 5px; /* Accent border */
            border-left-style: solid;
        }
        .alert-icon {
            font-size: 1.5rem; /* Larger icon */
            width: 28px;
            height: 28px;
            flex-shrink: 0;
        }
        .alert-warning {
            background: #fffbeb; /* Lighter yellow */
            border-color: #fde68a;
            border-left-color: var(--warning-color);
            color: #92400e; /* Dark Amber text */
        }
        .alert-danger {
            background: #fff1f2; /* Lighter red */
            border-color: #fecaca;
            border-left-color: var(--danger-color);
            color: #991b1b; /* Dark Red text */
        }
        .alert-success {
            background: #f0fdf4; /* Lighter green */
            border-color: #a7f3d0;
            border-left-color: var(--success-color);
            color: #065f46; /* Dark Green text */
        }
        .alert-info {
            background: #eff6ff; /* Lighter blue */
            border-color: #bfdbfe;
            border-left-color: var(--primary-color);
            color: #1e40af; /* Dark Blue text */
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); /* Slightly larger minmax */
            gap: 25px;
            margin-bottom: 35px;
        }
        .stat-card {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 14px;
            padding: 25px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }
        .stat-card::before { /* Using left border for accent */
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px; /* Thicker accent */
            height: 100%;
            background: var(--primary-color);
            transition: width 0.3s ease;
        }
        .stat-card:hover::before {
            width: 10px;
        }
        .stat-card.warning::before { background: var(--warning-color); }
        .stat-card.danger::before { background: var(--danger-color); }
        .stat-card.success::before { background: var(--success-color); }
        .stat-label {
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 10px;
            font-weight: 600;
        }
        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 10px;
        }
        .stat-detail {
            font-size: 0.9rem;
            color: #64748b;
        }
        .timeline {
            position: relative;
            padding-left: 45px; /* More space for icons */
            margin: 25px 0;
        }
        .timeline::before { /* Timeline vertical line */
            content: '';
            position: absolute;
            left: 15px; /* Adjusted for larger icons */
            top: 0;
            bottom: 0;
            width: 3px; /* Thicker line */
            background: var(--border-color);
            border-radius: 2px;
        }
        .timeline-item {
            position: relative;
            margin-bottom: 35px;
            padding: 25px;
            background: #f9fafb; /* Slightly off-white for items */
            border-radius: 14px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }
        .timeline-item:hover {
            transform: translateX(6px);
            box-shadow: var(--shadow);
            border-left-color: var(--accent-color); /* Highlight on hover */
            border-left-width: 4px;
        }
        .timeline-item::before { /* Timeline dot */
            content: '';
            position: absolute;
            left: -37px; /* Adjusted for new left padding */
            top: 28px; /* Centered better */
            width: 24px; /* Larger dot */
            height: 24px;
            background: white;
            border: 4px solid var(--border-color); /* Thicker border */
            border-radius: 50%;
            transition: all 0.3s ease;
            z-index: 1;
        }
        .timeline-item.active::before {
            background: var(--accent-color);
            border-color: var(--accent-color);
            box-shadow: 0 0 0 5px rgba(245, 158, 11, 0.25);
            animation: pulseDot 1.5s infinite;
        }
         @keyframes pulseDot {
            0% { box-shadow: 0 0 0 0px rgba(245, 158, 11, 0.3); }
            70% { box-shadow: 0 0 0 10px rgba(245, 158, 11, 0); }
            100% { box-shadow: 0 0 0 0px rgba(245, 158, 11, 0); }
        }
        .timeline-item.completed::before {
            background: var(--success-color);
            border-color: var(--success-color);
        }
        .timeline-item.upcoming::before {
            background: #e2e8f0;
            border-color: #cbd5e1;
        }
        .timeline-item.manual-progress::before { background: #60a5fa; border-color: #60a5fa; } /* Light blue for manual in-progress */
        .timeline-item.manual-upcoming::before { background: #a78bfa; border-color: #a78bfa; } /* Purple for manual upcoming */


        .time-label {
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap; /* Allow wrapping for status editor */
        }
        .time-label .status, .status-indicator {
            font-size: 0.9rem;
            padding: 5px 14px;
            border-radius: 20px;
            font-weight: 600;
        }
        .status-active, .status-indicator.active { background: var(--accent-color); color: white; }
        .status-completed, .status-indicator.completed { background: var(--success-color); color: white; }
        .status-upcoming, .status-indicator.upcoming { background: #e2e8f0; color: #64748b; }
        .status-urgent, .status-indicator.urgent { background: var(--danger-color); color: white; animation: pulseBg 1.5s infinite; }
        
        @keyframes pulseBg {
            0%, 100% { filter: brightness(100%); }
            50% { filter: brightness(120%); }
        }

        .activity-status-editor {
            margin-left: auto; /* Pushes to the right */
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.875rem;
        }
        .activity-status-editor label {
            font-weight: 500;
            color: #475569; /* Slate gray */
        }
        .activity-status-editor select {
            padding: 6px 10px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background-color: white;
            font-weight: 500;
            cursor: pointer;
            transition: border-color 0.2s;
        }
        .activity-status-editor select:hover {
            border-color: var(--primary-color);
        }
        .activity-status-editor select:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        .key-takeaway-box {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 1px solid #93c5fd; /* Lighter blue border */
            border-left: 5px solid var(--primary-color);
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: var(--shadow-sm);
        }
        .key-takeaway-box h4 {
            color: var(--primary-color);
            margin-bottom: 18px;
            font-size: 1.25rem; /* Larger title */
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .key-takeaway-box ul {
            margin-left: 25px;
            color: #334155; /* Darker text for readability */
            list-style-type: disc; /* Standard disc */
        }
        .key-takeaway-box li {
            margin-bottom: 12px;
            line-height: 1.7; /* More spacing */
        }
        .key-takeaway-box .reference {
            font-size: 0.9rem;
            color: #64748b;
            margin-top: 18px;
            font-style: italic;
            text-align: right;
        }
        .key-takeaway-box .reference a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }
        .key-takeaway-box .reference a:hover {
            text-decoration: underline;
        }
        .highlight-important {
            background: #fef9c3; /* Light yellow highlight */
            padding: 3px 8px;
            border-radius: 5px;
            font-weight: 600;
            color: #713f12; /* Dark yellow text */
            border: 1px solid #fde047; /* Yellow border */
        }


        .delegation-card {
            background: white;
            border-radius: 18px;
            padding: 35px;
            box-shadow: var(--shadow);
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
        }
        .delegation-card::before { /* Top accent bar */
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 8px; /* Thicker bar */
        }
        .delegation-card.tunisia::before {
            background: linear-gradient(90deg, var(--tunisia-red) 70%, #f8fafc 70%);
        }
        .delegation-card.senegal::before {
            background: linear-gradient(90deg, var(--senegal-green) 33.33%, var(--senegal-yellow) 33.33% 66.66%, var(--senegal-red-flag) 66.66%);
        }
        .delegation-header {
            display: flex;
            align-items: center;
            gap: 25px;
            margin-bottom: 30px;
        }
        .delegation-flag {
            width: 90px; /* Larger flag */
            height: 60px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            object-fit: cover;
            border: 1px solid rgba(0,0,0,0.1);
        }
        .delegation-info h2 {
            font-size: 1.9rem; /* Larger title */
            font-weight: 700;
            margin-bottom: 8px;
        }
        .delegation-info p {
            color: #64748b;
            font-weight: 500;
            font-size: 1.05rem;
        }
        .round-section { /* General purpose section card */
            background: #f9fafb; /* Slightly off-white for sections within tabs */
            border-radius: 14px;
            padding: 30px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
        }
        .round-header { /* Header within a round-section */
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 18px;
            border-bottom: 2px solid var(--border-color);
        }
        .round-title {
            font-size: 1.6rem; /* Larger title */
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .round-number {
            background: var(--primary-color);
            color: white;
            width: 45px; /* Larger number circle */
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            box-shadow: var(--shadow-sm);
        }
        .deliverable-section {
            background: #f0f9ff; /* Light blue background for emphasis */
            border-radius: 10px;
            padding: 25px;
            margin-top: 25px;
            border: 1px solid #bee3f8; /* Blue border */
        }
        .deliverable-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
        }
        .deliverable-title {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 1.1rem;
        }
        .deliverable-status {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        .status-dot {
            width: 10px; /* Larger dot */
            height: 10px;
            border-radius: 50%;
            background: #cbd5e1; /* Default/Not Started */
        }
        .status-dot.completed { background: var(--success-color); }
        .status-dot.pending { background: var(--warning-color); }
        .status-dot.overdue { background: var(--danger-color); }
        .file-upload-area {
            border: 2px dashed #a0aec0; /* More prominent dash */
            border-radius: 10px;
            padding: 35px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: white;
            margin-top: 12px;
        }
        .file-upload-area:hover {
            border-color: var(--primary-color);
            background: #f0f9ff; /* Light blue on hover */
            transform: scale(1.01);
        }
        .file-upload-area.drag-over {
            border-color: var(--primary-color);
            background: #e0f2fe;
            transform: scale(1.02);
            box-shadow: var(--shadow-lg);
        }
        .file-upload-icon {
            width: 50px; /* Larger icon */
            height: 50px;
            margin: 0 auto 18px;
            color: #94a3b8;
            transition: color 0.3s;
        }
        .file-upload-area:hover .file-upload-icon {
            color: var(--primary-color);
        }
        .uploaded-files-container {
             margin-top: 18px;
        }
        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: var(--shadow-sm);
            transition: box-shadow 0.3s ease;
        }
        .file-item:hover {
            box-shadow: var(--shadow);
        }
        .file-info {
            display: flex;
            align-items: center;
            gap: 12px;
            overflow: hidden;
        }
        .file-info > div > div:first-child { /* File name */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 300px; /* Increased max width */
            font-weight: 500;
        }
        .file-icon {
            width: 36px; /* Larger icon */
            height: 36px;
            background: var(--bg-light);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            flex-shrink: 0;
            font-size: 1.2rem;
        }

        .resource-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); /* Larger minmax */
            gap: 25px;
            margin-top: 25px;
        }
        .resource-card { /* Re-styling for general purpose resource cards */
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 14px;
            padding: 25px;
            transition: all 0.3s ease;
            text-decoration: none;
            color: inherit;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-sm);
        }
        .resource-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-color);
        }
        .resource-icon { /* Icon for resource cards */
            width: 50px;
            height: 50px;
            background: var(--bg-light);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 18px;
            font-size: 1.8rem; /* Larger icon */
            flex-shrink: 0;
            color: var(--primary-color); /* Default icon color */
        }
        .resource-title {
            font-weight: 600;
            font-size: 1.15rem; /* Larger title */
            margin-bottom: 10px;
            color: var(--text-dark);
        }
        .resource-description {
            font-size: 0.9rem;
            color: #475569; /* Slate gray */
            line-height: 1.6;
            flex-grow: 1;
            margin-bottom: 15px;
        }
         .resource-link-area {
            margin-top: auto;
            padding-top: 18px;
            border-top: 1px solid var(--border-color); /* Separator */
        }

        .ai-assistant-box {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 1px solid #93c5fd; /* Light blue border */
            border-left: 5px solid #3b82f6; /* Deeper blue accent */
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: var(--shadow-sm);
        }
        .ai-assistant-box h5 {
            font-size: 1.1rem;
            color: #1e40af;
            margin-bottom: 15px;
        }
        .ai-prompt {
            background: #0f172a; /* Dark background for code/prompt */
            color: #e2e8f0; /* Light text on dark */
            padding: 18px 22px;
            border-radius: 10px;
            font-family: 'SF Mono', Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
            font-size: 0.95rem;
            line-height: 1.7;
            margin: 18px 0;
            position: relative;
            overflow-x: auto;
            border: 1px solid #334155; /* Subtle border */
        }
        .ai-prompt::before {
            content: '🤖 ' attr(data-gpt-type);
            display: block;
            font-weight: 600;
            color: #60a5fa; /* Light blue for prompt type */
            margin-bottom: 12px;
            font-size: 0.85rem;
            text-transform: uppercase;
        }
        .copy-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: #374151; /* Medium gray */
            color: white;
            border: none;
            padding: 7px 14px;
            border-radius: 8px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .copy-btn:hover {
            background: #4b5563; /* Lighter gray */
        }
        .copy-btn:active {
            transform: scale(0.95);
        }
        .notification-container {
            position: fixed;
            top: 80px; /* Adjusted for top-bar */
            right: 25px;
            z-index: 2000;
            max-width: 420px; /* Wider notifications */
        }
        .notification {
            background: white;
            border-radius: 14px;
            padding: 18px 22px;
            margin-bottom: 12px;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: flex-start; /* Align icon to top */
            gap: 15px;
            animation: slideIn 0.4s ease-out;
            position: relative;
            border-left-width: 5px;
            border-left-style: solid;
        }
        /* Specific notification types using alert styles */
        .notification.alert-success { border-left-color: var(--success-color); }
        .notification.alert-warning { border-left-color: var(--warning-color); }
        .notification.alert-danger { border-left-color: var(--danger-color); }
        .notification.alert-info { border-left-color: var(--primary-color); }

        @keyframes slideIn {
            from { transform: translateX(110%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .notification-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: #94a3b8;
            cursor: pointer;
            padding: 5px;
            font-size: 1.1rem;
            line-height: 1;
        }
        .notification-close:hover {
            color: var(--danger-color);
        }
        .chat-widget {
            position: fixed;
            bottom: 25px;
            right: 25px;
            z-index: 1000;
        }
        .chat-button {
            width: 65px; /* Larger button */
            height: 65px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-xl);
            transition: all 0.3s ease;
            font-size: 1.8rem; /* Larger icon */
        }
        .chat-button:hover {
            transform: scale(1.1) rotate(10deg);
            background: #1e40af;
        }
        .chat-window {
            position: absolute;
            bottom: 85px; /* Adjusted for larger button */
            right: 0;
            width: 370px; /* Wider window */
            height: 520px; /* Taller window */
            background: white;
            border-radius: 18px;
            box-shadow: var(--shadow-xl);
            display: none;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }
        .chat-window.open {
            display: flex;
            animation: chatOpen 0.4s ease-out;
        }
        @keyframes chatOpen {
            from { opacity: 0; transform: translateY(20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        .chat-header {
            background: var(--primary-color);
            color: white;
            padding: 18px 22px;
            border-radius: 18px 18px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow-sm);
        }
         .chat-header h4 { margin: 0; font-size: 1.1rem; }
        .chat-header button {
            background: none;
            border: none;
            color: white;
            font-size: 1.3rem;
            cursor: pointer;
            opacity: 0.8;
            transition: opacity 0.2s;
        }
        .chat-header button:hover { opacity: 1; }
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: #f9fafb; /* Lighter background for messages */
        }
        .chat-message {
            padding: 10px 15px;
            border-radius: 14px;
            margin-bottom: 12px;
            max-width: 85%; /* Slightly wider messages */
            line-height: 1.5;
            font-size: 0.95rem;
        }
        .chat-message.user {
            background-color: var(--primary-color);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 4px; /* Speech bubble effect */
            text-align: left; /* Keep text left-aligned for readability */
        }
        .chat-message.assistant {
            background-color: #e2e8f0; /* Lighter gray for assistant */
            color: var(--text-dark);
            margin-right: auto;
            border-bottom-left-radius: 4px; /* Speech bubble effect */
        }
        .chat-message.system {
            font-style: italic;
            color: #64748b;
            text-align: center;
            background: none;
            font-size: 0.875rem;
            padding: 5px 0;
        }

        .chat-input-area {
            padding: 18px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 12px;
            background: white;
        }
        .chat-input {
            flex: 1;
            padding: 12px 18px;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            font-size: 0.95rem;
        }
        .chat-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(30, 58, 138, 0.2);
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.7); /* Darker overlay */
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            padding: 20px; /* Ensure modal is not stuck to edges */
        }
        .modal {
            background: white;
            border-radius: 18px;
            max-width: 750px; /* Wider modal for documents */
            width: 95%;
            max-height: 90vh;
            overflow: hidden; /* Let body scroll */
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-xl);
            animation: modalOpen 0.4s ease-out;
        }
         @keyframes modalOpen {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        .modal-header {
            padding: 25px 30px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        .modal-header h3 {
            font-size: 1.5rem;
            color: var(--text-dark);
        }
        .modal-body {
            padding: 30px;
            overflow-y: auto; /* Body scrolls, not entire modal */
            flex-grow: 1;
        }
        .modal-body h4 { margin-top: 1.5em; margin-bottom: 0.75em; font-size: 1.15rem; color: var(--primary-color); }
        .modal-body p, .modal-body li { margin-bottom: 1em; color: #334155; }
        .modal-body ul, .modal-body ol { margin-left: 1.8em; }
        .modal-footer {
            padding: 20px 30px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            background-color: #f8fafc; /* Light footer background */
            flex-shrink: 0;
        }
        .document-viewer {
            max-height: 65vh; /* Adjusted based on modal max-height */
            overflow-y: auto;
        }
        .document-viewer iframe {
            width: 100%;
            height: calc(65vh - 20px); /* Fill available space, account for padding */
            border: none;
            border-radius: 8px;
        }
        .document-viewer img {
            max-width: 100%;
            height: auto;
            display: block;
            margin-bottom: 15px;
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
        }
        .document-viewer pre {
             white-space: pre-wrap;
             word-wrap: break-word;
             font-family: 'SF Mono', Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
             font-size: 0.9rem;
             padding: 15px;
             background-color: #f9fafb;
             border-radius: 8px;
             border: 1px solid var(--border-color);
        }


        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 1fr; /* Stack sidebar and main content */
            }
            .sidebar {
                position: static;
                max-height: none;
                margin-bottom: 25px;
            }
            .header-content {
                grid-template-columns: 1fr;
                text-align: center;
            }
            .delegation-selector {
                order: 2; /* Move below title on small screens */
                margin: 20px auto 0;
            }
            .delegation-buttons {
                justify-content: center;
            }
        }
        @media (max-width: 768px) {
            .header-title h1 { font-size: 2.4rem; }
            .header-title .subtitle { font-size: 1.1rem; }
            .stats-grid { grid-template-columns: 1fr; }
            .time-zones { grid-template-columns: 1fr; gap: 15px; }
            .chat-window {
                width: calc(100% - 40px);
                right: 20px; /* Centered with margin */
                left: 20px;
                margin: 0;
                bottom: 90px; /* Ensure space above chat button */
            }
            .modal { max-width: 95%; }
            .content-title { font-size: 1.8rem; }
            .nav-item { padding: 10px 12px; }
            .btn { padding: 10px 18px; }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay, Top Bar, Header -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loader"></div>
            <h2>Loading COACH PRO Portal</h2>
            <p>Preparing your negotiation experience...</p>
        </div>
    </div>
    <div class="top-bar">
        <div class="top-bar-content">
            <div class="top-bar-left">
                <span id="currentTime">--:--</span> CEST | 
                <span id="nextDeadline">Next deadline: --</span>
            </div>
            <div class="top-bar-right">
                <button class="btn btn-sm btn-secondary" onclick="toggleNotificationPanel()" title="View Notifications" style="padding: 5px 10px;">
                    <span style="font-size: 1.2rem;">🔔</span> <span class="notification-badge" id="notificationCount">0</span>
                </button>
            </div>
        </div>
    </div>
    <header class="header">
        <div class="header-content">
            <div class="header-title">
                <h1>COACH PRO Portal</h1>
                <p class="subtitle">AI Negotiation Challenge - Malta Dialogue</p>
                <p class="subtitle" style="font-weight:600; opacity: 1;">Coach: Jhozman Camacho</p>
            </div>
            <div class="delegation-selector">
                <h3 style="margin-bottom: 15px; text-align: center; font-size: 1.1rem;">Select Your Delegation:</h3>
                <div class="delegation-buttons">
                    <button class="delegation-btn tunisia" onclick="selectDelegation('tunisia')">
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 900 600'%3E%3Crect width='900' height='600' fill='%23E70013'/%3E%3Ccircle cx='450' cy='300' r='150' fill='%23fff'/%3E%3Ccircle cx='480' cy='300' r='120' fill='%23E70013'/%3E%3Cpath d='M414 300a81 81 0 0056-19 81 81 0 00-17-60l-39 18 15 42-40 20 40 19zm21-90a75 75 0 0021 52l2-1 1-3a75 75 0 00-24-48z' fill='%23fff'/%3E%3C/svg%3E" class="flag-icon" alt="Tunisia Flag">
                        Tunisia
                    </button>
                    <button class="delegation-btn senegal" onclick="selectDelegation('senegal')">
                         <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='900' height='600'%3E%3Cpath fill='%2300853f' d='M0 0h300v600H0z'/%3E%3Cpath fill='%23fdef42' d='M300 0h300v600H300z'/%3E%3Cpath fill='%23e31b23' d='M600 0h300v600H600z'/%3E%3Cpath fill='%2300853f' d='M450 210l40.45 125.17-105.76-77.35h130.62L409.55 335.17z'/%3E%3C/svg%3E" class="flag-icon" alt="Senegal Flag">
                        Senegal
                    </button>
                </div>
                <div class="time-display">
                    <div class="time-zones">
                        <div class="time-zone">
                            <h3>Geneva 🇨🇭 (CEST)</h3>
                            <div class="time" id="genevaTime">--:--</div>
                            <div class="date" id="genevaDate">--</div>
                        </div>
                        <div class="time-zone">
                            <h3>Caracas 🇻🇪 (VE)</h3>
                            <div class="time" id="caracasTime">--:--</div>
                            <div class="date" id="caracasDate">--</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="dashboard-grid">
            <aside class="sidebar">
                <div class="nav-section">
                    <div class="nav-section-title">Main</div>
                    <a href="#" class="nav-item active" onclick="showTab('dashboard', this)">
                        <span class="icon">🏠</span> Dashboard
                        <span class="badge" id="dashboardBadge" style="display:none;">!</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showTab('overview', this)">
                        <span class="icon">🌐</span> Overview
                    </a>
                    <a href="#" class="nav-item" onclick="showTab('schedule', this)">
                        <span class="icon">📅</span> Schedule
                        <span class="badge" id="scheduleBadge" style="display:none;">1</span>
                    </a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Delegations & Blocs</div>
                    <a href="#" class="nav-item" onclick="showTab('tunisia', this)">
                        <span class="icon">🇹🇳</span> Tunisia
                    </a>
                    <a href="#" class="nav-item" onclick="showTab('senegal', this)">
                        <span class="icon">🇸🇳</span> Senegal
                    </a>
                    <a href="#" class="nav-item" onclick="showTab('blocs', this)">
                        <span class="icon">🤝</span> Negotiation Blocs
                    </a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Rounds</div>
                    <a href="#" class="nav-item" onclick="showTab('round1', this)">
                        <span class="icon">1️⃣</span> Round 1
                        <span class="badge" id="round1Badge" style="display:none;">!</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showTab('round2', this)">
                        <span class="icon">2️⃣</span> Round 2
                    </a>
                    <a href="#" class="nav-item" onclick="showTab('round3', this)">
                        <span class="icon">3️⃣</span> Round 3
                    </a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Tools & Resources</div>
                    <a href="#" class="nav-item" onclick="showTab('ai-assistant', this)">
                        <span class="icon">🤖</span> AI Assistant Guide
                    </a>
                    <a href="#" class="nav-item" onclick="showTab('documents', this)">
                        <span class="icon">📚</span> Documents Hub
                    </a>
                    <a href="#" class="nav-item" onclick="showTab('platforms', this)">
                        <span class="icon">💻</span> Platforms & Links
                    </a>
                </div>
            </aside>
            <main class="main-content">
                <!-- Dashboard Tab -->
                <div id="dashboard" class="tab-content active">
                    <div class="content-header">
                        <h2 class="content-title">Main Dashboard</h2>
                        <div class="content-actions">
                            <button class="btn btn-primary" onclick="checkForUpdates()">
                                <span style="font-size: 1.2rem; margin-right: 5px;">🔄</span> Check for Updates
                            </button>
                        </div>
                    </div>
                    <div class="alert alert-warning" id="dashboardAlert">
                        <span class="alert-icon">⚠️</span>
                        <div>
                            <strong id="dashboardAlertTitle">Round 2 In Progress</strong> 
                            <span id="dashboardAlertDetail">Next deadline: Amendment Proposals - 12:00 CEST</span>
                        </div>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card warning">
                            <div class="stat-label">Current Round Activity</div>
                            <div class="stat-value" id="currentRoundActivity">Round 2</div> 
                            <div class="stat-detail" id="currentRoundActivityDetail">Strategic Negotiation & Drafting</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Active Delegation</div>
                            <div class="stat-value" id="activeDelegationStat">-</div>
                            <div class="stat-detail">Operational Sovereignty Bloc</div>
                        </div>
                        <div class="stat-card danger">
                            <div class="stat-label">Next Deadline (CEST)</div>
                            <div class="stat-value" id="nextDeadlineTimeDisplay">12:00</div> 
                            <div class="stat-detail" id="nextDeadlineTask">Amendment Proposals</div>
                        </div>
                        <div class="stat-card success"> 
                            <div class="stat-label">Round 1 Docs Submitted</div>
                            <div class="stat-value" id="docsSubmittedR1">2/2</div>
                            <div class="stat-detail" id="docsSubmittedR1Detail">All R1 Docs Submitted ✓</div>
                        </div>
                    </div>
                    
                    <div class="round-section">
                        <div class="round-header">
                            <div class="round-title">
                                <span class="round-number">1</span>
                                Round 1: Information Management & Positioning
                            </div>
                            <span class="status-indicator completed" id="dashboardRound1StatusIndicator">Completed</span>
                        </div>
                        <p style="text-align: center; padding: 10px 0;"><i>Round 1 (May 23rd) has concluded. Details of activities are available in the "Round 1" tab or "Schedule" tab.</i></p>
                    </div>

                     <div class="round-section">
                        <div class="round-header">
                            <div class="round-title">
                                <span class="round-number">2</span>
                                Current Status: Round 2 - Strategic Negotiation & Drafting
                            </div>
                            <span class="status-indicator active" id="dashboardRound2StatusIndicator">⚡ ACTIVE</span>
                        </div>
                        <div class="timeline">
                             <div class="timeline-item completed" data-activity-id="dashboard-r2-consult">
                                <div class="time-label">
                                    09:10 - 09:30 CEST (May 24)
                                    <span class="status-indicator completed">Completed</span>
                                    <div class="activity-status-editor">
                                        <label for="status-dashboard-r2-consult">Status:</label>
                                        <select id="status-dashboard-r2-consult" onchange="updateActivityStatus('sched-r2-consult', this.value)">
                                            <option value="upcoming">Upcoming</option>
                                            <option value="active">In Progress</option>
                                            <option value="completed" selected>Completed</option>
                                        </select>
                                    </div>
                                </div>
                                <h4>Consultation of R1 Position Papers</h4>
                                <p>Teams analyzed final position papers from Round 1.
                                    <br><a href="#" class="btn btn-sm btn-secondary" style="margin-top:5px;" onclick="viewDocument('MERGED Final position papers from R1.pdf', 'https://drive.google.com/file/d/1BsXa6oEOjkJd7ECZepWUECFsxBQy7z8x/preview', 'https://drive.google.com/uc?export=download&id=1BsXa6oEOjkJd7ECZepWUECFsxBQy7z8x')">📄 View Merged R1 Papers</a>
                                </p>
                            </div>
                            <div class="timeline-item active" data-activity-id="dashboard-r2-draftdec"> <!-- Currently 09:30, this is active -->
                                <div class="time-label">
                                    09:30 - 09:45 CEST (May 24)
                                    <span class="status-indicator active">In Progress</span>
                                     <div class="activity-status-editor">
                                        <label for="status-dashboard-r2-draftdec">Status:</label>
                                        <select id="status-dashboard-r2-draftdec" onchange="updateActivityStatus('sched-r2-draftdec', this.value)">
                                            <option value="upcoming">Upcoming</option>
                                            <option value="active" selected>In Progress</option>
                                            <option value="completed">Completed</option>
                                        </select>
                                    </div>
                                </div>
                                <h4>Communication of Draft Declaration</h4>
                                <p>Presidency communicates a proposed Draft Declaration of Principles. Teams assess internally.
                                    <br><a href="#" class="btn btn-sm btn-secondary" style="margin-top:5px;" onclick="viewDocument('Draft Declaration of Principles.pdf', 'https://drive.google.com/file/d/1ug3jAWBeVW6pzsBWdTw6h6gwrV1EGjiT/preview', 'https://drive.google.com/uc?export=download&id=1ug3jAWBeVW6pzsBWdTw6h6gwrV1EGjiT')">📄 View Draft Declaration</a>
                                </p>
                            </div>
                             <div class="timeline-item upcoming" data-activity-id="dashboard-r2-negostart">
                                <div class="time-label">
                                    09:45 - 10:00 CEST (May 24)
                                    <span class="status-indicator upcoming">Upcoming</span>
                                    <div class="activity-status-editor">
                                        <label for="status-dashboard-r2-negostart">Status:</label>
                                        <select id="status-dashboard-r2-negostart" onchange="updateActivityStatus('sched-r2-negostart', this.value)">
                                            <option value="upcoming" selected>Upcoming</option>
                                            <option value="active">In Progress</option>
                                            <option value="completed">Completed</option>
                                        </select>
                                    </div>
                                </div>
                                <h4>Negotiation Starts: Prioritization of Issues</h4>
                                <p>Teams evaluate Draft Declaration and identify critical issues for amendment.</p>
                            </div>
                            <div class="timeline-item upcoming" data-activity-id="dashboard-r2-amendsubmit">
                                <div class="time-label">
                                    11:00 - 12:00 CEST (May 24)
                                    <span class="status-indicator upcoming">Upcoming Deadline</span>
                                    <div class="activity-status-editor">
                                        <label for="status-dashboard-r2-amendsubmit">Status:</label>
                                        <select id="status-dashboard-r2-amendsubmit" onchange="updateActivityStatus('sched-r2-amendsubmit', this.value)">
                                            <option value="upcoming" selected>Upcoming</option>
                                            <option value="active">In Progress</option>
                                            <option value="completed">Completed</option>
                                        </select>
                                    </div>
                                </div>
                                <h4>Submission of Amendment Proposals</h4>
                                <p>Deliverable: Final Amendment Proposals (PDF) on Google Drive <strong>by 12:00.</strong>
                                     <br><a href="#" class="btn btn-sm btn-secondary" style="margin-top:5px;" onclick="viewDocument('Amendments instructions.pdf', 'https://drive.google.com/file/d/13vCqKyJpUXO-KIetJEjSnyUUXHZB1fXQ/preview', 'https://drive.google.com/uc?export=download&id=13vCqKyJpUXO-KIetJEjSnyUUXHZB1fXQ')">📄 View Amendment Instructions</a>
                                </p>
                                <div id="amendmentProposalsUploadStatus_dashboard" class="deliverable-section" style="padding: 15px; margin-top:10px;">
                                    <!-- Status will be rendered here for the dashboard copy of this item -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Overview Tab -->
                <div id="overview" class="tab-content">
                    <div class="content-header">
                        <h2 class="content-title">Challenge Overview: Malta Dialogue</h2>
                    </div>
                    <div class="alert alert-info">
                        <span class="alert-icon">ℹ️</span>
                        <div>
                            <strong>Malta Dialogue on Irregular Migration</strong><br>
                            A regional diplomatic forum to articulate a Declaration of Principles for Euro-Mediterranean migration cooperation.
                        </div>
                    </div>
                    
                    <div class="key-takeaway-box">
                        <h4><span class="icon" style="font-size: 1.5rem;">📜</span>Core Context: Backgrounder Insights</h4>
                        <ul>
                            <li>The <span class="highlight-important">Backgrounder for Malta Dialogue</span> outlines a complex Euro-Mediterranean migration landscape characterized by <span class="highlight-important">power asymmetries</span>, demographic shifts, and fragmented governance.</li>
                            <li>It emphasizes the failure of current approaches to ensure both effective management and rights protection, leading to humanitarian crises and political volatility.</li>
                            <li>The Dialogue aims to foster a <span class="highlight-important">shared orientation</span> rather than binding agreements, drawing inspiration from inclusive initiatives like the Summit of the Two Shores.</li>
                            <li>Key pressures include EU internal divisions (Dublin Regulation), externalization policies with accountability gaps, and shrinking civic space for humanitarian actors.</li>
                        </ul>
                        <p class="reference">📄 Full Document: <a href="#" onclick="viewDocument('Backgrounder for the Malta Dialogue', 'https://drive.google.com/file/d/1Qtxu4PYd5D19_MhhYDqrz_7f16rvoHdZTB64lbMKZKs/preview', 'https://drive.google.com/uc?export=download&id=1Qtxu4PYd5D19_MhhYDqrz_7f16rvoHdZTB64lbMKZKs'); return false;">Backgrounder for the Malta Dialogue</a></p>
                    </div>
                    
                    <div class="delegation-card" style="border-left: 5px solid var(--primary-color);">
                        <h3 style="color: var(--primary-color); margin-bottom: 15px;">Context of the Malta Dialogue</h3>
                        <p>The Mediterranean, historically a space of exchange, migration, and political entanglement, is today also a space of tension and profound asymmetry. As Europe faces demographic decline and labour shortages, neighbouring regions—from North Africa to the Sahel—contend with growing youth populations, high unemployment, and fragile development trajectories.</p>
                        <p>Despite shared interdependence, the governance of migration across this zone remains fragmented, politically volatile, and strategically unbalanced. Legal mobility frameworks are narrow and selective. Return agreements are contested and inconsistently implemented. Migration control is increasingly outsourced beyond EU borders, with limited accountability. Humanitarian and civil actors are under pressure, especially in the maritime domain.</p>
                        <p>In response to these challenges, the Government of Malta has convened a regional diplomatic dialogue. While not a formal EU process, this forum provides space for a diverse array of actors—including governments, international agencies, and civil society—to articulate a Declaration of Principles. The objective is not to harmonize positions, but to identify a shared orientation that can inform the future of Euro-Mediterranean migration cooperation.</p>
                         <p>This forum draws inspiration from previous initiatives such as the Summit of the Two Shores, which sought to revitalize Euro-Mediterranean dialogue by engaging a wide range of state and non-state actors. In that spirit, the Malta Dialogue aims to continue fostering inclusive and constructive exchange, focusing on the co-development of shared principles in a context marked by growing asymmetries and political tensions.</p>
                    </div>

                    <div class="key-takeaway-box">
                        <h4><span class="icon" style="font-size: 1.5rem;">📊</span>Technical File: Critical Data Points</h4>
                        <ul>
                            <li>The <span class="highlight-important">TECHNICAL FILE.pdf</span> presents stark figures: Asymmetric burden-sharing sees frontline states (e.g., Italy, Greece) handling a disproportionate number of asylum claims (approx. 70-75%) with limited EU solidarity in redistribution.</li>
                            <li>External migration management funding has exceeded <span class="highlight-important">€9 billion since 2015</span>, yet transparency and human rights oversight remain significant concerns.</li>
                            <li>Search and Rescue (SAR) coordination is hampered by a <span class="highlight-important">lack of a unified Mediterranean framework</span>, leading to operational gaps and delays.</li>
                            <li>Return and readmission effectiveness is low (around <span class="highlight-important">20-30% overall for rejected asylum seekers</span>), indicating major challenges in implementing return policies sustainably and humanely.</li>
                        </ul>
                        <p class="reference">📄 Full Document: <a href="#" onclick="viewDocument('TECHNICAL FILE.pdf', 'https://drive.google.com/file/d/1cdi3F_rttb1gSyrY47Pp7du8PzRN9NfN/preview', 'https://drive.google.com/uc?export=download&id=1cdi3F_rttb1gSyrY47Pp7du8PzRN9NfN'); return false;">TECHNICAL FILE.pdf</a></p>
                    </div>

                    <div class="delegation-card" style="border-left: 5px solid var(--secondary-color);">
                        <h3 style="color: var(--secondary-color); margin-bottom: 15px;">A Critical Juncture for Regional Cooperation</h3>
                        <p>The Malta Dialogue takes place at a moment of structural reckoning in Euro-Mediterranean migration governance. Two developments in particular frame the urgency of renewed regional conversation.</p>
                        <p>First, the adoption of the <span class="highlight-important">EU Pact on Migration and Asylum</span> reflects a push to recalibrate Europe’s internal rules. But the Pact largely builds on existing logics—especially the Dublin Regulation, which continues to assign primary responsibility for asylum processing to the first country of entry. Despite reformist language, the system still leaves frontline states with disproportionate obligations, perpetuating internal asymmetries that the Pact neither resolves nor reimagines.</p>
                        <p>Second, the EU and its Member States have intensified external cooperation with key third countries—Tunisia, Egypt, Libya—through a growing web of operational partnerships, funding instruments, and ad hoc agreements. These external arrangements aim to intercept migrants before arrival, facilitate returns, and contain mobility flows beyond EU borders. Yet many remain <span class="highlight-important">informal, opaque, and contested</span>—raising concerns about legal standards, accountability, and the political cost of outsourcing control.</p>
                        <p>Together, these internal and external strategies have yielded short-term results but deepened long-term tensions. Fragmentation, unclear responsibility, and asymmetric burdens now undermine the legitimacy of the system itself. Across the region, diverse actors—including civil society, municipalities, and frontline institutions—are calling for a migration architecture that is more transparent, predictable, and principled.</p>
                        <p>The Malta Dialogue aims to meet that call. It tests whether a divided landscape—marked by power imbalances and competing mandates—can nonetheless find convergence on shared principles. Malta’s initiative invites participants not to negotiate binding solutions, but to reimagine the foundations of cooperation: fairness, legal integrity, and mutual responsibility.</p>
                    </div>
                     <div class="key-takeaway-box">
                        <h4><span class="icon" style="font-size: 1.5rem;">🎤</span>Presidency's Opening Tone (Round 1)</h4>
                        <ul>
                            <li>The <span class="highlight-important">OPENING SPEECH R1.pdf</span> by the Maltese Presidency sets a tone of cautious optimism, calling for "balanced, sustainable, and rights-respecting" solutions.</li>
                            <li>It acknowledges the <span class="highlight-important">sovereignty concerns</span> of member states while stressing the need for <span class="highlight-important">collective responsibility</span> and innovative partnerships.</li>
                            <li>The speech frames the Dialogue as a unique opportunity to build trust and find common ground on principles, even if specific policies differ.</li>
                        </ul>
                        <p class="reference">📄 Full Document: <a href="#" onclick="viewDocument('OPENING SPEECH R1.pdf', 'https://drive.google.com/file/d/1tZLYs8NmShzHNv-Sz8miZvIw1lgS2ktO/preview', 'https://drive.google.com/uc?export=download&id=1tZLYs8NmShzHNv-Sz8miZvIw1lgS2ktO'); return false;">OPENING SPEECH R1.pdf</a></p>
                    </div>
                    <div class="key-takeaway-box">
                        <h4><span class="icon" style="font-size: 1.5rem;">📄</span>Round 1 Reflections: Merged Position Papers</h4>
                        <ul>
                            <li>The <span class="highlight-important">MERGED Final position papers from R1.pdf</span> provides a consolidated view of all delegations' final stances after the initial round and crisis event.</li>
                            <li>This document is critical for understanding the evolving negotiation landscape, identifying potential alliances, points of contention, and areas for compromise heading into Round 2.</li>
                        </ul>
                        <p class="reference">📄 Full Document: <a href="#" onclick="viewDocument('MERGED Final position papers from R1.pdf', 'https://drive.google.com/file/d/1BsXa6oEOjkJd7ECZepWUECFsxBQy7z8x/preview', 'https://drive.google.com/uc?export=download&id=1BsXa6oEOjkJd7ECZepWUECFsxBQy7z8x'); return false;">MERGED Final position papers from R1.pdf</a></p>
                    </div>

                    <div class="delegation-card" style="border-left: 5px solid var(--accent-color);">
                        <h3 style="color: var(--accent-color); margin-bottom: 15px;">Disrupted Geopolitical Context</h3>
                        <p>Several structural and political developments have created urgency for this dialogue:</p>
                        <ul>
                            <li><strong>Domestic pressures in Europe:</strong> Security-oriented narratives dominate the migration debate. Governments face electoral constraints, rising anti-immigrant sentiment, and calls to “regain control” of borders. Instruments such as the Dublin Regulation continue to drive intra-EU tensions, encouraging strategic burden-shifting and fragmenting solidarity.</li>
                            <li><strong>Strategic realignment in North Africa and the Sahel:</strong> Countries in the region increasingly treat migration cooperation as diplomatic leverage—using it to negotiate aid, investment, or political concessions—while simultaneously resisting efforts to formalize their role as countries of destination. This ambivalence fuels reactive enforcement measures, informal deterrence practices, and selective cooperation, reflecting deeper tensions between sovereignty, external pressures, and limited institutional capacity.</li>
                            <li><strong>Humanitarian fatigue, shrinking civic space, and legal pushback:</strong> NGOs and humanitarian actors increasingly face criminalization, legal harassment, and restricted access to migration management sites, limiting their capacity to provide assistance or monitor conditions. At the same time, legal challenges continue to accumulate over practices such as pushbacks, non-refoulement breaches, expulsions into remote areas, and prolonged detention without review, exposing widening gaps between operational practices and international legal norms.</li>
                            <li><strong>Technological acceleration and privatization:</strong> AI-powered surveillance, predictive analytics, and biometric technologies are rapidly expanding across border management systems. In countries like Spain, the growing use of private security firms to operate surveillance infrastructure adds further complexity, raising concerns about transparency, oversight, and accountability as technological deployment increasingly outpaces ethical and legal safeguards.</li>
                        </ul>
                        <p>Many diplomats and experts acknowledge the absence of a genuine space for open and honest dialogue on migration. Despite the growing need for forward-looking policy discussions, governments continue to steer their migration strategies toward short-term containment and the externalization of migration management. This simulation immerses participants in this evolving landscape—not to replicate formal negotiations, but to collaboratively craft a shared document that could help shape how principles are defined, implemented, and embedded in future policy frameworks.</p>
                    </div>

                     <div class="delegation-card" style="border-left: 5px solid var(--success-color);">
                        <h3 style="color: var(--success-color); margin-bottom: 15px;">Scope and Rationale of the Simulation</h3>
                        <p>The Malta Dialogue takes place at a critical moment for Euro-Mediterranean migration governance. With the formal adoption of the new EU Pact on Migration and Asylum, Member States and regional partners are now facing the more complex challenge: translating high-level agreements into operationally viable, politically acceptable, and ethically grounded practices.</p>
                        <p>This simulation invites participants to engage as official representatives in a high-level multilateral dialogue. The objective is to produce a <span class="highlight-important">Declaration of Principles on Irregular Migration Management</span> — a non-binding but politically meaningful framework designed to guide cooperation in the Pact’s early implementation phase.</p>
                    </div>
                    
                    <h3 style="margin: 30px 0 20px; font-size:1.5rem; color: var(--primary-color);">The 4 Fundamental Issues for Negotiation</h3>
                    <div class="resource-grid">
                        <div class="resource-card">
                            <div class="resource-icon" style="background: #dbeafe; color: #2563eb;">🛡️</div>
                            <h4 class="resource-title">1. Effective and Equitable Access to Protection</h4>
                            <p class="resource-description">Balancing rights obligations (non-refoulement, fair asylum procedures) with national capacity limits and diverse legal interpretations. Key questions: How to accelerate procedures without compromising fairness? What are non-negotiable procedural guarantees (e.g., legal aid, individual assessment)? How to address secondary movements within a principled framework?</p>
                        </div>
                        <div class="resource-card">
                            <div class="resource-icon" style="background: #fef3c7; color: #d97706;">🔄</div>
                            <h4 class="resource-title">2. Return, Readmission, and Reintegration</h4>
                            <p class="resource-description">Reconciling state interests in effective returns with the need for sustainable, dignified, and rights-based reintegration for returnees. Key questions: Can return be genuinely voluntary and fair? What are the responsibilities of countries of origin and transit versus destination states? How to ensure reintegration support is effective and not merely a token gesture?</p>
                        </div>
                        <div class="resource-card">
                            <div class="resource-icon" style="background: #fee2e2; color: #dc2626;">🌐</div>
                            <h4 class="resource-title">3. Externalization and Border Management</h4>
                            <p class="resource-description">Navigating the trend of delegating migration control functions to third countries. Key questions: Who bears ultimate responsibility when governance extends beyond sovereign borders? What accountability mechanisms and legal safeguards are necessary to prevent rights violations? How can partnerships be equitable and avoid creating "buffer states"?</p>
                        </div>
                        <div class="resource-card">
                            <div class="resource-icon" style="background: #d1fae5; color: #059669;">⚓</div>
                            <h4 class="resource-title">4. Search and Rescue (SAR), Aid, and Solidarity</h4>
                            <p class="resource-description">Addressing the governance of maritime rescue, humanitarian aid delivery, and the management of missing persons. Key questions: How to ensure predictable disembarkation and fair sharing of responsibilities? What is the role of NGOs and private actors? How can solidarity mechanisms be effective and politically sustainable, moving beyond ad-hoc arrangements?</p>
                        </div>
                    </div>
                </div>
                
                <!-- Schedule Tab -->
                <div id="schedule" class="tab-content">
                    <div class="content-header">
                        <h2 class="content-title">Detailed Challenge Schedule</h2>
                        <div class="content-actions">
                            <button class="btn btn-secondary" onclick="exportSchedule()">
                                <span style="font-size: 1.2rem; margin-right: 5px;">📅</span> Export Calendar
                            </button>
                        </div>
                    </div>
                    <div class="alert alert-info">
                        <span class="alert-icon">🕐</span>
                        <div>
                            All times are CEST (Central European Summer Time), Geneva. Simulation Date: May 24, 2025 (current). Submission deadlines are <strong>strict</strong>. Activity statuses can be manually updated below.
                        </div>
                    </div>

                    <h3 style="color: var(--primary-color); margin-bottom:15px;">Friday, May 23rd: Pre-Rounds and Round 1 (Concluded)</h3>
                    <div class="timeline">
                        <div class="timeline-item" data-activity-id="sched-inauguration">
                            <div class="time-label">09:00 - 12:00 CEST <span class="status-indicator"></span>
                                <div class="activity-status-editor">
                                    <label for="status-sched-inauguration">Status:</label>
                                    <select id="status-sched-inauguration" onchange="updateActivityStatus('sched-inauguration', this.value)"></select>
                                </div>
                            </div>
                            <h4>Inauguration Session (Webex)</h4>
                            <p>Expert panels and keynote speeches.
                                <br><a href="https://iheid.webex.com/wbxmjs/joinservice/sites/iheid/meeting/download/84de194976164c04b3326777ed502726?siteurl=iheid&MTID=m708917ce4e4caa689369f0379be4dd43" target="_blank" class="btn btn-sm btn-primary" style="margin-top:5px;">🔗 Join Webex Session</a>
                            </p>
                        </div>
                        <div class="timeline-item" data-activity-id="sched-round1">
                            <div class="time-label">13:00 - 17:00 CEST <span class="status-indicator"></span>
                                <div class="activity-status-editor">
                                     <label for="status-sched-round1">Status:</label>
                                    <select id="status-sched-round1" onchange="updateActivityStatus('sched-round1', this.value)"></select>
                                </div>
                            </div>
                            <h4>ROUND 1: Information Management and Positioning (Zoom)</h4>
                             <p><a href="https://us06web.zoom.us/j/82148672315#success" target="_blank" class="btn btn-sm btn-primary" style="margin-top:5px;">🔗 Join Zoom Simulation</a></p>
                            <div class="round-section" style="margin-top:15px; background-color: white;">
                                <div class="timeline-item" data-activity-id="sched-r1-opening">
                                    <div class="time-label">14:00 - 14:20 <span class="status-indicator"></span>
                                        <div class="activity-status-editor">
                                            <label for="status-sched-r1-opening">Status:</label>
                                            <select id="status-sched-r1-opening" onchange="updateActivityStatus('sched-r1-opening', this.value)"></select>
                                        </div>
                                    </div>
                                    <h5>1.1.1 Official Opening Ceremony (Zoom Plenary)</h5>
                                    <p>Maltese Presidency's speech.
                                        <br><a href="#" class="btn btn-sm btn-secondary" style="margin-top:5px;" onclick="viewDocument('OPENING SPEECH R1.pdf', 'https://drive.google.com/file/d/1tZLYs8NmShzHNv-Sz8miZvIw1lgS2ktO/preview', 'https://drive.google.com/uc?export=download&id=1tZLYs8NmShzHNv-Sz8miZvIw1lgS2ktO')">📄 View Speech</a>
                                    </p>
                                </div>
                                <div class="timeline-item" data-activity-id="sched-r1-dossier">
                                    <div class="time-label">14:20 - 14:45 <span class="status-indicator"></span>
                                        <div class="activity-status-editor">
                                            <label for="status-sched-r1-dossier">Status:</label>
                                           <select id="status-sched-r1-dossier" onchange="updateActivityStatus('sched-r1-dossier', this.value)"></select>
                                        </div>
                                    </div>
                                    <h5>1.1.2 Analysis of Technical Dossier (Delegation Rooms)</h5>
                                    <p>Reception and internal analysis of the full technical dossier.
                                        <br><a href="#" class="btn btn-sm btn-secondary" style="margin-top:5px;" onclick="viewDocument('TECHNICAL FILE.pdf', 'https://drive.google.com/file/d/1cdi3F_rttb1gSyrY47Pp7du8PzRN9NfN/preview', 'https://drive.google.com/uc?export=download&id=1cdi3F_rttb1gSyrY47Pp7du8PzRN9NfN')">📄 View Technical File</a>
                                    </p>
                                </div>
                                <div class="timeline-item" id="schedule-preliminary-paper-submission" data-activity-id="sched-r1-prelimdraft">
                                    <div class="time-label">14:45 - 15:15 <span class="status-indicator"></span>
                                         <div class="activity-status-editor">
                                            <label for="status-sched-r1-prelimdraft">Status:</label>
                                           <select id="status-sched-r1-prelimdraft" onchange="updateActivityStatus('sched-r1-prelimdraft', this.value)"></select>
                                        </div>
                                    </div>
                                    <h5>1.1.3 Drafting Preliminary Position Papers (Individual)</h5>
                                    <p><strong>Deliverable:</strong> Preliminary Position Paper (PDF) uploaded to Google Drive <strong>BEFORE 15:15.</strong></p>
                                    <div id="preliminaryPositionUploadStatus_schedule" class="deliverable-section" style="padding: 15px; margin-top:10px;">
                                        <div class="deliverable-header"><span class="deliverable-title">Preliminary Position Paper</span><span class="deliverable-status"></span></div>
                                    </div>
                                </div>
                                <div class="timeline-item" data-activity-id="sched-r1-informal">
                                    <div class="time-label">15:15 - 15:45 <span class="status-indicator"></span>
                                         <div class="activity-status-editor">
                                            <label for="status-sched-r1-informal">Status:</label>
                                           <select id="status-sched-r1-informal" onchange="updateActivityStatus('sched-r1-informal', this.value)"></select>
                                        </div>
                                    </div>
                                    <h5>1.1.4 First Informal Exchanges and Coalition Mapping</h5>
                                    <p>Informal breakout rooms open. Explore alliances, common interests. No binding deals yet.</p>
                                </div>
                                <div class="timeline-item" data-activity-id="sched-r1-crisis">
                                    <div class="time-label">15:45 <span class="status-indicator"></span>
                                        <div class="activity-status-editor">
                                            <label for="status-sched-r1-crisis">Status:</label>
                                           <select id="status-sched-r1-crisis" onchange="updateActivityStatus('sched-r1-crisis', this.value)"></select>
                                        </div>
                                    </div>
                                    <h5>1.2.1 Crisis</h5>
                                    <p>“Breaking News” media alert revealing sensitive information.
                                        <br><a href="https://drive.google.com/file/d/1rI26h83uob50MOgKlhKZy6Iv7Rff6z1J/preview" target="_blank" class="btn btn-sm btn-danger" style="margin-top:5px;">📄 Download Crisis Report</a>
                                    </p>
                                </div>
                                 <div class="timeline-item" data-activity-id="sched-r1-reassess">
                                    <div class="time-label">16:00 - 16:20 <span class="status-indicator"></span>
                                        <div class="activity-status-editor">
                                            <label for="status-sched-r1-reassess">Status:</label>
                                           <select id="status-sched-r1-reassess" onchange="updateActivityStatus('sched-r1-reassess', this.value)"></select>
                                        </div>
                                    </div>
                                    <h5>1.2.2 Reassessment with allies</h5>
                                    <p>Allies urgently reassess positions. Discussion in breakout rooms.</p>
                                </div>
                                <div class="timeline-item" data-activity-id="sched-r1-presidencycall">
                                    <div class="time-label">16:20 - 16:50 <span class="status-indicator"></span>
                                        <div class="activity-status-editor">
                                            <label for="status-sched-r1-presidencycall">Status:</label>
                                           <select id="status-sched-r1-presidencycall" onchange="updateActivityStatus('sched-r1-presidencycall', this.value)"></select>
                                        </div>
                                    </div>
                                    <h5>1.2.3 Presidency Intervention: Call for Structured Dialogue</h5>
                                    <p>Maltese Presidency intervenes, urging delegations to submit a formal response by end of Round 1.</p>
                                </div>
                                <div class="timeline-item" id="schedule-final-paper-submission" data-activity-id="sched-r1-finalsubmit">
                                    <div class="time-label">16:50 - 17:00 <span class="status-indicator"></span>
                                        <div class="activity-status-editor">
                                            <label for="status-sched-r1-finalsubmit">Status:</label>
                                           <select id="status-sched-r1-finalsubmit" onchange="updateActivityStatus('sched-r1-finalsubmit', this.value)"></select>
                                        </div>
                                    </div>
                                    <h5>1.2.4 Delivery of Final Position Papers</h5>
                                    <p><strong>Deliverable:</strong> Final Updated Position Paper (PDF) on Google Drive <strong>by 17:00.</strong></p>
                                     <div id="finalPositionUploadStatus_schedule" class="deliverable-section" style="padding: 15px; margin-top:10px;">
                                        <div class="deliverable-header"><span class="deliverable-title">Final Position Paper</span><span class="deliverable-status"></span></div>
                                     </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h3 style="color: var(--primary-color); margin: 25px 0 15px;">Saturday, May 24th: Rounds 2 & 3, Closing (Current Day)</h3>
                    <div class="timeline">
                        <div class="timeline-item" data-activity-id="sched-round2">
                            <div class="time-label">09:00 - 12:00 CEST <span class="status-indicator"></span>
                                <div class="activity-status-editor">
                                    <label for="status-sched-round2">Status:</label>
                                    <select id="status-sched-round2" onchange="updateActivityStatus('sched-round2', this.value)"></select>
                                </div>
                            </div>
                            <h4>ROUND 2: Strategic Negotiation and Drafting (Zoom)</h4>
                             <p><a href="https://us06web.zoom.us/j/82148672315#success" target="_blank" class="btn btn-sm btn-primary" style="margin-top:5px;">🔗 Join Zoom Simulation</a></p>
                            <div class="round-section" style="margin-top:15px; background-color: white;">
                                <div class="timeline-item" data-activity-id="sched-r2-consult">
                                    <div class="time-label">09:10 - 09:30<span class="status-indicator"></span><div class="activity-status-editor"><label for="status-sched-r2-consult">Status:</label><select id="status-sched-r2-consult" onchange="updateActivityStatus('sched-r2-consult', this.value)"></select></div></div>
                                    <h5>2.1.1 Consultation of Position Papers of Potential Targets</h5>
                                    <p>Teams analyze Final Position Papers from Round 1. No debate; focus on mapping strategies.
                                        <br><a href="#" class="btn btn-sm btn-secondary" style="margin-top:5px;" onclick="viewDocument('MERGED Final position papers from R1.pdf', 'https://drive.google.com/file/d/1BsXa6oEOjkJd7ECZepWUECFsxBQy7z8x/preview', 'https://drive.google.com/uc?export=download&id=1BsXa6oEOjkJd7ECZepWUECFsxBQy7z8x')">📄 View Merged R1 Papers</a>
                                    </p>
                                </div>
                                <div class="timeline-item" data-activity-id="sched-r2-draftdec">
                                    <div class="time-label">09:30 - 09:45<span class="status-indicator"></span><div class="activity-status-editor"><label for="status-sched-r2-draftdec">Status:</label><select id="status-sched-r2-draftdec" onchange="updateActivityStatus('sched-r2-draftdec', this.value)"></select></div></div>
                                    <h5>2.1.2 Communication of a proposed Draft Declaration of Principle by the Presidency</h5>
                                    <p>Teams receive Draft Declaration (Fundamental Principles NON-negotiable, Operational Principles YES negotiable). Internal assessment.
                                         <br><a href="#" class="btn btn-sm btn-secondary" style="margin-top:5px;" onclick="viewDocument('Draft Declaration of Principles.pdf', 'https://drive.google.com/file/d/1ug3jAWBeVW6pzsBWdTw6h6gwrV1EGjiT/preview', 'https://drive.google.com/uc?export=download&id=1ug3jAWBeVW6pzsBWdTw6h6gwrV1EGjiT')">📄 View Draft Declaration</a>
                                    </p>
                                </div>
                                 <div class="timeline-item" data-activity-id="sched-r2-negostart">
                                    <div class="time-label">09:45 - 10:00<span class="status-indicator"></span><div class="activity-status-editor"><label for="status-sched-r2-negostart">Status:</label><select id="status-sched-r2-negostart" onchange="updateActivityStatus('sched-r2-negostart', this.value)"></select></div></div>
                                    <h5>2.2.1 Negotiation Starts: Prioritization of Issues</h5>
                                    <p>Teams evaluate Draft Declaration, identify critical issues, and rank priorities internally.</p>
                                </div>
                                <div class="timeline-item" data-activity-id="sched-r2-directnego">
                                    <div class="time-label">10:00 - 11:00<span class="status-indicator"></span><div class="activity-status-editor"><label for="status-sched-r2-directnego">Status:</label><select id="status-sched-r2-directnego" onchange="updateActivityStatus('sched-r2-directnego', this.value)"></select></div></div>
                                    <h5>2.2.2 Direct Negotiations Between Delegations</h5>
                                    <p>Teams engage in direct negotiations in breakout rooms. Focus: What to amend? What to support jointly?</p>
                                </div>
                                <div class="timeline-item" id="schedule-amendment-submission" data-activity-id="sched-r2-amendsubmit">
                                    <div class="time-label">11:00 - 12:00 <span class="status-indicator"></span><div class="activity-status-editor"><label for="status-sched-r2-amendsubmit">Status:</label><select id="status-sched-r2-amendsubmit" onchange="updateActivityStatus('sched-r2-amendsubmit', this.value)"></select></div></div>
                                    <h5>2.3.1 Drafting of Amendment Proposals / 2.3.2 Submission</h5>
                                    <p>Teams (alone or jointly) draft concrete amendment proposals.
                                       <br><strong>Deliverable:</strong> Final Amendment Proposals (PDF) on Google Drive <strong>by 12:00.</strong>
                                       <br><a href="#" class="btn btn-sm btn-secondary" style="margin-top:5px;" onclick="viewDocument('Amendments instructions.pdf', 'https://drive.google.com/file/d/13vCqKyJpUXO-KIetJEjSnyUUXHZB1fXQ/preview', 'https://drive.google.com/uc?export=download&id=13vCqKyJpUXO-KIetJEjSnyUUXHZB1fXQ')">📄 View Amendment Instructions</a>
                                    </p>
                                    <div id="amendmentUploadStatus_schedule" class="deliverable-section" style="padding: 15px; margin-top:10px;">
                                        <div class="deliverable-header"><span class="deliverable-title">Amendment Proposals</span><span class="deliverable-status"></span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="timeline-item" data-activity-id="sched-round3">
                            <div class="time-label">13:00 - 16:00 CEST <span class="status-indicator"></span>
                                <div class="activity-status-editor">
                                    <label for="status-sched-round3">Status:</label>
                                    <select id="status-sched-round3" onchange="updateActivityStatus('sched-round3', this.value)"></select>
                                </div>
                            </div>
                            <h4>ROUND 3: Public Communication (Zoom)</h4>
                             <p><a href="https://us06web.zoom.us/j/82148672315#success" target="_blank" class="btn btn-sm btn-primary" style="margin-top:5px;">🔗 Join Zoom Simulation</a></p>
                            <div class="round-section" style="margin-top:15px; background-color: white;">
                                <div class="timeline-item" data-activity-id="sched-r3-finaldec">
                                    <div class="time-label">13:00 - 13:30<span class="status-indicator"></span><div class="activity-status-editor"><label for="status-sched-r3-finaldec">Status:</label><select id="status-sched-r3-finaldec" onchange="updateActivityStatus('sched-r3-finaldec', this.value)"></select></div></div>
                                    <h5>3.1 Publication of the Final Declaration of Principles</h5>
                                    <p>Presidency publishes the Final Declaration. Teams review and note priorities addressed.</p>
                                </div>
                                <div class="timeline-item" id="schedule-statement-submission" data-activity-id="sched-r3-statementsubmit">
                                    <div class="time-label">13:30 - 14:00 <span class="status-indicator"></span><div class="activity-status-editor"><label for="status-sched-r3-statementsubmit">Status:</label><select id="status-sched-r3-statementsubmit" onchange="updateActivityStatus('sched-r3-statementsubmit', this.value)"></select></div></div>
                                    <h5>3.2.1 Preparation of Official Delegation Statements / 3.2.2 Submission</h5>
                                    <p>Each delegation prepares a written official statement and a 5-min press speech.
                                       <br><strong>Deliverable:</strong> Final Written Statement (PDF) on Google Drive <strong>by 14:00.</strong>
                                    </p>
                                     <div id="writtenStatementUploadStatus_schedule" class="deliverable-section" style="padding: 15px; margin-top:10px;">
                                        <div class="deliverable-header"><span class="deliverable-title">Final Written Statement</span><span class="deliverable-status"></span></div>
                                     </div>
                                </div>
                                <div class="timeline-item" data-activity-id="sched-r3-pressconf">
                                    <div class="time-label">14:00 - 16:00<span class="status-indicator"></span><div class="activity-status-editor"><label for="status-sched-r3-pressconf">Status:</label><select id="status-sched-r3-pressconf" onchange="updateActivityStatus('sched-r3-pressconf', this.value)"></select></div></div>
                                    <h5>3.3.1 Press Conference and Q&A</h5>
                                    <p>Each team delivers its 5-min press speech live. Journalists (organizers/selected participants) pose questions.</p>
                                </div>
                            </div>
                        </div>
                        <div class="timeline-item" data-activity-id="sched-closing">
                            <div class="time-label">16:30 - 17:00 CEST <span class="status-indicator"></span>
                                <div class="activity-status-editor">
                                    <label for="status-sched-closing">Status:</label>
                                    <select id="status-sched-closing" onchange="updateActivityStatus('sched-closing', this.value)"></select>
                                </div>
                            </div>
                            <h4>Closing Ceremony and Awards (Webex)</h4>
                            <p>Delivery of excellence certificates and closing remarks. Broadcast via Webex.
                               <br><a href="https://iheid.webex.com/wbxmjs/joinservice/sites/iheid/meeting/download/84de194976164c04b3326777ed502726?siteurl=iheid&MTID=m708917ce4e4caa689369f0379be4dd43" target="_blank" class="btn btn-sm btn-primary" style="margin-top:5px;">🔗 Join Webex Session</a>
                            </p>
                        </div>
                    </div>
                </div>
                <!-- Tunisia Tab -->
                <div id="tunisia" class="tab-content">
                    <div class="content-header">
                        <h2 class="content-title">Delegation of Tunisia 🇹🇳</h2>
                        <div class="content-actions">
                             <button class="btn btn-primary" onclick="viewDocument('Republic of Tunisia Preliminary Position Paper.pdf', 'https://drive.google.com/file/d/1Exo7e3L3tOeSVOWFZat-5zE5pIasYE3m/preview', 'https://drive.google.com/uc?export=download&id=1Exo7e3L3tOeSVOWFZat-5zE5pIasYE3m')">
                               📄 View Prelim. Position
                            </button>
                            <button class="btn btn-primary" onclick="viewDocument('Tunisia - Final Position Paper.pdf', 'https://drive.google.com/file/d/110gJmvQwlKgL-0gR6cpC_8cgiXmQEBoS/preview', 'https://drive.google.com/uc?export=download&id=110gJmvQwlKgL-0gR6cpC_8cgiXmQEBoS')">
                               📄 View Final Position
                            </button>
                        </div>
                    </div>
                     <div class="key-takeaway-box">
                        <h4><span class="icon" style="font-size: 1.5rem;">🇹🇳</span>Tunisia Mandate: Core Stance</h4>
                        <ul>
                            <li>Tunisia, as co-leader of the <span class="highlight-important">🔴 Operational Sovereignty Bloc</span>, aims to secure maximum financial, political, and technical support from the EU.</li>
                            <li>Core objective: Exchange short-term migration containment efforts for tangible aid, while <span class="highlight-important">firmly rejecting long-term legal responsibilities</span> (e.g., hosting duties, third-country asylum processing).</li>
                            <li>Red Lines: No binding hosting/asylum obligations, no external legal conditionality or rights-based oversight on its operations, no formal return targets, and no public NGO involvement in enforcement.</li>
                            <li>Strategy: Transactional and defensive, supporting vague cooperation language if it unlocks funding without imposing legal burdens. Will leverage bloc cohesion.</li>
                        </ul>
                        <p class="reference">📄 Full Mandate: <a href="#" onclick="viewDocument('Tunisia Mandate', 'https://drive.google.com/file/d/10X4YSS6y0Ss8-WduhvvDls9rD5aOVdbRWBWlG_Hk8rI/preview', 'https://drive.google.com/uc?export=download&id=10X4YSS6y0Ss8-WduhvvDls9rD5aOVdbRWBWlG_Hk8rI'); return false;">Tunisia Mandate Document</a></p>
                    </div>
                    <div class="delegation-card tunisia">
                        <div class="delegation-header">
                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 900 600'%3E%3Crect width='900' height='600' fill='%23E70013'/%3E%3Ccircle cx='450' cy='300' r='150' fill='%23fff'/%3E%3Ccircle cx='480' cy='300' r='120' fill='%23E70013'/%3E%3Cpath d='M414 300a81 81 0 0056-19 81 81 0 00-17-60l-39 18 15 42-40 20 40 19zm21-90a75 75 0 0021 52l2-1 1-3a75 75 0 00-24-48z' fill='%23fff'/%3E%3C/svg%3E" class="delegation-flag" alt="Tunisia Flag">
                            <div class="delegation-info">
                                <h2>Republic of Tunisia</h2>
                                <p>Operational Sovereignty Bloc - Co-leader</p>
                            </div>
                        </div>
                        
                        <h3>1. Brief Description</h3>
                        <p>Tunisia is a critical North African transit country under intense bilateral and EU pressure to curb Mediterranean departures. While facing domestic instability, youth unemployment, and rising xenophobia, Tunisia has become a key player in externalized EU migration control. It has signed several informal agreements — including with Italy and the European Commission — exchanging technical aid for enforcement cooperation. However, Tunisia resists being formalized into long-term hosting or asylum processing roles. At the Malta Conference, it acts as a co-leader of the 🔴 Operational Sovereignty Bloc, championing national discretion, flexible partnerships, and rejection of external legal constraints.</p>

                        <h3>2. Main Objective</h3>
                        <p><strong>General mandate:</strong> Tunisia aims to extract maximum financial, political, and technical support from the EU in exchange for short-term containment efforts — while firmly rejecting legal responsibilities, public scrutiny, or any framing as a durable buffer state. It will block language implying hosting duties or third-country protection roles, while supporting vague cooperation clauses that preserve autonomy. Tunisia will coordinate closely with Poland and Libya to anchor sovereignty-first language in the final Declaration.</p>
                        <p><strong>Strategic priorities:</strong></p>
                        <ul>
                            <li>Convert migration cooperation into infrastructure support, macroeconomic aid, and diplomatic visibility.</li>
                            <li>Avoid being cast as a permanent partner for disembarkation, external asylum processing, or relocation.</li>
                            <li>Maintain full control over migration enforcement operations without judicial or NGO oversight.</li>
                        </ul>

                        <h3 style="margin-top: 20px;">3. Positions by Issue</h3>
                        <div class="round-section" style="background-color: white;">
                            <h4>🛡️ Issue 1 – Protection</h4>
                            <p>Tunisia refuses to host or process asylum seekers on behalf of Europe. Humanitarian activities may be tolerated if discreet, time-limited, and externally funded under national control.</p>
                        </div>
                        <div class="round-section" style="background-color: white;">
                            <h4>🔄 Issue 2 – Return</h4>
                            <p>Open to quiet return cooperation — especially for Tunisian nationals — in exchange for significant EU financial and diplomatic concessions. Rejects quotas, public tracking, or rights-based return frameworks.</p>
                        </div>
                        <div class="round-section" style="background-color: white;">
                            <h4>🌐 Issue 3 – Externalization and Border Management</h4>
                            <p>Supports operational partnerships with EU states and agencies as long as they remain politically negotiated, flexible, and shielded from legal review or human rights mechanisms.</p>
                        </div>
                        <div class="round-section" style="background-color: white;">
                            <h4>⚓ Issue 4 – SAR & Solidarity</h4>
                            <p>Rejects any role in regional SAR coordination, disembarkation, or relocation. Will block language linking African transit countries to EU solidarity or redistribution burdens.</p>
                        </div>

                        <h3 style="margin-top: 20px;">4. Red Lines</h3>
                        <div class="alert alert-danger">
                            <span class="alert-icon">❌</span>
                            <div><strong>No hosting or asylum processing obligations:</strong> Tunisia will not accept legal framing that implies it must shelter, process, or integrate third-country nationals. Temporary technical centers may be negotiable if clearly limited in scope and duration.</div>
                        </div>
                        <div class="alert alert-danger">
                            <span class="alert-icon">❌</span>
                            <div><strong>No legal conditionality or rights-based oversight:</strong> All cooperation must remain outside EU legal jurisdiction. Tunisia may tolerate soft reporting mechanisms if they are confidential, politically framed, and linked to funding.</div>
                        </div>
                        <div class="alert alert-danger">
                            <span class="alert-icon">❌</span>
                            <div><strong>No formal return targets or naming in EU frameworks:</strong> Tunisia cannot be portrayed as a consistent return destination. Return discussions must be bilateral, discreet, and politically managed — not institutionalized or rights-bound.</div>
                        </div>
                        <div class="alert alert-danger">
                            <span class="alert-icon">❌</span>
                            <div><strong>No public NGO involvement in enforcement roles:</strong> Migration operations are a sovereign matter. Tunisia may accept limited humanitarian roles if under government supervision, with no public advocacy or legal authority.</div>
                        </div>

                        <h3>5. Position at Malta Conference</h3>
                        <p>Tunisia will co-lead the 🔴 Operational Sovereignty Bloc, championing national sovereignty, bilateralism, and strategic non-alignment in migration governance. It will coordinate closely with Libya, Egypt, and Niger to block any EU-driven frameworks that impose binding commitments, legal oversight, or long-term containment responsibilities on partner states. Tunisia is open to selective cooperation on returns and border control, but will condition its engagement on full respect for its autonomy and tangible financial guarantees.</p>
                        <p>Tunisia will firmly resist attempts by the 🔵 Core Protection Bloc and 🟠 Humanitarian Pragmatists to frame cooperation in normative or rights-based terms that could erode its discretion. While it may tactically coordinate with the 🟡 Security Pragmatists on deterrence and containment narratives, Tunisia will reject any proposal suggesting shared asylum management or relocation obligations. Its position will be assertive, transactional, and rooted in preserving sovereign control.</p>

                        <h3>6. Negotiation Pathways</h3>
                        <p>Tunisia will employ a transactional and defensive negotiation posture, mirroring Poland’s strategy of red-line clarity and rhetorical flexibility. It will support vague or symbolic consensus language on “regional partnership” or “capacity-building” if such phrasing opens funding streams and does not imply legal responsibility. Tunisia may use the bloc’s cohesion to reject SAR, return, or externalization frameworks that exceed its interests, while quietly supporting technical formats that bolster its domestic control. Flexibility exists in timing, formats, and aid flows — not in substance, legal accountability, or long-term commitments.</p>
                    </div>
                </div>

                <!-- Senegal Tab -->
                <div id="senegal" class="tab-content">
                    <div class="content-header">
                        <h2 class="content-title">Delegation of Senegal 🇸🇳</h2>
                         <div class="content-actions">
                            <button class="btn btn-primary" onclick="viewDocument('Senegal Position Paper.pdf', 'https://drive.google.com/file/d/1KKvdQwPTbRyN3AANRSs9Hc8EZ31emTiH/preview', 'https://drive.google.com/uc?export=download&id=1KKvdQwPTbRyN3AANRSs9Hc8EZ31emTiH')">
                               📄 View Prelim. Position
                            </button>
                             <button class="btn btn-primary" onclick="viewDocument('Senegal Position Paper final.pdf', 'https://drive.google.com/file/d/1lovYTj9Dm3tuWBj-Zkz9Z4xvEnLYiDiu/preview', 'https://drive.google.com/uc?export=download&id=1lovYTj9Dm3tuWBj-Zkz9Z4xvEnLYiDiu')">
                               📄 View Final Position
                            </button>
                        </div>
                    </div>
                    <div class="key-takeaway-box">
                        <h4><span class="icon" style="font-size: 1.5rem;">🇸🇳</span>Senegal Mandate: Core Stance</h4>
                        <ul>
                            <li>Senegal, a member of the <span class="highlight-important">🔴 Operational Sovereignty Bloc</span>, prioritizes converting migration cooperation into <span class="highlight-important">sustainable development, labor mobility, and diaspora-driven investment</span>.</li>
                            <li>It firmly opposes coercive return mechanisms and any framing as a hosting/processing country for non-nationals.</li>
                            <li>Open to selective, <span class="highlight-important">dignified voluntary return cooperation</span> for its nationals, demanding fair treatment, funding, and respect for sovereignty.</li>
                            <li>Red Lines: No third-country processing/return roles, no forced/quota-based returns, no aid conditionality tied to migration control, no involvement in EU solidarity mechanisms that imply hosting.</li>
                            <li>Strategy: Constructive but firm, reframing cooperation around development and legal pathways. Will engage tactically with Humanitarian Pragmatists on mobility/reintegration.</li>
                        </ul>
                        <p class="reference">📄 Full Mandate: <a href="#" onclick="viewDocument('Senegal Mandate', 'https://drive.google.com/file/d/12ZtMDu5rfgGtt8sSX0vsDzIJZ_3up0DvItLM9rP9dcM/preview', 'https://drive.google.com/uc?export=download&id=12ZtMDu5rfgGtt8sSX0vsDzIJZ_3up0DvItLM9rP9dcM'); return false;">Senegal Mandate Document</a></p>
                    </div>
                    <div class="delegation-card senegal">
                        <div class="delegation-header">
                             <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='900' height='600'%3E%3Cpath fill='%2300853f' d='M0 0h300v600H0z'/%3E%3Cpath fill='%23fdef42' d='M300 0h300v600H300z'/%3E%3Cpath fill='%23e31b23' d='M600 0h300v600H600z'/%3E%3Cpath fill='%2300853f' d='M450 210l40.45 125.17-105.76-77.35h130.62L409.55 335.17z'/%3E%3C/svg%3E" class="delegation-flag" alt="Senegal Flag">
                            <div class="delegation-info">
                                <h2>Republic of Senegal</h2>
                                <p>Operational Sovereignty Bloc - Member</p>
                            </div>
                        </div>
                        
                        <h3>1. Brief Description</h3>
                        <p>Senegal is a key West African partner in EU migration diplomacy, known for its strategic coastal location, strong diaspora networks, and pragmatic engagement on mobility and returns. While politically stable and diplomatically active, Senegal resists being reduced to a “return country” or regional buffer. It seeks to reshape migration partnerships around ethical recruitment, legal mobility pathways, and economic development — not containment. At the Malta Conference, Senegal aligns with the 🔴 Operational Sovereignty Bloc, prioritizing bilateralism, national discretion, and dignity-centered cooperation frameworks.</p>

                        <h3>2. Main Objective</h3>
                        <p><strong>General mandate:</strong> Senegal’s goal is to convert migration cooperation into sustainable development, labor mobility, and diaspora-driven investment. It will firmly oppose any coercive return mechanisms or externalization efforts that frame Senegal as a hosting or processing country. While open to selective return cooperation, it demands fair treatment, funding, and respect for its sovereignty and public image. Senegal will advocate for migration partnerships that empower states and protect dignity, not reinforce asymmetric enforcement.</p>
                        <p><strong>Strategic priorities:</strong></p>
                        <ul>
                            <li>Reframe migration cooperation around legal pathways, skills partnerships, and ethical recruitment.</li>
                            <li>Maximize development and reintegration funding, while resisting coercive or reputationally damaging return policies.</li>
                            <li>Preserve sovereign control and public dignity in all bilateral or EU partnerships.</li>
                        </ul>

                        <h3 style="margin-top: 20px;">3. Positions by Issue</h3>
                        <div class="round-section" style="background-color: white;">
                            <h4>🛡️ Issue 1 – Protection</h4>
                            <p>Senegal does not host third-country asylum seekers and opposes being cast as a regional protection zone. It supports limited humanitarian coordination when it serves domestic stability.</p>
                        </div>
                        <div class="round-section" style="background-color: white;">
                            <h4>🔄 Issue 2 – Return</h4>
                            <p>Open to dignified, voluntary return agreements for Senegalese nationals — but not forced returns or public performance targets. Reintegration must be funded, locally rooted, and detached from naming-and-shaming practices.</p>
                        </div>
                        <div class="round-section" style="background-color: white;">
                            <h4>🌐 Issue 3 – Externalization and Border Management</h4>
                            <p>Senegal rejects being used as a buffer or offshore processing site. It may engage in discreet operational partnerships if framed around capacity-building, mutual benefit, and sovereignty.</p>
                        </div>
                        <div class="round-section" style="background-color: white;">
                            <h4>⚓ Issue 4 – SAR & Solidarity</h4>
                            <p>Not involved in SAR, but wary of language implying regional hosting duties. Supports African-led dialogue on mobility and resists being tied to EU redistribution debates.</p>
                        </div>

                        <h3 style="margin-top: 20px;">4. Red Lines</h3>
                        <div class="alert alert-danger">
                            <span class="alert-icon">❌</span>
                            <div><strong>No role as a third-country processing or return destination for non-citizens:</strong> Senegal cannot host or process asylum claims for non-Senegalese migrants. Limited, informal transit coordination may be acceptable if purely humanitarian and not politically framed.</div>
                        </div>
                        <div class="alert alert-danger">
                            <span class="alert-icon">❌</span>
                            <div><strong>No forced or quota-based returns:</strong> All returns must be voluntary, dignified, and accompanied by reintegration support. Senegal may accept return frameworks if they respect national discretion and avoid reputational damage.</div>
                        </div>
                        <div class="alert alert-danger">
                            <span class="alert-icon">❌</span>
                            <div><strong>No conditionality or legal oversight tied to aid:</strong> Migration cooperation must remain partnership-based, not compliance-driven. Soft coordination or reporting may be tolerated if managed bilaterally and framed as capacity enhancement.</div>
                        </div>
                        <div class="alert alert-danger">
                            <span class="alert-icon">❌</span>
                            <div><strong>No involvement in EU solidarity mechanisms:</strong> Senegal will not support relocation schemes or be framed as a hosting country. It may engage in regional dialogue if focused on legal migration and co-development, not enforcement redistribution.</div>
                        </div>
                        
                        <h3>5. Position at Malta Conference</h3>
                        <p>Senegal will act as a firm but constructive actor within the 🔴 Operational Sovereignty Bloc, prioritizing development-oriented cooperation, voluntary return, and rejection of externalized migration control. It will coordinate closely with Niger, Morocco, and Tunisia to block proposals implying hosting roles, legal accountability, or third-country processing mandates.</p>
                        <p>At the same time, Senegal will engage tactically with the 🟠 Humanitarian Pragmatists to promote legal mobility pathways, reintegration financing, and diaspora rights — while resisting any attempt to formalize return conditionality or link SAR mechanisms to African hosting obligations. Though it shares certain containment concerns with the 🟡 Security Pragmatists, Senegal opposes their deterrence-driven approach and rigid enforcement logic. Positioning itself as a diplomatic bridge, Senegal will seek recognition for its leadership in ethical, partnership-based migration governance. It will express caution toward the 🔵 Core Protection Bloc’s legalist framing when it risks operational burden-shifting or undermining national discretion.</p>

                        <h3>6. Negotiation Pathways</h3>
                        <p>Senegal’s negotiation strategy is based on narrative reframing and transactional pragmatism. It will oppose coercive measures but engage constructively on development-linked cooperation. Senegal may support vague declarations that reference “dignified return,” “mutual benefit,” or “skills mobility” — while rejecting conditionality, monitoring, or obligations. It will seek alignment with France or Germany on ethical recruitment, and with African Union actors on regional frameworks. Flexibility exists on implementation tools and language — not on forced returns or loss of narrative control.</p>
                    </div>
                </div>

                <!-- Blocs Tab -->
                <div id="blocs" class="tab-content">
                    <div class="content-header">
                        <h2 class="content-title">Negotiation Blocs Analysis</h2>
                    </div>
                     <div class="key-takeaway-box">
                        <h4><span class="icon" style="font-size: 1.5rem;">🧭</span>Navigating the Blocs: Strategic Considerations</h4>
                        <ul>
                            <li>The <span class="highlight-important">Blocs Composition Document</span> details four key alliances with distinct priorities. Your delegation (Tunisia/Senegal) is part of the <span class="highlight-important">🔴 Operational Sovereignty Bloc</span>.</li>
                            <li><strong>🔴 Operational Sovereignty Bloc:</strong> Focuses on national control, resisting external legal frameworks and maximizing financial/technical support for cooperation on their terms. Key for Tunisia/Senegal is to ensure this bloc doesn't concede on hosting/processing for third-country nationals.</li>
                            <li><strong>🔵 Core Protection Bloc (UNHCR, Belgium, NGOs):</strong> Advocates for rights-based approaches, robust asylum systems, and NGO involvement. Direct opposition likely on oversight and binding commitments.</li>
                            <li><strong>🟠 Humanitarian Pragmatists (France, Germany, IOM):</strong> Seeks balanced solutions, cooperative frameworks, and may be open to development-linked migration. Potential for tactical alignment with Senegal on legal mobility or with Tunisia on specific, well-funded technical projects.</li>
                            <li><strong>🟡 Security Pragmatists (Italy, Greece, Frontex):</strong> Prioritizes border control, deterrence, and rapid returns. Potential for tactical alignment on containment measures but likely clashes on SAR responsibilities and actual burden-sharing beyond financial aid.</li>
                        </ul>
                        <p class="reference">📄 Full Document: The "Composition of each block of the negotiation" document is available in the main Google Drive. (Link typically provided by organizers)</p>
                    </div>
                    <div class="alert alert-warning">
                        <span class="alert-icon">⚡</span>
                        <div>
                            <strong>Your Bloc: Operational Sovereignty</strong><br>
                            Tunisia co-leads with Poland. Senegal is a key member. Coordinate strategies with bloc allies, particularly on red lines regarding sovereignty and non-refoulement vs. non-hosting.
                        </div>
                    </div>
                    <div class="resource-grid">
                         <div class="resource-card" style="border-left: 5px solid #3b82f6;"> <!-- Blue for Core Protection -->
                            <div class="resource-icon" style="background: #dbeafe; color: #3b82f6;">🛡️</div>
                            <h4 class="resource-title" style="color: #3b82f6;">🔵 Core Protection Bloc</h4>
                            <p><strong>Members:</strong> UNHCR, Belgium, Sea-Watch, MSF, Sweden</p>
                            <p><strong>Focus:</strong> Human rights, international protection standards, robust asylum procedures, active NGO role, legal accountability for all actors.</p>
                            <p><strong>Interaction with Your Bloc:</strong> Expect strong pushback against purely transactional cooperation. They will advocate for rights monitoring in any externalization agreement and emphasize non-refoulement. Your bloc's insistence on sovereignty without oversight will be a major point of contention.</p>
                        </div>
                        <div class="resource-card" style="border-left: 5px solid #f97316;"> <!-- Orange for Humanitarian Pragmatists -->
                            <div class="resource-icon" style="background: #ffedd5; color: #f97316;">🕊️</div>
                            <h4 class="resource-title" style="color: #f97316;">🟠 Humanitarian Pragmatists Bloc</h4>
                            <p><strong>Members:</strong> France, Germany, Spain, IOM, Netherlands</p>
                            <p><strong>Focus:</strong> Balancing protection needs with effective migration management. Open to legal pathways, development cooperation, and capacity building. Seek "win-win" solutions.</p>
                            <p><strong>Interaction with Your Bloc:</strong> Senegal might find common ground on legal mobility/skills partnerships. Tunisia could negotiate technical/financial aid for specific, controlled projects. However, this bloc will likely push for some level of conditionality or "soft" oversight, which needs careful navigation by your bloc.</p>
                        </div>
                        <div class="resource-card" style="border-left: 5px solid #eab308;"> <!-- Yellow for Security Pragmatists -->
                            <div class="resource-icon" style="background: #fef9c3; color: #eab308;">🚧</div>
                            <h4 class="resource-title" style="color: #eab308;">🟡 Security Pragmatists Bloc</h4>
                            <p><strong>Members:</strong> Italy, Greece, United Kingdom, Frontex, Morocco, Serbia</p>
                            <p><strong>Focus:</strong> Border security, deterrence of irregular migration, rapid returns, combating smuggling networks. Emphasis on operational control.</p>
                            <p><strong>Interaction with Your Bloc:</strong> Tactical alignment on containment narratives and border control cooperation is possible. However, this bloc may pressure your countries to accept more direct roles in returns or disembarkation, which conflicts with your red lines. Be wary of burden-shifting disguised as security cooperation.</p>
                        </div>
                        <div class="resource-card" style="border-left: 5px solid var(--danger-color);"> <!-- Red for Operational Sovereignty -->
                            <div class="resource-icon" style="background: #fee2e2; color: var(--danger-color);">🚩</div>
                            <h4 class="resource-title" style="color: var(--danger-color);">🔴 Operational Sovereignty Bloc</h4>
                            <p><strong>Members:</strong> Poland (Leader), Tunisia (Co-leader), Libya, Egypt, Niger, Senegal</p>
                            <p><strong>Focus:</strong> Absolute defense of national sovereignty, state control over migration policies, rejection of supranational oversight or binding legal commitments imposed externally.</p>
                            <p><strong>Internal Strategy Considerations:</strong></p>
                            <ul>
                                <li>Maintain unified front on rejecting third-country hosting/processing.</li>
                                <li>Frame cooperation as partnerships of equals, demanding tangible benefits (financial, technical, political).</li>
                                <li>Use bloc's collective weight to resist pressure for unwanted responsibilities (e.g., SAR zones, return quotas for non-nationals).</li>
                                <li>Exploit differences between other blocs to advance sovereignty agenda.</li>
                            </ul>
                        </div>
                    </div>
                    <div class="round-section">
                        <h4>Key Members of the Operational Sovereignty Bloc:</h4>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-label">Poland 🇵🇱 (Leader)</div>
                                <div class="stat-value" style="font-size: 1.2rem;">Resists EU pressure, champions national sovereignty, skeptical of collective EU migration solutions.</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Tunisia 🇹🇳 (Co-leader)</div>
                                <div class="stat-value" style="font-size: 1.2rem;">Rejects "buffer state" role, seeks financial/technical support for containment on its own terms.</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Libya 🇱🇾</div>
                                <div class="stat-value" style="font-size: 1.2rem;">Focus on sovereignty over coasts, resists external interference, complex internal dynamics.</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Egypt 🇪🇬</div>
                                <div class="stat-value" style="font-size: 1.2rem;">Emphasizes state control over migration, security concerns, major regional player.</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Niger 🇳🇪</div>
                                <div class="stat-value" style="font-size: 1.2rem;">Key transit country, resists externalization pressures without significant development aid, security challenges.</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Senegal 🇸🇳</div>
                                <div class="stat-value" style="font-size: 1.2rem;">Focus on development, legal mobility, dignified returns for nationals, strong diaspora engagement.</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Round 1 Tab -->
                <div id="round1" class="tab-content">
                    <div class="content-header">
                        <h2 class="content-title">Round 1: Information Management & Positioning (Concluded)</h2>
                    </div>
                     <div class="alert alert-success"> 
                        <span class="alert-icon">✅</span>
                        <div>
                            <strong>Round 1 (May 23rd) has concluded.</strong><br>
                            This tab provides a record of activities, deliverables, and AI prompts used during this round.
                        </div>
                    </div>
                    <div class="round-section">
                        <div class="round-header">
                            <div class="round-title"><span class="round-number">1.1</span>Launch and Initial Positioning (14:00 - 15:45)</div>
                        </div>
                        <h4>1.1.1 Official Opening Ceremony (14:00 - 14:20)</h4>
                        <p>Maltese Presidency opens the Dialogue with a speech. Text distributed via Google Drive.</p>
                        <p><a href="#" class="btn btn-secondary btn-sm" onclick="viewDocument('OPENING SPEECH R1.pdf', 'https://drive.google.com/file/d/1tZLYs8NmShzHNv-Sz8miZvIw1lgS2ktO/preview', 'https://drive.google.com/uc?export=download&id=1tZLYs8NmShzHNv-Sz8miZvIw1lgS2ktO')">📄 View Maltese Presidency Speech</a></p>
                        <div class="ai-assistant-box">
                            <h5>🤖 AI Prompts for Speech Analysis:</h5>
                            <div class="ai-prompt" data-gpt-type="Position Analyst">
                                <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                                <span>1. Upload the Maltese Presidency's speech to the AI Assistant.
2. Prompt: "Analyze this speech from the perspective of [Tunisia/Senegal], highlighting key phrases, objectives, and potential implications for our delegation's mandate (refer to uploaded mandate document). What are the main negotiation points or challenges signaled by the Presidency?"
3. Prompt: "Based on this speech and our mandate, suggest 2-3 initial questions or points of clarification we might consider raising (internally or externally) regarding the Presidency's vision."</span>
                            </div>
                        </div>

                        <h4>1.1.2 Analysis of Technical Dossier (14:20 - 14:45)</h4>
                        <p>Teams receive the full technical dossier and conduct internal analysis.</p>
                        <p><a href="#" class="btn btn-secondary btn-sm" onclick="viewDocument('TECHNICAL FILE.pdf', 'https://drive.google.com/file/d/1cdi3F_rttb1gSyrY47Pp7du8PzRN9NfN/preview', 'https://drive.google.com/uc?export=download&id=1cdi3F_rttb1gSyrY47Pp7du8PzRN9NfN')">📄 View Technical File</a></p>
                         <div class="ai-assistant-box">
                             <h5>🤖 AI Prompts for Dossier Analysis:</h5>
                            <div class="ai-prompt" data-gpt-type="Position Analyst">
                                <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                                <span>1. Upload the Technical Dossier to the AI Assistant.
2. Prompt: "Summarize the 5 most critical findings in this Technical Dossier that directly impact [Tunisia/Senegal]'s negotiation strategy for the Malta Dialogue, considering our mandate."
3. Prompt: "Identify any data or statements in the Technical Dossier that [Tunisia/Senegal] could leverage to support our key objectives or counter potential unfavorable proposals regarding [e.g., returns, border management, funding, legal pathways]."</span>
                            </div>
                        </div>
                        
                        <h4>1.1.3 Drafting Preliminary Position Papers (14:45 - 15:15)</h4>
                        <p>Each delegation drafts a Preliminary Position Paper. No contact yet with other teams. Work individually.</p>
                        <div class="deliverable-section">
                            <div class="deliverable-header">
                                <span class="deliverable-title">📄 Preliminary Position Paper</span>
                                <span class="deliverable-status" id="preliminaryPositionStatus_R1">
                                    <!-- Status rendered by JS -->
                                </span>
                            </div>
                            <div id="preliminaryPositionUploadArea_R1">
                                <!-- Upload area will be rendered here by JS -->
                            </div>
                             <div class="ai-assistant-box">
                                 <h5>🤖 AI Prompts for Drafting Preliminary Position Paper:</h5>
                                <div class="ai-prompt" data-gpt-type="Position Analyst">
                                    <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                                    <span>1. Prompt: "Based on [Tunisia/Senegal]'s mandate, the Presidency's speech, and the Technical Dossier, help draft a Preliminary Position Paper. The paper should clearly state our core objectives and initial stance on the four fundamental issues of the simulation (Protection, Return, Externalization, SAR/Solidarity). Explicitly define our red lines for each issue."
2. Prompt: "Review this draft Preliminary Position Paper for [Tunisia/Senegal]. Ensure it aligns with our mandate, is diplomatically worded yet firm on red lines, and addresses the key points from the Presidency's speech and Technical Dossier. Suggest improvements for clarity and impact."</span>
                                </div>
                            </div>
                        </div>

                        <h4>1.1.4 First Informal Exchanges and Coalition Mapping (15:15 - 15:45)</h4>
                        <p>Informal breakout rooms opened. Delegations are free to meet other teams. Objective: explore alliances, common interests, or divergences. No binding deals yet.</p>
                        <div class="ai-assistant-box">
                             <h5>🤖 AI Prompts for Coalition Mapping:</h5>
                            <div class="ai-prompt" data-gpt-type="Position Analyst / Network Strategist">
                                <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                                <span>1. (After obtaining some initial intel or position papers from potential allies) Upload the preliminary position papers/stated interests of 2-3 potential allies within our bloc (Operational Sovereignty) or key pragmatic delegations.
2. Prompt: "Analyze the points of convergence and divergence between [Tunisia/Senegal]'s preliminary position and these uploaded documents/statements. Identify specific areas for potential joint statements or coordinated action. What are the 'Islands of Agreement' we can build upon?" (Reference Iceberg/CSS tool if applicable)
3. Prompt: "Based on this initial mapping, suggest key questions [Tunisia/Senegal] should ask [Delegation X] and [Delegation Y] in informal talks to gauge alignment and potential for cooperation."</span>
                            </div>
                        </div>
                    </div>

                    <div class="round-section">
                        <div class="round-header">
                            <div class="round-title"><span class="round-number" style="background: var(--danger-color);">1.2</span>Crisis Emerges – Testing Positions and Stability (15:45 - 17:00)</div>
                        </div>
                        <h4>1.2.1 Crisis (15:45)</h4>
                        <p>All teams receive a “Breaking News” media alert revealing sensitive information.
                           <br><a href="https://drive.google.com/file/d/1rI26h83uob50MOgKlhKZy6Iv7Rff6z1J/preview" target="_blank" class="btn btn-danger btn-sm">📄 Download Crisis Report</a>
                        </p>
                        <div class="ai-assistant-box">
                            <h5>🤖 AI Prompts for Crisis Analysis:</h5>
                            <div class="ai-prompt" data-gpt-type="Position Analyst">
                                <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                                <span>1. Upload the "Breaking News" crisis report to the AI Assistant.
2. Prompt: "Analyze this crisis report from [Tunisia/Senegal]'s perspective. How does this news impact our preliminary position, stated objectives, and red lines? What are the immediate risks and opportunities for our delegation? Does this strengthen or weaken our negotiation leverage on any of the four core issues?"
3. Prompt: "Suggest 2-3 key adjustments [Tunisia/Senegal] should consider for our Final Position Paper in light of this crisis. How should we frame our response to this crisis publicly and in negotiations?"</span>
                            </div>
                        </div>

                        <h4>1.2.2 Reassessment with allies (16:00 - 16:20)</h4>
                        <p>Allies urgently reassess their positions. Discussion in breakout rooms with allies.</p>
                        
                        <h4>1.2.3 Presidency Intervention: Call for Structured Dialogue (16:20 - 16:50)</h4>
                        <p>The Maltese Presidency intervenes publicly, urging all delegations to submit a formal response by the end of Round 1.</p>
                         <div class="ai-assistant-box">
                             <h5>🤖 AI Prompts for Drafting Final Position Paper (Post-Crisis):</h5>
                            <div class="ai-prompt" data-gpt-type="Position Analyst">
                                <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                                <span>1. (After discussions with allies) Prompt: "Integrate the outcomes of discussions with our allies regarding the crisis. Now, help redraft [Tunisia/Senegal]'s Preliminary Position Paper into a Final Position Paper. This final version must address the crisis, reflect any shifts in our strategy, and clearly reiterate our stance on the four core issues and our red lines."
2. Prompt: "Review this draft Final Position Paper for [Tunisia/Senegal]. Does it effectively address the crisis while upholding our mandate? Is the tone appropriate? Are there any remaining ambiguities or weaknesses? Suggest specific wording changes for strength and clarity."</span>
                            </div>
                        </div>

                        <h4>1.2.4 Delivery of Final Position Papers (16:50 - 17:00)</h4>
                        <p>Each team finalizes its document, outlining its core positions on the Declaration of Principles, its reaction to the media leak, and how this development reshapes its stance within the Dialogue.</p>
                        <div class="deliverable-section">
                            <div class="deliverable-header">
                                <span class="deliverable-title">📄 Final Updated Position Paper</span>
                                 <span class="deliverable-status" id="finalPositionStatus_R1">
                                    <!-- Status rendered by JS -->
                                </span>
                            </div>
                            <div id="finalPositionUploadArea_R1">
                                <!-- Upload area will be rendered here by JS -->
                            </div>
                        </div>
                        <div class="alert alert-info" style="margin-top: 15px;">
                           <span class="alert-icon">💡</span> 
                           <strong>AI Note for Round 1:</strong> The AI Assistant focused on "Position & Interest Analyst" (using tools like Island of Agreements, Icebergs, CSS - as per 'Instructions For Icebergs and CSS_New.pdf') will be most appropriate. Ensure your AI is primed with your mandate and foundational documents.
                        </div>
                    </div>
                     <div class="round-section">
                        <h4 style="margin-bottom: 15px;">📝 Negotiation Notes for Round 1</h4>
                        <textarea id="round1Notes" style="width: 100%; min-height: 200px; padding: 15px; border: 1px solid var(--border-color); border-radius: 8px; font-family: inherit; font-size: 0.95rem;" placeholder="Record key points from informal meetings, potential alliances, crisis impact, and strategies for the final position paper..."></textarea>
                        <button class="btn btn-secondary" style="margin-top: 10px;" onclick="saveNotes('round1')">
                            💾 Save Notes
                        </button>
                    </div>
                </div>

                <!-- Round 2 Tab -->
                <div id="round2" class="tab-content">
                    <div class="content-header">
                        <h2 class="content-title">Round 2: Strategic Negotiation & Drafting</h2>
                    </div>
                     <div class="alert alert-info">
                        <span class="alert-icon">ℹ️</span>
                        <div>
                            <strong>Round 2 (May 24th, 09:00 - 12:00 CEST). Active now.</strong><br>
                            Focus on analyzing the Draft Declaration and preparing amendments.
                        </div>
                    </div>
                    <div class="round-section">
                        <div class="round-header">
                            <div class="round-title"><span class="round-number">2.1</span>Reading Position Papers & Draft Declaration (09:10 - 09:45)</div>
                        </div>
                        <h4>2.1.1 Consultation of Position Papers of Potential Targets (09:10 - 09:30)</h4>
                        <p>Teams analyze the Final Position Papers from Round 1 (downloaded from Google Drive) to identify potential allies and areas for compromise. No debate occurs at this stage; the focus is on mapping others’ strategies, red lines, and possible engagement targets.
                             <br><a href="#" class="btn btn-sm btn-secondary" style="margin-top:5px
							 onclick="viewDocument('MERGED Final position papers from R1.pdf', 'https://drive.google.com/file/d/1BsXa6oEOjkJd7ECZepWUECFsxBQy7z8x/preview', 'https://drive.google.com/uc?export=download&id=1BsXa6oEOjkJd7ECZepWUECFsxBQy7z8x')">📄 View Merged R1 Position Papers</a>
                        </p>
                        <div class="ai-assistant-box">
                            <h5>🤖 AI Prompts for Analyzing Positions:</h5>
                            <div class="ai-prompt" data-gpt-type="Network Strategist">
                                <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                                <span>1. Upload to the AI Assistant the Final Position Papers of 3-4 key delegations (allies, potential allies, and key opponents) from the "MERGED Final position papers from R1.pdf".
2. Prompt: "Analyze these selected position papers in relation to [Tunisia/Senegal]'s Final Position Paper (also in the merged document). Identify: a) Strongest allies and on which specific points. b) Delegations with potential for compromise and on what issues. c) Key opposing delegations and their main points of contention with us. Use 'Island of Agreements', 'Iceberg', and 'CSS' analysis where appropriate. (Reference 'Instructions for Stakeholder Analysis.pdf' & 'Instructions For Icebergs and CSS_New.pdf')"
3. Prompt: "Based on this analysis, suggest a network strategy for [Tunisia/Senegal] for Round 2. Which delegations should we prioritize engaging with, and what should be our primary objective with each (e.g., reinforce alliance, seek compromise, neutralize opposition)? Which of their red lines are most critical to acknowledge?"</span>
                            </div>
                        </div>

                        <h4>2.1.2 Communication of a proposed Draft Declaration of Principle by the Presidency (09:30 - 09:45)</h4>
                        <p>Each team receives a Draft Declaration of Principles (Fundamental Principles – NON-negotiable; Operational Principles – open to negotiation). Teams assess alignment with their interests.
                            <br><a href="#" class="btn btn-sm btn-secondary" style="margin-top:5px;" onclick="viewDocument('Draft Declaration of Principles.pdf', 'https://drive.google.com/file/d/1ug3jAWBeVW6pzsBWdTw6h6gwrV1EGjiT/preview', 'https://drive.google.com/uc?export=download&id=1ug3jAWBeVW6pzsBWdTw6h6gwrV1EGjiT')">📄 View Draft Declaration</a>
                        </p>
                        <div class="ai-assistant-box">
                            <h5>🤖 AI Prompts for Draft Declaration Analysis:</h5>
                            <div class="ai-prompt" data-gpt-type="Network Strategist">
                                <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                                <span>1. Upload the Presidency's "Draft Declaration of Principles.pdf".
2. Prompt: "Analyze this Draft Declaration from [Tunisia/Senegal]'s perspective. Which operational principles align with our interests and Final Position Paper? Which ones conflict with our red lines or objectives? Identify specific clauses that require amendment, referencing our mandate."
3. Prompt: "For the conflicting operational principles, propose initial amendment language that would make them acceptable to [Tunisia/Senegal], while still being potentially palatable to a wider group. Consider our network strategy and the positions of other key delegations from the 'MERGED Final position papers from R1.pdf'."</span>
                            </div>
                        </div>
                    </div>

                    <div class="round-section">
                        <div class="round-header">
                            <div class="round-title"><span class="round-number">2.2</span>Negotiation Starts (09:45 - 11:00)</div>
                        </div>
                        <h4>2.2.1 Negotiation Starts: Prioritization of Issues (09:45 - 10:00)</h4>
                        <p>Each team evaluates the Draft Declaration and identifies critical thematic issues to strengthen. Internal ranking by priority (not submitted).</p>
                        <div class="ai-assistant-box">
                             <h5>🤖 AI Prompts for Prioritization:</h5>
                            <div class="ai-prompt" data-gpt-type="Network Strategist">
                                <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                                <span>1. Prompt: "Based on our previous analysis of the Draft Declaration and our mandate, help [Tunisia/Senegal] prioritize the top 3-5 operational principles or clauses for amendment. For each, briefly state why it's a priority (e.g., violates red line, significantly impacts interests, high potential for favorable outcome). Which of these priorities might be shared with our Operational Sovereignty Bloc allies?"</span>
                            </div>
                        </div>
                        
                        <h4>2.2.2 Direct Negotiations Between Delegations (10:00 - 11:00)</h4>
                        <p>Teams engage in direct negotiations in breakout rooms. Discussions guided by ranked priorities. Alliances and joint strategies may take new forms. Focus: What can be amended? What can be supported jointly?</p>
                         <div class="alert alert-danger" style="margin-top: 10px;">
                            <span class="alert-icon">🚫</span> <strong>No AI during live negotiations.</strong> Take detailed notes to update AI assistant afterwards.
                        </div>
                        <div class="ai-assistant-box">
                            <h5>🤖 AI Prompts (Post-Negotiation Analysis):</h5>
                            <div class="ai-prompt" data-gpt-type="Network Strategist">
                                <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                                <span>1. (After negotiations) Prompt: "We just held negotiations with [Delegation A] and [Delegation B]. Key outcomes: [Summarize key agreements, disagreements, new intel, concessions made/received]. How does this affect our prioritization and amendment strategy for the Draft Declaration? Should we adjust our network strategy or bloc coordination? Are there new 'Islands of Agreement' or 'Icebergs' to consider, or have existing ones shifted?"
2. Prompt: "Based on these direct negotiations, refine the proposed amendment language for [Specific Clause X] to increase its chances of acceptance, potentially by co-sponsoring with [Delegation A]. What arguments were most persuasive or met with most resistance?"</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="round-section">
                        <div class="round-header">
                             <div class="round-title"><span class="round-number">2.3</span>Drafting and Submitting Amendments (11:00 - 12:00)</div>
                        </div>
                        <h4>2.3.1 Drafting of Amendment Proposals (11:00 - 12:00)</h4>
                        <p>Teams (alone or jointly) draft concrete amendment proposals to improve the Declaration. Each proposal includes: Identification (Principles 1 or 2), Current Wording (optional excerpt), Proposed New Wording (exact replacement text), Rationale (short justification), Endorsements (optional co-signatories).
                           <br><a href="#" class="btn btn-sm btn-secondary" style="margin-top:5px;" onclick="viewDocument('Amendments instructions.pdf', 'https://drive.google.com/file/d/13vCqKyJpUXO-KIetJEjSnyUUXHZB1fXQ/preview', 'https://drive.google.com/uc?export=download&id=13vCqKyJpUXO-KIetJEjSnyUUXHZB1fXQ')">📄 View Amendment Instructions</a>
                        </p>
                        <div class="ai-assistant-box">
                            <h5>🤖 AI Prompts for Drafting Amendments:</h5>
                            <div class="ai-prompt" data-gpt-type="Network Strategist / Legal Drafter">
                                <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                                <span>1. Prompt: "Help [Tunisia/Senegal] draft formal amendment proposals for the following clauses in the Draft Declaration: [List clauses]. For each, provide: a) Current Wording (if helpful to show contrast), b) Proposed New Wording (precise, diplomatic, and actionable language consistent with our mandate), c) Rationale (concise justification based on our interests, red lines, and potential shared benefits for other delegations), d) Suggested Endorsers (based on network analysis and prior negotiations)."
2. Prompt: "Review these draft amendments. Are they legally sound (within the simulation's context and international principles)? Is the language clear and unambiguous? Do they effectively address our concerns without being overly confrontational? Suggest improvements for strength and clarity, ensuring alignment with the 'Amendments instructions.pdf'."
3. Prompt: "For a particularly contentious amendment, help us develop a 'Plan B' wording that is a slight compromise but still achieves a core part of our objective for that clause."</span>
                            </div>
                        </div>

                        <h4>2.3.2 Submission of Amendment Proposals (Deadline: 12:00)</h4>
                        <p>Teams upload or submit their amendment proposals by the stated deadline. Can submit as individual delegations or co-submit with others.</p>
                         <div class="deliverable-section">
                            <div class="deliverable-header">
                                <span class="deliverable-title">📄 Final Amendment Proposals</span>
                                 <span class="deliverable-status" id="amendmentProposalsStatus_R2">
                                    <!-- Status rendered by JS -->
                                </span>
                            </div>
                           <div id="amendmentProposalsUploadArea_R2">
                                <!-- Upload area will be rendered here by JS -->
                            </div>
                        </div>
                        <div class="alert alert-info" style="margin-top: 15px;">
                           <span class="alert-icon">💡</span> 
                           <strong>AI Note for Round 2:</strong> The AI Assistant focused on "Network & Influence Strategist" will be crucial. Utilize its capabilities for stakeholder mapping, analyzing positions, and drafting precise amendments. (Reference 'Instructions for Stakeholder Analysis.pdf' and 'Amendments instructions.pdf')
                        </div>
                    </div>
                     <div class="round-section">
                        <h4 style="margin-bottom: 15px;">📝 Negotiation Notes for Round 2</h4>
                        <textarea id="round2Notes" style="width: 100%; min-height: 200px; padding: 15px; border: 1px solid var(--border-color); border-radius: 8px; font-family: inherit; font-size: 0.95rem;" placeholder="Record outcomes of direct negotiations, proposed amendments, coalition strategies, and potential compromises..."></textarea>
                        <button class="btn btn-secondary" style="margin-top: 10px;" onclick="saveNotes('round2')">
                            💾 Save Notes
                        </button>
                    </div>
                </div>

                <!-- Round 3 Tab -->
                <div id="round3" class="tab-content">
                    <div class="content-header">
                        <h2 class="content-title">Round 3: Public Communication</h2>
                    </div>
                     <div class="alert alert-info">
                        <span class="alert-icon">ℹ️</span>
                        <div>
                            <strong>Round 3 (May 24th, 13:00 - 16:00 CEST). Upcoming.</strong><br>
                            Focus on analyzing the Final Declaration and preparing public statements.
                        </div>
                    </div>
                    <div class="round-section">
                        <div class="round-header">
                            <div class="round-title"><span class="round-number">3.1</span>Publication of the Final "Declaration of Principle" (13:00 - 13:30)</div>
                        </div>
                        <p>The Presidency publishes the Final Declaration of Principles (reflecting some amendments). Teams review and note which priorities were addressed/pushed aside. (Document would be available on Google Drive)</p>
                        <div class="ai-assistant-box">
                            <h5>🤖 AI Prompts for Analyzing Final Declaration:</h5>
                            <div class="ai-prompt" data-gpt-type="Communicator/Analyst">
                                <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                                <span>1. (Once available) Upload the Final Declaration of Principles.
2. Prompt: "Compare this Final Declaration with [Tunisia/Senegal]'s Final Position Paper and our submitted amendments. Identify: a) Which of our key priorities and red lines were successfully reflected (point to specific clauses)? b) Which were not addressed or were compromised (and how)? c) What are the main 'wins' and 'losses' for our delegation? Who were the key actors in achieving these outcomes?"
3. Prompt: "Overall, how should [Tunisia/Senegal] evaluate our success in this negotiation based on the Final Declaration? What is the net impact on our delegation's interests and regional standing (as per our mandate)? Provide a balanced assessment."</span>
                            </div>
                        </div>
                    </div>
                    <div class="round-section">
                        <div class="round-header">
                            <div class="round-title"><span class="round-number">3.2</span>Preparation of Official Delegation Statements (13:30 - 14:00)</div>
                        </div>
                        <h4>3.2.1 Preparation of Official Delegation Statements</h4>
                        <p>Each delegation prepares a written official statement (position: endorse, endorse with reservations, reject) and a 5-minute press conference speech summarizing their public position.</p>
                        <div class="ai-assistant-box">
                             <h5>🤖 AI Prompts for Crafting Statements & Speech:</h5>
                            <div class="ai-prompt" data-gpt-type="Communicator">
                                <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                                <span>1. Prompt: "Based on our analysis of the Final Declaration, help [Tunisia/Senegal] develop a public communication strategy. Should we endorse, endorse with reservations, or reject the Declaration? Justify this stance with specific references to the Declaration text and our mandate."
2. Prompt: "Draft a written official statement for [Tunisia/Senegal] that reflects this stance. Highlight our contributions and positive aspects (if any), clearly state any reservations or points of disagreement, and outline our future intentions or expectations regarding the Declaration's implementation. Ensure it adheres to diplomatic language (see CCHN Field Manual for principles)."
3. Prompt: "Draft a compelling 5-minute press conference speech for [Tunisia/Senegal] based on the written statement. The speech should be impactful, clear, and manage reputational risks. What are the key messages to deliver to the public and international community? How can we frame our participation positively, even if some objectives weren't met?"
4. Prompt: "Anticipate 3-5 difficult questions journalists might ask [Tunisia/Senegal] during the Q&A based on the Final Declaration, our stance, and our known red lines/objectives. For each, suggest a concise, strategic, and defensible response. Consider questions about compromises made or specific contentious issues."</span>
                            </div>
                        </div>
                        <h4>3.2.2 Submission and Publication of Written Statements (Deadline: 14:00)</h4>
                        <p>Teams upload their statements by the deadline.</p>
                        <div class="deliverable-section">
                            <div class="deliverable-header">
                                <span class="deliverable-title">📄 Final Written Statement</span>
                                 <span class="deliverable-status" id="writtenStatementStatus_R3">
                                    <!-- Status rendered by JS -->
                                </span>
                            </div>
                            <div id="writtenStatementUploadArea_R3">
                                <!-- Upload area will be rendered here by JS -->
                            </div>
                        </div>
                    </div>
                     <div class="round-section">
                        <div class="round-header">
                            <div class="round-title"><span class="round-number">3.3</span>Press conference and Q&A (14:00 - 16:00)</div>
                        </div>
                        <h4>3.3.1 Press Conference and Q&A</h4>
                        <p>Each team delivers its 5-minute press speech live (Zoom). After the speech, journalists (role-played by organizers or selected participants) pose questions to each delegation. The tone simulates a real international press environment.</p>
                         <div class="alert alert-danger" style="margin-top: 10px;">
                            <span class="alert-icon">🚫</span> <strong>No AI during the live press conference.</strong> Rely on your preparation.
                        </div>
                    </div>
                     <div class="round-section">
                        <h4 style="margin-bottom: 15px;">📝 Notes for Round 3 (Press Conference Prep)</h4>
                        <textarea id="round3Notes" style="width: 100%; min-height: 200px; padding: 15px; border: 1px solid var(--border-color); border-radius: 8px; font-family: inherit; font-size: 0.95rem;" placeholder="Draft key talking points for press statement, anticipate difficult questions, and outline responses..."></textarea>
                        <button class="btn btn-secondary" style="margin-top: 10px;" onclick="saveNotes('round3')">
                            💾 Save Notes
                        </button>
                    </div>
                </div>
                <!-- AI Assistant Guide Tab -->
                <div id="ai-assistant" class="tab-content">
                    <div class="content-header">
                        <h2 class="content-title">AI Assistant Guide</h2>
                    </div>
                    <div class="alert alert-info">
                        <span class="alert-icon">🤖</span>
                        <div>
                            <strong>AI Usage Guidelines</strong><br>
                            AI is a powerful support tool for analysis, drafting, and strategy. Your diplomatic judgment, critical thinking, and ethical considerations are paramount. <strong>Do not use AI during direct, live negotiations or the live press conference Q&A.</strong> Use it for preparation, analysis between sessions, and debriefing. Ensure your OpenAI API Key is correctly set in the portal script for the chat widget.
                        </div>
                    </div>
                    
                    <div class="round-section">
                        <h3>Initial Setup of Your Custom AI Assistant (e.g., Custom GPT)</h3>
                        <p>To effectively leverage your AI assistant, it's crucial to provide it with a strong foundational knowledge base. Upload or prime your AI with the following documents (links available in the Documents Hub):</p>
                        <div class="resource-grid" style="grid-template-columns: 1fr 1fr; margin-top:15px;">
                            <div class="resource-card">
                                <div class="resource-icon" style="font-size: 1.5rem;">📚</div>
                                <h4 class="resource-title">Core Simulation Documents:</h4>
                                <ul style="list-style-type: disc; margin-left:20px; font-size:0.9rem;">
                                    <li>Backgrounder for the Malta Dialogue</li>
                                    <li>Your Specific Delegation Mandate (Tunisia or Senegal)</li>
                                    <li>Composition of Negotiation Blocs</li>
                                    <li>TECHNICAL FILE.pdf</li>
                                    <li>OPENING SPEECH R1.pdf</li>
                                    <li>MERGED Final position papers from R1.pdf (for R2 onwards)</li>
                                    <li>Draft Declaration of Principles.pdf (for R2 onwards)</li>
                                </ul>
                            </div>
                            <div class="resource-card">
                                <div class="resource-icon" style="font-size: 1.5rem;">🛠️</div>
                                <h4 class="resource-title">Methodology & Support Docs:</h4>
                                 <ul style="list-style-type: disc; margin-left:20px; font-size:0.9rem;">
                                    <li>Instructions for Setting Up an AI Assistant...Complex Environments</li>
                                    <li>Instructions For Icebergs and CSS_New.pdf</li>
                                    <li>Instructions for Stakeholder Analysis.pdf</li>
                                    <li>CCHN Field Manual (for general negotiation principles)</li>
                                    <li>Amendments instructions.pdf (for R2)</li>
                                </ul>
                            </div>
                        </div>
                        <p style="margin-top:15px;">These documents provide the core context. As the simulation progresses, feed your AI new key documents like crisis reports (if any more appear) and final declarations.</p>
                    </div>

                    <h3>AI Approaches by Round (or separate GPTs if preferred)</h3>
                     <div class="resource-grid">
                        <div class="resource-card">
                            <div class="resource-icon" style="background: #dbeafe; color: #2563eb;">📊</div>
                            <h4 class="resource-title">AI Focus 1: Position & Interest Analyst</h4>
                            <p class="resource-description"><strong>Core Instructions/Tools:</strong> Primed with mandate, backgrounder, technical file. Utilizes concepts from "Instructions For Icebergs and CSS_New.pdf".<br>
                            <strong>Main Use:</strong> Round 1 preparation & initial document analysis.<br>
                            <strong>Tasks:</strong> Analyzes opening speeches, technical dossiers, crisis reports. Identifies convergences/divergences (Islands of Agreement), maps underlying interests (Icebergs). Drafts initial and final position papers for Round 1.
                            <br><strong>For Tunisia:</strong> Focus on sovereignty arguments, financial/technical support needs, resisting hosting obligations, leveraging bloc position.
                            <br><strong>For Senegal:</strong> Focus on development links, legal mobility, dignified returns, diaspora engagement, constructive but firm positioning.
                            </p>
                        </div>
                        <div class="resource-card">
                            <div class="resource-icon" style="background: #fef3c7; color: #d97706;">🤝</div>
                            <h4 class="resource-title">AI Focus 2: Network & Influence Strategist</h4>
                             <p class="resource-description"><strong>Core Instructions/Tools:</strong> Primed with all position papers (own and others as they become available), draft declarations. Utilizes concepts from "Instructions for Stakeholder Analysis.pdf" and "Amendments instructions.pdf".<br>
                            <strong>Main Use:</strong> Round 2 analysis & drafting amendments.<br>
                            <strong>Tasks:</strong> Maps stakeholder relationships, identifies key influencers, develops coalition-building strategies, drafts precise amendments to the Draft Declaration, anticipates counter-arguments.
                            <br><strong>For Tunisia:</strong> Identify allies for sovereignty positions, strategize on countering pressures for legal commitments, formulate amendments that secure aid without compromising autonomy.
                            <br><strong>For Senegal:</strong> Find partners for legal mobility initiatives, ensure return cooperation is beneficial and dignified, draft amendments that promote development-centric solutions.
                            </p>
                        </div>
                         <div class="resource-card">
                            <div class="resource-icon" style="background: #d1fae5; color: #059669;">📢</div>
                            <h4 class="resource-title">AI Focus 3: Crisis Communicator & Speechwriter</h4>
                             <p class="resource-description"><strong>Core Instructions/Tools:</strong> Primed with crisis reports (if any), final declaration outcomes, CCHN Field Manual communication principles.<br>
                            <strong>Main Use:</strong> Responding to crises (if new ones arise), Round 3 public statements and press conference preparation.<br>
                            <strong>Tasks:</strong> Analyzes impact of final declaration on reputation and objectives, drafts press statements, crafts speeches, prepares for Q&A by anticipating tough questions and formulating strategic, evidence-based answers.
                            <br><strong>For Tunisia/Senegal:</strong> Frame national position positively, manage reputational risks from crisis or unfavorable declaration clauses, articulate successes and reservations clearly, highlight contributions to the dialogue.
                            </p>
                        </div>
                    </div>

                    <div class="ai-assistant-box" style="border-color: var(--success-color); border-left-color: var(--success-color);">
                        <h5 style="color: var(--success-color);"><span class="icon">💡</span>Best Practices for AI Interaction</h5>
                        <ul>
                            <li><strong>Maintain Context with Continuous Chats:</strong> For each AI focus/GPT, use one continuous chat session. This helps the AI remember previous interactions and build upon them. Avoid starting new chats for the same task unless the AI gets stuck.</li>
                            <li><strong>Iterative Prompting:</strong> Start with broad requests, then refine with more specific follow-up prompts. Example: "Summarize this document" -> "Now, from Tunisia's perspective, what are the 3 main concerns?" -> "Draft a statement addressing these concerns."</li>
                            <li><strong>Role-Play with the AI:</strong> Instruct the AI to adopt the persona of your delegation. E.g., "You are the lead negotiator for Senegal. Review this proposal..."</li>
                            <li><strong>Provide Explicit Instructions for Format:</strong> If you need a list, a table, or specific sections in a document, tell the AI. E.g., "Provide the answer as a bulleted list." "Draft the position paper with these sections: Intro, Issue 1, Issue 2..."</li>
                            <li><strong>Upload Strategically:</strong> When uploading multiple documents, guide the AI on how to use them. E.g., "Use Document A as our primary mandate, and compare it against proposals in Document B and C." For lengthy documents, consider summarizing key sections yourself first if feasible, or ask the AI to focus on specific page ranges/chapters. If using a platform that doesn't support uploads, copy-paste relevant text sections.</li>
                            <li><strong>Critically Evaluate AI Output:</strong> Always review and critically assess the AI's suggestions. It's a tool, not a replacement for your judgment. Check for accuracy, alignment with your mandate, and diplomatic appropriateness.</li>
                            <li><strong>"Teach" Your AI:</strong> If the AI misunderstands or gives poor advice, correct it. E.g., "That's not quite right. Our red line on Issue X is actually [clarify]. Please revise your suggestion based on this."</li>
                            <li><strong>Save Key Prompts:</strong> Keep a separate document of your most effective prompts for different tasks. This saves time and helps ensure consistency. The prompts in the Round tabs are a good starting point.</li>
                        </ul>
                    </div>
                </div>

                <!-- Documents Hub Tab -->
                <div id="documents" class="tab-content">
                    <div class="content-header">
                        <h2 class="content-title">Documents Hub</h2>
                    </div>
                     <div class="alert alert-info">
                        <span class="alert-icon">📁</span>
                        <div>
                            <strong>Central Repository: Google Drive</strong><br>
                            All official documents for the challenge are distributed and collected via the main Google Drive folder. Check it frequently for updates and specific sub-folders for each round's materials and submission points. This Hub provides direct links for convenience.
                        </div>
                    </div>

                    <div class="resource-card" style="background-color: #eef2ff;">
                        <div class="resource-icon" style="background: var(--primary-color); color: white;">📁</div>
                        <h4 class="resource-title" style="color:var(--primary-color);">Main Google Drive Folder (CCHN Organized)</h4>
                        <p class="resource-description">This is the central point for all simulation materials, including background documents, round-specific files, and folders for your team's deliverable submissions.</p>
                        <div class="resource-link-area">
                            <a href="https://drive.google.com/drive/folders/1OLop4btPgdzHSpKjl6AprnoXraBWTld-?usp=drive_link" target="_blank" class="btn btn-primary">🔗 Open Main Google Drive</a>
                        </div>
                    </div>

                    <h3 style="margin: 30px 0 20px; font-size:1.5rem; color: var(--primary-color);">Key Foundational & Briefing Documents</h3>
                    <p>These documents are essential for your preparation and for configuring your AI assistant. Click to view/preview (opens in modal) or download.</p>
                    <div class="resource-grid">
                        <div class="resource-card">
                            <div class="resource-icon">📜</div>
                            <h4 class="resource-title">Backgrounder for the Malta Dialogue</h4>
                            <p class="resource-description">Comprehensive context of the Malta Dialogue, analysis of themes, and geopolitical situation.</p>
                            <div class="resource-link-area">
                                <button class="btn btn-secondary" onclick="viewDocument('Backgrounder for the Malta Dialogue', 'https://drive.google.com/file/d/1Qtxu4PYd5D19_MhhYDqrz_7f16rvoHdZTB64lbMKZKs/preview', 'https://drive.google.com/uc?export=download&id=1Qtxu4PYd5D19_MhhYDqrz_7f16rvoHdZTB64lbMKZKs')">📄 View/Download</button>
                            </div>
                        </div>
                        <div class="resource-card">
                            <div class="resource-icon" style="background-color: var(--tunisia-red); color: white;">🇹🇳</div>
                            <h4 class="resource-title">Mandate of Tunisia</h4>
                            <p class="resource-description">Specific positions, red lines, and negotiation strategies for the Tunisian delegation.</p>
                             <div class="resource-link-area">
                                <button class="btn btn-secondary" onclick="viewDocument('Tunisia Mandate', 'https://drive.google.com/file/d/10X4YSS6y0Ss8-WduhvvDls9rD5aOVdbRWBWlG_Hk8rI/preview', 'https://drive.google.com/uc?export=download&id=10X4YSS6y0Ss8-WduhvvDls9rD5aOVdbRWBWlG_Hk8rI')">📄 View/Download</button>
                            </div>
                        </div>
                        <div class="resource-card">
                            <div class="resource-icon" style="background-color: var(--senegal-green); color: white;">🇸🇳</div>
                            <h4 class="resource-title">Mandate of Senegal</h4>
                            <p class="resource-description">Specific positions, red lines, and negotiation strategies for the Senegalese delegation.</p>
                             <div class="resource-link-area">
                                <button class="btn btn-secondary" onclick="viewDocument('Senegal Mandate', 'https://drive.google.com/file/d/12ZtMDu5rfgGtt8sSX0vsDzIJZ_3up0DvItLM9rP9dcM/preview', 'https://drive.google.com/uc?export=download&id=12ZtMDu5rfgGtt8sSX0vsDzIJZ_3up0DvItLM9rP9dcM')">📄 View/Download</button>
                            </div>
                        </div>
                         <div class="resource-card">
                            <div class="resource-icon">📊</div>
                            <h4 class="resource-title">Technical File</h4>
                            <p class="resource-description">Detailed data, statistics, and analysis relevant to the negotiation topics.</p>
                             <div class="resource-link-area">
                                <button class="btn btn-secondary" onclick="viewDocument('TECHNICAL FILE.pdf', 'https://drive.google.com/file/d/1cdi3F_rttb1gSyrY47Pp7du8PzRN9NfN/preview', 'https://drive.google.com/uc?export=download&id=1cdi3F_rttb1gSyrY47Pp7du8PzRN9NfN')">📄 View/Download</button>
                            </div>
                        </div>
                         <div class="resource-card">
                            <div class="resource-icon">🎤</div>
                            <h4 class="resource-title">Maltese Presidency Speech (R1)</h4>
                            <p class="resource-description">Opening speech by the Maltese Presidency for Round 1, setting the stage for negotiations.</p>
                             <div class="resource-link-area">
                                 <button class="btn btn-secondary" onclick="viewDocument('OPENING SPEECH R1.pdf', 'https://drive.google.com/file/d/1tZLYs8NmShzHNv-Sz8miZvIw1lgS2ktO/preview', 'https://drive.google.com/uc?export=download&id=1tZLYs8NmShzHNv-Sz8miZvIw1lgS2ktO')">📄 View/Download</button>
                            </div>
                        </div>
                        <div class="resource-card">
                            <div class="resource-icon" style="background: #dbeafe; color: #2563eb;">🤝</div>
                            <h4 class="resource-title">Composition of Negotiation Blocs</h4>
                            <p class="resource-description">Details of the 4 negotiation blocs and their member delegations. (Typically found in General Info on GDrive)</p>
                             <div class="resource-link-area">
                                <button class="btn btn-secondary" onclick="alert('Please find the Blocs Composition document in the General Information folder on the main Google Drive.')">ℹ️ Find on GDrive</button>
                            </div>
                        </div>
                        <div class="resource-card">
                            <div class="resource-icon" style="background: #fee2e2; color: #dc2626;">📄</div>
                            <h4 class="resource-title">MERGED Final Position Papers (R1)</h4>
                            <p class="resource-description">Consolidated final position papers from all delegations after Round 1. Crucial for Round 2 prep.</p>
                            <div class="resource-link-area">
                                <button class="btn btn-secondary" onclick="viewDocument('MERGED Final position papers from R1.pdf', 'https://drive.google.com/file/d/1BsXa6oEOjkJd7ECZepWUECFsxBQy7z8x/preview', 'https://drive.google.com/uc?export=download&id=1BsXa6oEOjkJd7ECZepWUECFsxBQy7z8x')">📄 View/Download</button>
                            </div>
                        </div>
                         <div class="resource-card">
                            <div class="resource-icon" style="background: #dbeafe; color: #2563eb;">📝</div>
                            <h4 class="resource-title">Draft Declaration of Principles (R2)</h4>
                            <p class="resource-description">The Presidency's proposed Draft Declaration for negotiation in Round 2.</p>
                            <div class="resource-link-area">
                                <button class="btn btn-secondary" onclick="viewDocument('Draft Declaration of Principles.pdf', 'https://drive.google.com/file/d/1ug3jAWBeVW6pzsBWdTw6h6gwrV1EGjiT/preview', 'https://drive.google.com/uc?export=download&id=1ug3jAWBeVW6pzsBWdTw6h6gwrV1EGjiT')">📄 View/Download</button>
                            </div>
                        </div>
                    </div>
                     <h3 style="margin: 30px 0 20px; font-size:1.5rem; color: var(--primary-color);">AI & Methodology Documents</h3>
                     <div class="resource-grid">
                        <div class="resource-card">
                            <div class="resource-icon">💡</div>
                            <h4 class="resource-title">AI Setup: Complex Environments</h4>
                            <p class="resource-description">Instructions for setting up an AI assistant for analysing complex negotiation environments.</p>
                             <div class="resource-link-area">
                                <button class="btn btn-secondary" onclick="viewDocument('1 Instructions for Setting Up an AI Assistant for Analysing Complex Environments.pdf', 'https://drive.google.com/file/d/1RCGo8JJvHTiXRiqtcxtrXdt-cmHWbuMK/preview', 'https://drive.google.com/uc?export=download&id=1RCGo8JJvHTiXRiqtcxtrXdt-cmHWbuMK')">📄 View/Download</button>
                            </div>
                        </div>
                        <div class="resource-card">
                            <div class="resource-icon">🧊</div>
                            <h4 class="resource-title">Icebergs and CSS Methodology</h4>
                            <p class="resource-description">Instructions for using Iceberg diagrams and Comparative Solution Scoring in negotiations.</p>
                             <div class="resource-link-area">
                                <button class="btn btn-secondary" onclick="viewDocument('Instructions For Icebergs and CSS_New.pdf', 'https://drive.google.com/file/d/1DiEx8GwN1Ji-1lxAQhK-xlIsrVVYctiX/preview', 'https://drive.google.com/uc?export=download&id=1DiEx8GwN1Ji-1lxAQhK-xlIsrVVYctiX')">📄 View/Download</button>
                            </div>
                        </div>
                         <div class="resource-card">
                            <div class="resource-icon">👥</div>
                            <h4 class="resource-title">Stakeholder Analysis Guide</h4>
                            <p class="resource-description">Instructions for conducting stakeholder analysis to understand positions and influence.</p>
                             <div class="resource-link-area">
                                <button class="btn btn-secondary" onclick="viewDocument('Instructions for Stakeholder Analysis.pdf', 'https://drive.google.com/file/d/1X8OsnWmVdtNVx3u0BZ1lPVeNM_LOODtt/preview', 'https://drive.google.com/uc?export=download&id=1X8OsnWmVdtNVx3u0BZ1lPVeNM_LOODtt')">📄 View/Download</button>
                            </div>
                        </div>
                         <div class="resource-card">
                            <div class="resource-icon">📖</div>
                            <h4 class="resource-title">CCHN Field Manual</h4>
                            <p class="resource-description">Centre for Competence on Humanitarian Negotiation Field Manual for negotiation principles.</p>
                             <div class="resource-link-area">
                                <button class="btn btn-secondary" onclick="viewDocument('CCHN-Field-Manual-EN (1).pdf', 'https://drive.google.com/file/d/13xWmcvRm0x7S2KB9hB--EVhsw0AASVT1/preview', 'https://drive.google.com/uc?export=download&id=13xWmcvRm0x7S2KB9hB--EVhsw0AASVT1')">📄 View/Download</button>
                            </div>
                        </div>
                        <div class="resource-card">
                            <div class="resource-icon" style="background: #ffedd5; color: #f97316;">🛠️</div>
                            <h4 class="resource-title">Amendment Instructions (R2)</h4>
                            <p class="resource-description">Guidelines and instructions for drafting and submitting amendment proposals in Round 2.</p>
                             <div class="resource-link-area">
                                <button class="btn btn-secondary" onclick="viewDocument('Amendments instructions.pdf', 'https://drive.google.com/file/d/13vCqKyJpUXO-KIetJEjSnyUUXHZB1fXQ/preview', 'https://drive.google.com/uc?export=download&id=13vCqKyJpUXO-KIetJEjSnyUUXHZB1fXQ')">📄 View/Download</button>
                            </div>
                        </div>
                    </div>

                    <h3 style="margin: 30px 0 20px; font-size:1.5rem; color: var(--primary-color);">Example Deliverables (Reference Only)</h3>
                     <div class="resource-grid">
                        <div class="resource-card">
                            <div class="resource-icon" style="background-color: var(--tunisia-red); color: white;">🇹🇳</div>
                            <h4 class="resource-title">Tunisia - Prelim. Position Paper</h4>
                            <p class="resource-description">Example of a preliminary position paper for Tunisia.</p>
                             <div class="resource-link-area">
                                 <button class="btn btn-secondary" onclick="viewDocument('Republic of Tunisia Preliminary Position Paper.pdf', 'https://drive.google.com/file/d/1Exo7e3L3tOeSVOWFZat-5zE5pIasYE3m/preview', 'https://drive.google.com/uc?export=download&id=1Exo7e3L3tOeSVOWFZat-5zE5pIasYE3m')">📄 View/Download</button>
                            </div>
                        </div>
                        <div class="resource-card">
                            <div class="resource-icon" style="background-color: var(--senegal-green); color: white;">🇸🇳</div>
                            <h4 class="resource-title">Senegal - Position Paper (Prelim.)</h4>
                            <p class="resource-description">Example of a preliminary position paper for Senegal.</p>
                             <div class="resource-link-area">
                                 <button class="btn btn-secondary" onclick="viewDocument('Senegal Position Paper.pdf', 'https://drive.google.com/file/d/1KKvdQwPTbRyN3AANRSs9Hc8EZ31emTiH/preview', 'https://drive.google.com/uc?export=download&id=1KKvdQwPTbRyN3AANRSs9Hc8EZ31emTiH')">📄 View/Download</button>
                            </div>
                        </div>
                         <div class="resource-card">
                            <div class="resource-icon" style="background-color: var(--tunisia-red); color: white;">🇹🇳</div>
                            <h4 class="resource-title">Tunisia - Final Position Paper</h4>
                            <p class="resource-description">Example of a final position paper for Tunisia.</p>
                             <div class="resource-link-area">
                                 <button class="btn btn-secondary" onclick="viewDocument('Tunisia - Final Position Paper.pdf', 'https://drive.google.com/file/d/110gJmvQwlKgL-0gR6cpC_8cgiXmQEBoS/preview', 'https://drive.google.com/uc?export=download&id=110gJmvQwlKgL-0gR6cpC_8cgiXmQEBoS')">📄 View/Download</button>
                            </div>
                        </div>
                        <div class="resource-card">
                            <div class="resource-icon" style="background-color: var(--senegal-green); color: white;">🇸🇳</div>
                            <h4 class="resource-title">Senegal - Final Position Paper</h4>
                            <p class="resource-description">Example of a final position paper for Senegal.</p>
                             <div class="resource-link-area">
                                 <button class="btn btn-secondary" onclick="viewDocument('Senegal Position Paper final.pdf', 'https://drive.google.com/file/d/1lovYTj9Dm3tuWBj-Zkz9Z4xvEnLYiDiu/preview', 'https://drive.google.com/uc?export=download&id=1lovYTj9Dm3tuWBj-Zkz9Z4xvEnLYiDiu')">📄 View/Download</button>
                            </div>
                        </div>
                    </div>

                    <div class="round-section" style="margin-top: 30px;">
                        <h4 style="margin-bottom:15px; font-size:1.2rem;">My Team's Uploaded Files (Simulated)</h4>
                        <div id="teamFilesContainer">
                            <p><em>No files uploaded yet via this portal. Use the upload areas in each Round's tab. Official submissions are via the main Google Drive.</em></p>
                        </div>
                    </div>
                </div>

                <!-- Platforms Tab -->
                <div id="platforms" class="tab-content">
                    <div class="content-header">
                        <h2 class="content-title">Platforms & Essential Links</h2>
                    </div>
                    <div class="resource-grid">
                        <div class="resource-card">
                            <div class="resource-icon" style="background: #dbeafe; color: #2563eb;">📹</div>
                            <h4 class="resource-title">Zoom: Main Simulation Room</h4>
                            <p class="resource-description">All negotiation rounds (1, 2, 3) take place here. Includes plenary and breakout rooms for delegations.</p>
                            <div class="resource-link-area">
                                <a href="https://us06web.zoom.us/j/82148672315#success" target="_blank" class="btn btn-primary">🔗 Join Zoom</a>
                            </div>
                        </div>
                        <div class="resource-card">
                            <div class="resource-icon" style="background: #fee2e2; color: #dc2626;">🌐</div>
                            <h4 class="resource-title">Webex: Inauguration & Closing</h4>
                            <p class="resource-description">Used for the Inauguration Session (May 23, 09:00-12:00) and Awards Ceremony (May 24, 16:30-17:00).</p>
                            <div class="resource-link-area">
                                <a href="https://iheid.webex.com/wbxmjs/joinservice/sites/iheid/meeting/download/84de194976164c04b3326777ed502726?siteurl=iheid&MTID=m708917ce4e4caa689369f0379be4dd43" target="_blank" class="btn btn-primary">🔗 Join Webex</a>
                            </div>
                        </div>
                        <div class="resource-card">
                            <div class="resource-icon" style="background: #fef3c7; color: #d97706;">📁</div>
                            <h4 class="resource-title">Google Drive: Documents Hub</h4>
                            <p class="resource-description">Central repository for all official documents, templates, and team submissions.</p>
                             <div class="resource-link-area">
                                <a href="https://drive.google.com/drive/folders/1OLop4btPgdzHSpKjl6AprnoXraBWTld-?usp=drive_link" target="_blank" class="btn btn-primary">🔗 Open Google Drive</a>
                            </div>
                        </div>
                         <div class="resource-card">
                            <div class="resource-icon" style="background: #d1fae5; color: #059669;">📱</div>
                            <h4 class="resource-title">Signal Messenger: Team Communication</h4>
                            <p class="resource-description">Used for inter-team communication and coordination. Follow setup instructions carefully.</p>
                            <div class="resource-link-area">
                                 <button class="btn btn-primary" onclick="showSignalInstructions()">📄 View Setup Guide</button>
                            </div>
                        </div>
                    </div>
                     <div class="round-section" id="signalInstructions" style="display:none; margin-top: 25px; background-color: #f0f9ff;">
                        <h3 style="color: var(--primary-color); margin-bottom: 15px;">Signal Messenger Setup and Usage Guide</h3>
                        <p>Signal is crucial for inter-delegation communication during the simulation (e.g., requesting bilateral meetings) and for urgent announcements from the organizers. Please ensure it's set up correctly on your <strong>phone</strong> (mobile app is required to see full group member lists for initiating new chats).</p>
                        
                        <h4>Setup Steps for All Delegations (Tunisia & Senegal):</h4>
                        <ol style="margin-left: 20px; line-height: 1.8;">
                            <li><strong>Download & Install Signal:</strong> If you haven't already, download Signal Messenger from your phone's app store (iOS or Android).</li>
                            <li><strong>Create/Verify Account:</strong> Follow the on-screen instructions to set up or verify your Signal account using your phone number.</li>
                            <li><strong>Join Key Groups:</strong> Organizers will provide QR codes or links to join these essential groups. Scan them using Signal on your phone (Settings > Linked Devices > Link New Device often works for QR, or tap links if provided):
                                <ul>
                                    <li><strong>"Malta Dialogue - General Assembly":</strong> Main announcements. Restricted posting (usually only organizers).</li>
                                    <li><strong>"Presidency" Group:</strong> For questions related to the substance of the negotiation or case file.</li>
                                    <li><strong>"Help Desk" Group:</strong> For technical issues with platforms (Zoom, Webex, GDrive).</li>
                                    <li><strong>Your Private Delegation Group (e.g., "Signal Group Tunisia"):</strong> Organizers usually create these for your internal team coordination.</li>
                                </ul>
                            </li>
                            <li><strong>Configure Your Signal Profile:</strong> This is VERY IMPORTANT for others to identify you.
                                <ul>
                                    <li>In Signal, go to your Profile (usually tap your avatar/initials in the top left).</li>
                                    <li>Edit your profile:
                                        <ul>
                                            <li><strong>First Name:</strong> Your delegation name (e.g., "Tunisia", "Senegal", "France", "UNHCR").</li>
                                            <li><strong>Last Name:</strong> Your actual first name (e.g., "Aisha", "Mamadou", "Jean").</li>
                                            <li><strong>Liaison Role:</strong> <strong style="color: var(--danger-color);">ONE member from your team must be designated as the 'Liaison'.</strong> This person adds "(Liaison)" after their last name. Example: First Name: "Tunisia", Last Name: "Aisha (Liaison)". This is the primary contact for meeting requests.</li>
                                        </ul>
                                    </li>
                                    <li>Consider adding a profile picture if helpful (e.g., flag or neutral image).</li>
                                </ul>
                            </li>
                            <li><strong>Requesting Meetings:</strong>
                                <ul>
                                    <li>To invite another delegation for a bilateral meeting (in a Zoom breakout room):
                                        <ol type="a">
                                            <li>Open the "Malta Dialogue - General Assembly" group on your Signal PHONE APP.</li>
                                            <li>Tap the group name at the top to view the member list.</li>
                                            <li>Find the designated "Liaison" for the delegation you want to meet (e.g., First Name: "France", Last Name: "Pierre (Liaison)").</li>
                                            <li>Tap their name and send a direct message (DM) proposing the meeting, suggested time, and purpose. Coordinate on which Zoom breakout room to use.</li>
                                        </ol>
                                    </li>
                                    <li><strong style="color: var(--danger-color);">Note:</strong> The Signal Desktop app might not show the full member list of large groups for initiating *new* chats. Use your phone for this. Once a chat is started, it will appear on your linked desktop app.</li>
                                </ul>
                            </li>
                        </ol>

                        <h4 style="margin-top: 20px;">For the Coach (Jhozman Camacho):</h4>
                         <ul style="margin-left: 20px; line-height: 1.8;">
                            <li><strong>Monitoring & Support:</strong> Join the "Malta Dialogue - General Assembly", "Presidency", and "Help Desk" groups to stay informed of general announcements and potential issues where your teams might need guidance.</li>
                            <li><strong>Communication with Your Delegations (Tunisia & Senegal):</strong>
                                <ul>
                                    <li>You can directly message the "Liaison" of your Tunisian and Senegalese teams via Signal for coaching, reminders, or if they reach out to you with questions.</li>
                                    <li>It's generally not necessary to join their private delegation Signal groups unless they specifically invite you for a coaching session.</li>
                                </ul>
                            </li>
                            <li><strong>Optional Coach Group:</strong> You might consider creating a temporary Signal group named "Coach Jhozman - Tunisia/Senegal" and invite ONLY the members of your two assigned delegations. This could be a quick way to send them joint reminders, share brief tips, or coordinate very short check-ins if needed, without cluttering their private team chats. Participation would be optional for them.</li>
                        </ul>
                        <div class="alert alert-warning" style="margin-top: 20px;">
                            <span class="alert-icon">⚠️</span> <strong>Signal Etiquette:</strong> Be concise. Use DMs for bilateral arrangements. Reserve main groups for their intended purpose. Professional communication at all times.
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div class="notification-container" id="notificationContainer"></div>
    
    <div class="chat-widget">
        <button class="chat-button" id="chatButton" onclick="toggleChat()" title="Open AI Negotiation Assistant">
            🤖
        </button>
        <div class="chat-window" id="chatWindow">
            <div class="chat-header">
                <h4>AI Negotiation Assistant</h4>
                <button onclick="toggleChat()" title="Close Chat">✕</button>
            </div>
            <div class="chat-messages" id="chatMessagesContainer">
                <div class="chat-message system">OpenAI Assistant ready. How can I help you prepare for the Malta Dialogue? (Ensure API key is set in script)</div>
            </div>
            <div class="chat-input-area">
                <input type="text" id="chatInput" class="chat-input" placeholder="Ask for preparation advice..." onkeypress="handleChatInput(event)">
                <button class="btn btn-primary" onclick="sendChatMessage()" style="padding: 10px 15px;">Send</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modalOverlay">
        <div class="modal" id="documentModal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 id="modalTitle">Document Viewer</h3>
                <button style="background: none; border: none; font-size: 1.8rem; cursor: pointer; color: #64748b; padding:0;" onclick="closeModal()" title="Close Modal">✕</button>
            </div>
            <div class="modal-body">
                <div id="documentViewerContent" class="document-viewer">
                    <!-- Document content will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
				<a href="#" id="modalDownloadLink" class="btn btn-success" download target="_blank" style="display:none;">
                    <span style="font-size: 1.1rem; margin-right: 5px;">📥</span> Download Document
                </a>
                <button class="btn btn-secondary" onclick="closeModal()">Close</button>
            </div>
        </div>
    </div>

    <script>
        // --- Global State & Config ---
        let selectedDelegation = localStorage.getItem('selectedDelegation') || null;
        let currentTabId = 'dashboard';
        const uploadedFiles = {}; 
        let activityStatuses = JSON.parse(localStorage.getItem('activityStatuses')) || {};
        const roundNotes = {
            round1: localStorage.getItem('round1Notes') || '',
            round2: localStorage.getItem('round2Notes') || '',
            round3: localStorage.getItem('round3Notes') || '',
        };
        const deliverableKeys = [
            'preliminaryPosition_R1', 'finalPosition_R1', 
            'amendmentProposals_R2', 'writtenStatement_R3'
        ];

        // +++ SIMULATION DATE LOGIC +++
        const SIMULATION_YEAR = 2025;
        const SIMULATION_MONTH_JS = 4; // May (0-indexed: January is 0, May is 4)
        const SIMULATION_DAY = 24;    // Current day is 24th
        const SIMULATION_HOUR_CEST = 9; // Current hour in CEST is 09
        const SIMULATION_MINUTE_CEST = 30; // Current minute is 30
        // ++++++++++++++++++++++++++++++

        // OpenAI API Configuration - WARNING: DO NOT COMMIT YOUR REAL KEY TO A PUBLIC REPOSITORY
        // REPLACE "YOUR_OPENAI_API_KEY_HERE" with your actual key if you want to use the live chat feature.
        const OPENAI_API_KEY = "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"; // IMPORTANT: Replace with your key
        const OPENAI_API_URL = "https://api.openai.com/v1/chat/completions";
        let chatHistory = [ // Initial system prompt
            { "role": "system", "content": `You are a helpful AI assistant for a negotiation simulation called the Malta Dialogue. Provide concise, strategic advice based on the user's delegation and the simulation's context. The simulation is currently set to May 24, ${SIMULATION_YEAR}, around ${String(SIMULATION_HOUR_CEST).padStart(2,'0')}:${String(SIMULATION_MINUTE_CEST).padStart(2,'0')} CEST.` }
        ];


        // --- Initialisation ---
        window.addEventListener('load', function() {
            setTimeout(() => {
                document.getElementById('loadingOverlay').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loadingOverlay').style.display = 'none';
                }, 700);
            }, 1200);
            
            updateRealClocks(); 
            setInterval(updateRealClocks, 1000 * 60); 

            if (selectedDelegation) {
                const delegationBtn = document.querySelector(`.delegation-btn.${selectedDelegation}`);
                if (delegationBtn) delegationBtn.classList.add('active');
                updateDelegationDisplay();
            } else {
                showNotification('warning', '⚠️', 'Welcome! Please select your delegation (Tunisia or Senegal) to personalize your portal view.');
            }
            
            Object.keys(roundNotes).forEach(roundKey => {
                const textarea = document.getElementById(`${roundKey}Notes`);
                if (textarea) textarea.value = roundNotes[roundKey];
            });
            
            initializeActivityStatusDropdowns(); 
            initializeDefaultActivityStatuses(); 
            loadActivityStatusesFromStorageAndApply(); 
            
            initializeAllFileUploadAreas(); 
            
            updateDashboardStats(); 
            checkDeadlinesAndTimeline(); 
            setInterval(checkDeadlinesAndTimeline, 30000); 

            document.getElementById('modalOverlay').addEventListener('click', closeModal);
        });

        function initializeActivityStatusDropdowns() {
            const allStatusSelects = document.querySelectorAll('.activity-status-editor select');
            const optionsHTML = `
                <option value="upcoming">Upcoming</option>
                <option value="active">In Progress</option>
                <option value="completed">Completed</option>
            `; // Add more if needed: <option value="manual-progress">In Progress (M)</option> <option value="manual-upcoming">Upcoming (M)</option>

            allStatusSelects.forEach(select => {
                // Preserve existing selected value if the select already had one (e.g. from HTML default)
                const currentVal = select.value;
                select.innerHTML = optionsHTML;
                if (select.querySelector(`option[value="${currentVal}"]`)) {
                    select.value = currentVal;
                } else {
                    select.value = "upcoming"; // Default if previous value not in new options
                }
            });
        }
        
        function initializeDefaultActivityStatuses() {
            const nowSimulatedCEST = getSimulatedCESTTime();
            const currentSimDay = nowSimulatedCEST.getUTCDate();
            const currentSimHourCEST = nowSimulatedCEST.getUTCHours() + (nowSimulatedCEST.getTimezoneOffset() === -120 ? 0 : 2); // CEST is UTC+2 during DST
            const currentSimMinute = nowSimulatedCEST.getUTCMinutes();

            const defaultStatuses = {};
            const allActivityIds = Array.from(document.querySelectorAll('.timeline-item[data-activity-id]')).map(el => el.dataset.activityId);
            allActivityIds.forEach(id => defaultStatuses[id] = 'upcoming');


            // --- May 23rd Activities (SIMULATION_DAY - 1) ---
            if (SIMULATION_DAY > 23 || (SIMULATION_DAY === 23 && currentSimHourCEST >= 17) ) { // If sim is past R1 on May 23rd
                const r1Activities = [
                    "sched-inauguration", "sched-round1", "sched-r1-opening", "sched-r1-dossier", 
                    "sched-r1-prelimdraft", "sched-r1-informal", "sched-r1-crisis", 
                    "sched-r1-reassess", "sched-r1-presidencycall", "sched-r1-finalsubmit",
                    "opening-ceremony", "technical-dossier", "preliminary-paper", "informal-exchanges",
                    "crisis-reassessment", "final-paper-submission" // Dashboard specific IDs
                ];
                r1Activities.forEach(id => { if (allActivityIds.includes(id)) defaultStatuses[id] = 'completed'; });
            }
            // (No need for more granular May 23rd if sim day is 24th)

            // --- May 24th Activities (SIMULATION_DAY) ---
            if (currentSimDay === 24) {
                // Round 2 (09:00 - 12:00 CEST)
                if (currentSimHourCEST >= 9) defaultStatuses['sched-round2'] = 'active';
                if (currentSimHourCEST >= 12) defaultStatuses['sched-round2'] = 'completed';
                
                // 2.1.1 (09:10 - 09:30)
                if (currentSimHourCEST > 9 || (currentSimHourCEST === 9 && currentSimMinute >= 10)) defaultStatuses['sched-r2-consult'] = 'active';
                if (currentSimHourCEST > 9 || (currentSimHourCEST === 9 && currentSimMinute >= 30)) defaultStatuses['sched-r2-consult'] = 'completed';
                if (allActivityIds.includes('dashboard-r2-consult')) defaultStatuses['dashboard-r2-consult'] = defaultStatuses['sched-r2-consult'];


                // 2.1.2 (09:30 - 09:45)
                if (currentSimHourCEST > 9 || (currentSimHourCEST === 9 && currentSimMinute >= 30)) defaultStatuses['sched-r2-draftdec'] = 'active';
                if (currentSimHourCEST > 9 || (currentSimHourCEST === 9 && currentSimMinute >= 45)) defaultStatuses['sched-r2-draftdec'] = 'completed';
                if (allActivityIds.includes('dashboard-r2-draftdec')) defaultStatuses['dashboard-r2-draftdec'] = defaultStatuses['sched-r2-draftdec'];

                // 2.2.1 (09:45 - 10:00)
                if (currentSimHourCEST > 9 || (currentSimHourCEST === 9 && currentSimMinute >= 45)) defaultStatuses['sched-r2-negostart'] = 'active';
                if (currentSimHourCEST >= 10) defaultStatuses['sched-r2-negostart'] = 'completed';
                if (allActivityIds.includes('dashboard-r2-negostart')) defaultStatuses['dashboard-r2-negostart'] = defaultStatuses['sched-r2-negostart'];
                
                // 2.2.2 (10:00 - 11:00)
                if (currentSimHourCEST >= 10) defaultStatuses['sched-r2-directnego'] = 'active';
                if (currentSimHourCEST >= 11) defaultStatuses['sched-r2-directnego'] = 'completed';

                // 2.3.1 & 2.3.2 (11:00 - 12:00)
                if (currentSimHourCEST >= 11) defaultStatuses['sched-r2-amendsubmit'] = 'active';
                if (currentSimHourCEST >= 12) defaultStatuses['sched-r2-amendsubmit'] = 'completed';
                if (allActivityIds.includes('dashboard-r2-amendsubmit')) defaultStatuses['dashboard-r2-amendsubmit'] = defaultStatuses['sched-r2-amendsubmit'];

                // Round 3 (13:00 - 16:00 CEST)
                if (currentSimHourCEST >= 13) defaultStatuses['sched-round3'] = 'active';
                if (currentSimHourCEST >= 16) defaultStatuses['sched-round3'] = 'completed';

                // 3.1 (13:00 - 13:30)
                if (currentSimHourCEST >= 13) defaultStatuses['sched-r3-finaldec'] = 'active';
                if (currentSimHourCEST > 13 || (currentSimHourCEST === 13 && currentSimMinute >= 30)) defaultStatuses['sched-r3-finaldec'] = 'completed';
                
                // 3.2.1 & 3.2.2 (13:30 - 14:00)
                if (currentSimHourCEST > 13 || (currentSimHourCEST === 13 && currentSimMinute >= 30)) defaultStatuses['sched-r3-statementsubmit'] = 'active';
                if (currentSimHourCEST >= 14) defaultStatuses['sched-r3-statementsubmit'] = 'completed';
                
                // 3.3.1 (14:00 - 16:00)
                if (currentSimHourCEST >= 14) defaultStatuses['sched-r3-pressconf'] = 'active';
                if (currentSimHourCEST >= 16) defaultStatuses['sched-r3-pressconf'] = 'completed';

                // Closing Ceremony (16:30 - 17:00 CEST)
                if (currentSimHourCEST > 16 || (currentSimHourCEST === 16 && currentSimMinute >= 30)) defaultStatuses['sched-closing'] = 'active';
                if (currentSimHourCEST >= 17) defaultStatuses['sched-closing'] = 'completed';
            }
            
            // Merge with localStorage, giving localStorage precedence for user overrides
            const storedStatuses = JSON.parse(localStorage.getItem('activityStatuses')) || {};
            activityStatuses = {...defaultStatuses, ...storedStatuses}; 
        }
        
        function loadActivityStatusesFromStorageAndApply() {
            // activityStatuses should now be populated by initializeDefaultActivityStatuses (which merges with localStorage)
            document.querySelectorAll('.timeline-item[data-activity-id]').forEach(item => {
                const activityId = item.dataset.activityId;
                const currentStatus = activityStatuses[activityId] || 'upcoming'; // Fallback if somehow missed
                
                const statusSelect = item.querySelector('.activity-status-editor select');
                if (statusSelect) {
                    statusSelect.value = currentStatus;
                }
                updateActivityStatusUI(item, currentStatus);
            });
            // No need to save to localStorage here again, as initializeDefaultActivityStatuses already does that after merging.
        }

        // --- Clock and Time Functions ---
        function updateRealClocks() { 
            const now = new Date(); 
            const optionsTime = { hour: '2-digit', minute: '2-digit', hour12: false };
            const optionsDate = { weekday: 'short', day: 'numeric', month: 'short' };

            try {
                const genevaTime = new Date(now.toLocaleString("en-US", {timeZone: "Europe/Zurich"}));
                document.getElementById('genevaTime').textContent = genevaTime.toLocaleTimeString('en-GB', optionsTime);
                document.getElementById('genevaDate').textContent = genevaTime.toLocaleDateString('en-GB', optionsDate);
                document.getElementById('currentTime').textContent = genevaTime.toLocaleTimeString('en-GB', optionsTime);
            } catch (e) { console.error("Error setting Geneva time:", e); document.getElementById('currentTime').textContent = "Time Error"; }

            try {
                const caracasTime = new Date(now.toLocaleString("en-US", {timeZone: "America/Caracas"}));
                document.getElementById('caracasTime').textContent = caracasTime.toLocaleTimeString('en-GB', optionsTime);
                document.getElementById('caracasDate').textContent = caracasTime.toLocaleDateString('en-GB', optionsDate);
            } catch (e) { console.error("Error setting Caracas time:", e); }
        }
        
        function getSimulatedCESTTime() { 
            // UTC time for May 24, 2025, 09:30 CEST (CEST is UTC+2) would be 07:30 UTC.
            const simulatedUTCTime = Date.UTC(SIMULATION_YEAR, SIMULATION_MONTH_JS, SIMULATION_DAY, SIMULATION_HOUR_CEST - 2, SIMULATION_MINUTE_CEST, 0);
            return new Date(simulatedUTCTime);
        }

        function checkDeadlinesAndTimeline() {
            const nowSimulatedCEST = getSimulatedCESTTime(); 
            let nextOverallDeadlineText = "All deadlines passed or simulation ended.";
            let nextOverallDeadlineTime = null;
            let nextOverallDeadlineTask = "None";
            let isUrgent = false;

            const deadlines = [
                { name: "Prelim. Position Paper", date: new Date(Date.UTC(SIMULATION_YEAR, SIMULATION_MONTH_JS, 23, 15-2, 15, 0)), key: 'preliminaryPosition_R1' }, 
                { name: "Final Position Paper", date: new Date(Date.UTC(SIMULATION_YEAR, SIMULATION_MONTH_JS, 23, 17-2, 0, 0)), key: 'finalPosition_R1' },  
                { name: "Amendment Proposals", date: new Date(Date.UTC(SIMULATION_YEAR, SIMULATION_MONTH_JS, 24, 12-2, 0, 0)), key: 'amendmentProposals_R2' },
                { name: "Written Statement", date: new Date(Date.UTC(SIMULATION_YEAR, SIMULATION_MONTH_JS, 24, 14-2, 0, 0)), key: 'writtenStatement_R3' } 
            ];
            
            const nowSimulated_Timestamp = nowSimulatedCEST.getTime();

            deadlines.forEach(dl => {
                const deadline_Timestamp = dl.date.getTime();
                if (nowSimulated_Timestamp < deadline_Timestamp && (!nextOverallDeadlineTime || deadline_Timestamp < nextOverallDeadlineTime.getTime())) {
                    nextOverallDeadlineTime = dl.date; // Store as Date object
                    // Format for display, ensuring it's shown as CEST
                    let deadlineCESTHour = dl.date.getUTCHours() + 2; // Convert UTC hour to CEST
                    let deadlineCESTMinutes = String(dl.date.getUTCMinutes()).padStart(2, '0');
                    nextOverallDeadlineText = `${dl.name} at ${String(deadlineCESTHour).padStart(2,'0')}:${deadlineCESTMinutes} CEST`;
                    nextOverallDeadlineTask = dl.name;
                }
            });
            
            document.getElementById('nextDeadline').textContent = `Next: ${nextOverallDeadlineText}`;
            const nextDeadlineTimeDisplayEl = document.getElementById('nextDeadlineTimeDisplay');
            const nextDeadlineTaskEl = document.getElementById('nextDeadlineTask');

            if (nextOverallDeadlineTime) {
                let deadlineCESTHour = nextOverallDeadlineTime.getUTCHours() + 2;
                let deadlineCESTMinutes = String(nextOverallDeadlineTime.getUTCMinutes()).padStart(2, '0');
                nextDeadlineTimeDisplayEl.textContent = `${String(deadlineCESTHour).padStart(2,'0')}:${deadlineCESTMinutes}`;
                nextDeadlineTaskEl.textContent = nextOverallDeadlineTask;
                const timeRemaining = nextOverallDeadlineTime.getTime() - nowSimulated_Timestamp;
                if (timeRemaining > 0 && timeRemaining < 30 * 60 * 1000) { 
                    isUrgent = true;
                }
            } else {
                 nextDeadlineTimeDisplayEl.textContent = "--:--";
                 nextDeadlineTaskEl.textContent = "All passed";
            }
            
            const topDeadlineEl = document.getElementById('nextDeadline');
            topDeadlineEl.style.color = isUrgent ? 'var(--danger-color)' : 'white';
            topDeadlineEl.style.fontWeight = isUrgent ? 'bold' : 'normal';

            updateDashboardAlert(nowSimulatedCEST, nextOverallDeadlineTime, nextOverallDeadlineTask);
            updateDeliverableStatuses(nowSimulatedCEST, deadlines);
            updateDashboardStats(); 
        }

        function updateDashboardAlert(nowSimulatedCEST, nextDeadlineTimeObj, nextDeadlineTask) {
            const alertEl = document.getElementById('dashboardAlert');
            const titleEl = document.getElementById('dashboardAlertTitle');
            const detailEl = document.getElementById('dashboardAlertDetail');
            
            const currentSimulatedHourCEST = nowSimulatedCEST.getUTCHours() + 2; 

            if (nowSimulatedCEST.getUTCDate() === SIMULATION_DAY) { // It's May 24th
                if (currentSimulatedHourCEST >= 9 && currentSimulatedHourCEST < 12) { 
                    titleEl.textContent = "Round 2 In Progress";
                    if (nextDeadlineTimeObj && nowSimulatedCEST < nextDeadlineTimeObj && nextDeadlineTask === "Amendment Proposals") {
                        let deadlineCESTHour = nextDeadlineTimeObj.getUTCHours() + 2;
                        let deadlineCESTMinutes = String(nextDeadlineTimeObj.getUTCMinutes()).padStart(2, '0');
                        detailEl.textContent = `Next deadline: ${nextDeadlineTask} - ${String(deadlineCESTHour).padStart(2,'0')}:${deadlineCESTMinutes} CEST`;
                        alertEl.className = 'alert alert-warning';
                        if ((nextDeadlineTimeObj.getTime() - nowSimulatedCEST.getTime()) < 30 * 60 * 1000) {
                            alertEl.className = 'alert alert-danger';
                        }
                    } else {
                        detailEl.textContent = "Negotiations ongoing. Finalize amendments.";
                        alertEl.className = 'alert alert-info';
                    }
                } else if (currentSimulatedHourCEST >= 13 && currentSimulatedHourCEST < 16) { 
                    titleEl.textContent = "Round 3 In Progress";
                     if (nextDeadlineTimeObj && nowSimulatedCEST < nextDeadlineTimeObj && nextDeadlineTask === "Written Statement") {
                        let deadlineCESTHour = nextDeadlineTimeObj.getUTCHours() + 2;
                        let deadlineCESTMinutes = String(nextDeadlineTimeObj.getUTCMinutes()).padStart(2, '0');
                        detailEl.textContent = `Next deadline: ${nextDeadlineTask} - ${String(deadlineCESTHour).padStart(2,'0')}:${deadlineCESTMinutes} CEST`;
                        alertEl.className = 'alert alert-warning';
                        if ((nextDeadlineTimeObj.getTime() - nowSimulatedCEST.getTime()) < 30 * 60 * 1000) {
                            alertEl.className = 'alert alert-danger';
                        }
                    } else {
                        detailEl.textContent = "Public communication phase.";
                        alertEl.className = 'alert alert-info';
                    }
                } else if (currentSimulatedHourCEST >= 16) {
                    titleEl.textContent = "Post-Rounds / Awaiting Closing";
                    detailEl.textContent = "Main negotiation rounds for May 24th have concluded.";
                    alertEl.className = 'alert alert-success';
                } else { // Before R2 start on May 24th (e.g. if sim time was 08:00)
                    titleEl.textContent = "Awaiting Round 2 Start";
                    detailEl.textContent = "Round 2 begins at 09:00 CEST.";
                    alertEl.className = 'alert alert-info';
                }
            } else if (nowSimulatedCEST.getUTCDate() === 23) { // If sim date was May 23rd
                titleEl.textContent = "Round 1 In Progress / Concluded";
                 if (nextDeadlineTimeObj && nowSimulatedCEST < nextDeadlineTimeObj) {
                    let deadlineCESTHour = nextDeadlineTimeObj.getUTCHours() + 2;
                    let deadlineCESTMinutes = String(nextDeadlineTimeObj.getUTCMinutes()).padStart(2, '0');
                    detailEl.textContent = `Next R1 deadline: ${nextDeadlineTask} - ${String(deadlineCESTHour).padStart(2,'0')}:${deadlineCESTMinutes} CEST`;
                    alertEl.className = 'alert alert-warning';
                    if ((nextDeadlineTimeObj.getTime() - nowSimulatedCEST.getTime()) < 30 * 60 * 1000) {
                        alertEl.className = 'alert alert-danger';
                    }
                } else {
                    detailEl.textContent = "Round 1 activities concluded for May 23rd.";
                    alertEl.className = 'alert alert-success';
                }
            } else { 
                titleEl.textContent = "Simulation Awaiting Correct Date Context";
                detailEl.textContent = `Portal configured for May 23-24, ${SIMULATION_YEAR} simulation activities.`;
                alertEl.className = 'alert alert-info';
            }
        }
        
        // --- AI Chat Widget (OpenAI - Client Side) ---
        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            if (!input) return;
            const messageText = input.value.trim();

            if (messageText) {
                appendChatMessage(messageText, 'user');
                input.value = '';
                input.disabled = true; 
                const sendButton = input.nextElementSibling;
                if(sendButton) sendButton.disabled = true;

                if (OPENAI_API_KEY === "" || OPENAI_API_KEY === "YOUR_OPENAI_API_KEY_HERE") {
                    appendChatMessage("ERROR: OpenAI API Key not configured. Please set it in the script.", 'system');
                    input.disabled = false;
                    if(sendButton) sendButton.disabled = false;
                    input.focus();
                    return;
                }
                
                let currentDelegationInfo = selectedDelegation ? `User is representing: ${selectedDelegation}. ` : "User has not selected a delegation. ";
                let currentSimTime = getSimulatedCESTTime();
                let currentSimHourCEST = currentSimTime.getUTCHours() + 2;
                let currentSimMinutesCEST = String(currentSimTime.getUTCMinutes()).padStart(2, '0');

                let currentContext = `The simulation is currently at ${String(currentSimHourCEST).padStart(2,'0')}:${currentSimMinutesCEST} CEST on May ${currentSimTime.getUTCDate()}, ${SIMULATION_YEAR}. Advise accordingly.`;

                const messagesForAPI = [
                    { "role": "system", "content": `You are a helpful AI assistant for a negotiation simulation called the Malta Dialogue. ${currentDelegationInfo} ${currentContext} Provide concise, strategic advice based on the user's delegation and the simulation's context. Refer to official documents like mandates, technical files, and declarations when relevant.` },
                    ...chatHistory.slice(-6), 
                    { "role": "user", "content": messageText }
                ];


                try {
                    const response = await fetch(OPENAI_API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${OPENAI_API_KEY}`
                        },
                        body: JSON.stringify({
                            model: "gpt-3.5-turbo", 
                            messages: messagesForAPI, 
                            max_tokens: 350,
                            temperature: 0.7 
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        console.error("OpenAI API Error:", errorData);
                        appendChatMessage(`Error: ${errorData.error?.message || response.statusText}`, 'system');
                    } else {
                        const data = await response.json();
                        const aiResponse = data.choices[0]?.message?.content.trim();
                        if (aiResponse) {
                            appendChatMessage(aiResponse, 'assistant');
                            chatHistory.push({ "role": "user", "content": messageText }); 
                            chatHistory.push({ "role": "assistant", "content": aiResponse }); 
                             if(chatHistory.length > 20) chatHistory = chatHistory.slice(-20); 
                        } else {
                            appendChatMessage("Received an empty or incomplete response from AI.", 'system');
                        }
                    }
                } catch (error) {
                    console.error('Error sending message to AI:', error);
                    appendChatMessage('Error connecting to AI. Check console and API key.', 'system');
                } finally {
                    input.disabled = false;
                     if(sendButton) sendButton.disabled = false;
                    input.focus();
                }
            }
        }
        
        // --- Delegation Selection, Navigation, Notifications, Utils, Modal ---
        function selectDelegation(delegation) {
            selectedDelegation = delegation;
            localStorage.setItem('selectedDelegation', delegation);
            document.querySelectorAll('.delegation-btn').forEach(btn => btn.classList.remove('active'));
            const activeBtn = document.querySelector(`.delegation-btn.${delegation}`);
            if (activeBtn) activeBtn.classList.add('active');
            updateDelegationDisplay();
            showNotification('success', '✅', `Delegation of <strong>${delegation.charAt(0).toUpperCase() + delegation.slice(1)}</strong> selected.`);
            updateDashboardStats(); 
            checkDeadlinesAndTimeline(); 
            
            let currentSimTime = getSimulatedCESTTime();
            let currentSimHourCEST = currentSimTime.getUTCHours() + 2;
            let currentSimMinutesCEST = String(currentSimTime.getUTCMinutes()).padStart(2, '0');
            chatHistory[0].content = `You are a helpful AI assistant for a negotiation simulation called the Malta Dialogue. User is representing: ${selectedDelegation}. The simulation is currently at ${String(currentSimHourCEST).padStart(2,'0')}:${currentSimMinutesCEST} CEST on May ${currentSimTime.getUTCDate()}, ${SIMULATION_YEAR}. Advise accordingly.`;
        }

        function updateDelegationDisplay() {
            const delegationName = selectedDelegation ? (selectedDelegation.charAt(0).toUpperCase() + selectedDelegation.slice(1)) : 'None';
            document.getElementById('activeDelegationStat').textContent = delegationName;
        }

        function showTab(tabId, element) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            const targetTab = document.getElementById(tabId);
            if (targetTab) targetTab.classList.add('active');
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            if (element) element.classList.add('active');
            currentTabId = tabId;
            window.scrollTo(0,0);
        }
        
        let currentNotificationCount = 0;
        function showNotification(type, icon, message, duration = 7000) {
            const container = document.getElementById('notificationContainer');
            if (!container) return;
            const notificationId = `notif-${Date.now()}`;
            const notification = document.createElement('div');
            notification.id = notificationId;
            notification.className = `notification alert alert-${type}`;
            notification.innerHTML = `
                <span class="alert-icon">${icon}</span>
                <div style="flex-grow:1;">
                    <p style="font-weight: 600; margin-bottom: 4px; font-size:1rem; color: var(--text-dark);">${type.charAt(0).toUpperCase() + type.slice(1)}</p>
                    <p style="font-size: 0.9rem; color: #334155;">${message}</p>
                </div>
                <button class="notification-close" onclick="closeNotification('${notificationId}')" title="Close notification">✕</button>
            `;
            container.insertBefore(notification, container.firstChild);
            updateNotificationBadge(1);
            setTimeout(() => closeNotification(notificationId), duration);
        }
        function closeNotification(notificationId) {
            const notification = document.getElementById(notificationId);
            if (notification) {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentElement) {
                         notification.remove();
                         updateNotificationBadge(-1);
                    }
                }, 400);
            }
        }
        function updateNotificationBadge(change) {
            currentNotificationCount += change;
            if (currentNotificationCount < 0) currentNotificationCount = 0;
            const badge = document.getElementById('notificationCount');
            if (badge) {
                badge.textContent = currentNotificationCount;
                badge.style.display = currentNotificationCount > 0 ? 'inline-block' : 'none';
            }
        }
        function toggleChat() {
            const chatWindow = document.getElementById('chatWindow');
            if (chatWindow) chatWindow.classList.toggle('open');
            if(chatWindow.classList.contains('open')) document.getElementById('chatInput').focus();
        }
        function handleChatInput(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendChatMessage();
            }
        }
        function appendChatMessage(text, sender) {
            const messagesContainer = document.getElementById('chatMessagesContainer');
            if (!messagesContainer) return;
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('chat-message', sender);
            messageDiv.textContent = text; 
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        const modalOverlay = document.getElementById('modalOverlay');
        const modalTitleEl = document.getElementById('modalTitle');
        const documentViewerEl = document.getElementById('documentViewerContent');
        const modalDownloadLink = document.getElementById('modalDownloadLink');

        function openModal(title, contentHTML, downloadUrl = null, downloadFilename = null) {
            if (modalTitleEl) modalTitleEl.textContent = title;
            if (documentViewerEl) documentViewerEl.innerHTML = contentHTML;
            if (modalDownloadLink && downloadUrl) {
                modalDownloadLink.href = downloadUrl;
                modalDownloadLink.download = downloadFilename || title.replace(/[^a-z0-9_.-]/gi, '_').toLowerCase() + (downloadUrl.includes('.pdf') ? '.pdf' : ''); 
                modalDownloadLink.style.display = 'inline-flex';
            } else if (modalDownloadLink) {
                modalDownloadLink.style.display = 'none';
            }
            if (modalOverlay) modalOverlay.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        function closeModal() {
            if (modalOverlay) modalOverlay.style.display = 'none';
            if (documentViewerEl) documentViewerEl.innerHTML = '';
            if (modalDownloadLink) modalDownloadLink.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        async function viewDocument(docName, previewUrl, downloadUrl) {
            showNotification('info', '📄', `Loading ${docName}...`);
            let contentToDisplay = `<p style="text-align:center; padding:20px;">Loading preview for ${docName}...</p>`;
             if (previewUrl.includes('drive.google.com/file') || previewUrl.includes('drive.google.com/open')) {
                let embedUrl = previewUrl;
                if (previewUrl.includes('/view')) { 
                    embedUrl = previewUrl.replace("/view", "/preview");
                } else if (previewUrl.includes('/d/')) { 
                     embedUrl = previewUrl.replace("/edit", "/preview").replace("?usp=drive_link","").replace("?usp=sharing","");
                     if (!embedUrl.includes('/preview')) { 
                        const parts = embedUrl.split('/d/');
                        if (parts.length > 1) {
                            const idAndRest = parts[1].split('/');
                            embedUrl = `https://drive.google.com/file/d/${idAndRest[0]}/preview`;
                        }
                     }
                }
                contentToDisplay = `<iframe src="${embedUrl}" title="${docName}" style="width:100%; height: calc(65vh - 20px); border:none;"></iframe>`;
            } else if (previewUrl.endsWith('.pdf')) {
                 contentToDisplay = `<iframe src="${previewUrl}" title="${docName}" style="width:100%; height: calc(65vh - 20px); border:none;"></iframe>`;
            } else if (previewUrl.match(/\.(jpeg|jpg|gif|png)$/i) != null) {
                 contentToDisplay = `<img src="${previewUrl}" alt="${docName}" style="max-width:100%; height:auto; display:block; margin: 0 auto;">`;
            } else { 
                contentToDisplay = `<p>Preview for this file type might not be optimal. For the best experience, please use the download button.</p> 
                                     <p style="text-align:center; margin-top:20px;"><a href="${downloadUrl || previewUrl}" target="_blank" class="btn btn-primary">Open in New Tab</a></p>`;
            }
            openModal(docName, contentToDisplay, downloadUrl || previewUrl, docName);
        }
        
        function initializeAllFileUploadAreas() {
            const areas = [
                { areaId: 'preliminaryPositionUploadArea_R1', fileKey: 'preliminaryPosition_R1', name: 'Preliminary Position Paper (R1)' },
                { areaId: 'finalPositionUploadArea_R1', fileKey: 'finalPosition_R1', name: 'Final Position Paper (R1)' },
                { areaId: 'amendmentProposalsUploadArea_R2', fileKey: 'amendmentProposals_R2', name: 'Amendment Proposals (R2)' },
                { areaId: 'writtenStatementUploadArea_R3', fileKey: 'writtenStatement_R3', name: 'Final Written Statement (R3)' },
                // Add dashboard upload area if one exists for Amendment Proposals
                { areaId: 'amendmentProposalsUploadStatus_dashboard', fileKey: 'amendmentProposals_R2', name: 'Amendment Proposals (R2)' }
            ];
            areas.forEach(area => {
                // Only initialize if the area ID exists. The dashboard version is just a status display.
                if (document.getElementById(area.areaId) && area.areaId.includes('UploadArea')) {
                     initializeFileUploadArea(area.areaId, area.fileKey, area.name);
                }
            });

            updateDeliverableStatusesUIOnly(getSimulatedCESTTime(), [ 
                { name: "Prelim. Position Paper", date: new Date(Date.UTC(SIMULATION_YEAR, SIMULATION_MONTH_JS, 23, 15-2, 15, 0)), key: 'preliminaryPosition_R1' },
                { name: "Final Position Paper", date: new Date(Date.UTC(SIMULATION_YEAR, SIMULATION_MONTH_JS, 23, 17-2, 0, 0)), key: 'finalPosition_R1' },
                { name: "Amendment Proposals", date: new Date(Date.UTC(SIMULATION_YEAR, SIMULATION_MONTH_JS, 24, 12-2, 0, 0)), key: 'amendmentProposals_R2' },
                { name: "Written Statement", date: new Date(Date.UTC(SIMULATION_YEAR, SIMULATION_MONTH_JS, 24, 14-2, 0, 0)), key: 'writtenStatement_R3' }
             ]);
        }
         function initializeFileUploadArea(areaId, fileKey, deliverableName) {
            const uploadAreaContainer = document.getElementById(areaId);
            if (!uploadAreaContainer) return;

            const storedFile = localStorage.getItem(fileKey);
            if (storedFile) {
                try {
                    const fileData = JSON.parse(storedFile);
                    uploadedFiles[fileKey] = fileData; 
                    renderUploadedFile(areaId, fileKey, fileData, deliverableName);
                } catch (e) {
                    localStorage.removeItem(fileKey); 
                    renderUploadPrompt(areaId, fileKey, deliverableName);
                }
            } else {
                renderUploadPrompt(areaId, fileKey, deliverableName);
            }
        }
        function renderUploadPrompt(areaId, fileKey, deliverableName) {
            const uploadAreaContainer = document.getElementById(areaId);
            if (!uploadAreaContainer) return;
            uploadAreaContainer.innerHTML = `
                <div class="file-upload-area" 
                     onclick="document.getElementById('${fileKey}-input').click()"
                     ondrop="dropHandler(event, '${fileKey}', '${areaId}', '${deliverableName}')" 
                     ondragover="dragOverHandler(event)" 
                     ondragleave="dragLeaveHandler(event)">
                    <input type="file" id="${fileKey}-input" accept=".pdf,.doc,.docx,.txt" style="display: none;" 
                           onchange="handleFileSelect(event, '${fileKey}', '${areaId}', '${deliverableName}')">
                    <svg class="file-upload-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width:50px; height:50px; margin:0 auto 18px; color: #94a3b8;">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 16.5V9.75m0 0l3 3m-3-3l-3 3M6.75 19.5a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.338-2.32 5.75 5.75 0 011.41 11.097H6.75z" />
                    </svg>
                    <h4>Upload ${deliverableName}</h4>
                    <p style="color: #64748b; font-size:0.9rem;">Drag & drop or click to select file</p>
                    <p style="font-size: 0.8rem; color: #94a3b8;">PDF, DOC, DOCX, TXT accepted (Max 5MB for demo)</p>
                </div>`;
        }
         function renderUploadedFile(areaId, fileKey, fileData, deliverableName) {
            const uploadAreaContainer = document.getElementById(areaId);
            if (!uploadAreaContainer) return;
            const fileSizeKB = fileData.size ? (fileData.size / 1024).toFixed(1) : 'N/A';
            const lastModifiedDate = fileData.lastModified ? new Date(fileData.lastModified).toLocaleString('en-GB') : 'N/A';
            uploadAreaContainer.innerHTML = `
                <div class="file-item">
                    <div class="file-info">
                        <div class="file-icon">📄</div>
                        <div>
                            <div title="${fileData.name}"><strong>${fileData.name}</strong> (${fileSizeKB} KB)</div>
                            <div style="font-size: 0.875rem; color: #64748b;">Submitted: ${lastModifiedDate}</div>
                        </div>
                    </div>
                    <div class="content-actions">
                        ${fileData.content ? `<button class="btn btn-sm btn-success" onclick="downloadUploadedFile('${fileKey}')">Download</button>` : ''}
                        <button class="btn btn-sm btn-danger" onclick="removeFile('${areaId}', '${fileKey}', '${deliverableName}')">Remove</button>
                    </div>
                </div>`;
        }
        function handleFileSelect(event, fileKey, areaId, deliverableName) {
            const file = event.target.files[0];
            if (file) processAndStoreFile(file, fileKey, areaId, deliverableName);
        }
        function dropHandler(event, fileKey, areaId, deliverableName) {
            event.preventDefault();
            event.currentTarget.classList.remove('drag-over');
            const file = event.dataTransfer.items ? event.dataTransfer.items[0].getAsFile() : event.dataTransfer.files[0];
            if (file) processAndStoreFile(file, fileKey, areaId, deliverableName);
        }
        function dragOverHandler(event){ event.preventDefault(); event.currentTarget.classList.add('drag-over');}
        function dragLeaveHandler(event){ event.currentTarget.classList.remove('drag-over');}
         function processAndStoreFile(file, fileKey, areaId, deliverableName) {
            const allowedTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'text/plain'];
            if (!allowedTypes.includes(file.type)) {
                showNotification('danger', '❌', 'Invalid file type. Please upload PDF, DOC, DOCX, or TXT.');
                return;
            }
            if (file.size > 5 * 1024 * 1024) { 
                showNotification('danger', '❌', 'File is too large (Max 5MB for this demo).');
                return;
            }
            const reader = new FileReader();
            reader.onload = function(e) {
                const fileData = { name: file.name, type: file.type, size: file.size, lastModified: file.lastModified, content: e.target.result };
                localStorage.setItem(fileKey, JSON.stringify(fileData));
                uploadedFiles[fileKey] = fileData;
                renderUploadedFile(areaId, fileKey, fileData, deliverableName);
                showNotification('success', '✅', `"${file.name}" submitted for ${deliverableName}.`);
                updateDashboardStats();
                checkDeadlinesAndTimeline(); 
            };
            reader.readAsDataURL(file);
        }
        function downloadUploadedFile(fileKey) {
            const fileData = uploadedFiles[fileKey];
            if (fileData && fileData.content) {
                const link = document.createElement('a'); link.href = fileData.content; link.download = fileData.name;
                document.body.appendChild(link); link.click(); document.body.removeChild(link);
            }
        }
        function removeFile(areaId, fileKey, deliverableName) {
            localStorage.removeItem(fileKey); delete uploadedFiles[fileKey];
            renderUploadPrompt(areaId, fileKey, deliverableName);
            showNotification('info', '🗑️', `${deliverableName} cleared.`);
            updateDashboardStats(); checkDeadlinesAndTimeline();
        }
         function updateDeliverableStatuses(nowSimulatedCEST, deadlinesConfig) { 
            deliverableKeys.forEach(key => {
                const deadlineInfo = deadlinesConfig.find(d => d.key === key);
                if (deadlineInfo) {
                    // For Round tabs, the status element is directly the span
                    updateDeliverableStatusUIOnly(`${key}Status_R1`, key, deadlineInfo.date, nowSimulatedCEST, deadlineInfo.name); 
                    // For Schedule tab, the ID is on the deliverable-section div
                    updateDeliverableStatusUIOnly(`${key}UploadStatus_schedule`, key, deadlineInfo.date, nowSimulatedCEST, deadlineInfo.name);
                    // For dashboard's amendment proposal status
                    if (key === 'amendmentProposals_R2') {
                        updateDeliverableStatusUIOnly('amendmentProposalsUploadStatus_dashboard', key, deadlineInfo.date, nowSimulatedCEST, deadlineInfo.name);
                    }
                }
            });
        }

        function updateDeliverableStatusUIOnly(statusElementIdOrContainerId, fileKey, deadline, now, deliverableName) {
            let statusElContainer = document.getElementById(statusElementIdOrContainerId);
            let statusEl;

            if (!statusElContainer) return;

            if (statusElContainer.classList.contains('deliverable-status')) { // Direct span ID (Round tabs)
                statusEl = statusElContainer;
            } else if (statusElContainer.classList.contains('deliverable-section')) { // Container div (Schedule, Dashboard)
                statusEl = statusElContainer.querySelector('.deliverable-status');
                if (!statusEl) { // If structure is missing, try to build it
                    let header = statusElContainer.querySelector('.deliverable-header');
                    if (!header) {
                        header = document.createElement('div');
                        header.className = 'deliverable-header';
                        statusElContainer.prepend(header); // Add header to the top of the section
                    }
                    let titleSpan = header.querySelector('.deliverable-title');
                    if(!titleSpan){
                        titleSpan = document.createElement('span');
                        titleSpan.className = 'deliverable-title';
                        titleSpan.textContent = deliverableName;
                        header.appendChild(titleSpan);
                    }
                    statusEl = document.createElement('span');
                    statusEl.className = 'deliverable-status';
                    header.appendChild(statusEl);
                }
            } else {
                return; 
            }
            
            let deadlineCESTHour = deadline.getUTCHours() + 2;
            let deadlineCESTMinutes = String(deadline.getUTCMinutes()).padStart(2, '0');
            let deadlineString = `${String(deadlineCESTHour).padStart(2,'0')}:${deadlineCESTMinutes}`;

            let statusText = `Pending - Deadline: ${deadlineString}`;
            let dotClass = "pending";

            if (uploadedFiles[fileKey]) {
                statusText = `Submitted <small>(${new Date(uploadedFiles[fileKey].lastModified).toLocaleTimeString('en-GB', {hour:'2-digit', minute:'2-digit'})})</small>`;
                dotClass = "completed";
            } else if (now > deadline) {
                statusText = `OVERDUE - Passed at ${deadlineString}`;
                dotClass = "overdue";
            } else if ((deadline.getTime() - now.getTime()) < 30 * 60 * 1000 && (deadline.getTime() - now.getTime()) > 0) {
                statusText = `URGENT: ${deadlineString}`;
                dotClass = "pending"; // Could be 'urgent' if you add CSS for .status-dot.urgent
            }
            statusEl.innerHTML = `<span class="status-dot ${dotClass}"></span> ${statusText}`;
        }

        function updateDashboardStats() {
            let r1DocsSubmittedCount = 0;
            if (uploadedFiles.preliminaryPosition_R1) r1DocsSubmittedCount++;
            if (uploadedFiles.finalPosition_R1) r1DocsSubmittedCount++;
            
            document.getElementById('docsSubmittedR1').textContent = `${r1DocsSubmittedCount}/2`;
            document.getElementById('docsSubmittedR1Detail').textContent = (r1DocsSubmittedCount === 2) ? "All R1 Docs Submitted ✓" : "R1 Docs Pending";

            const round1NavBadge = document.getElementById('round1Badge');
            const pendingR1 = 2 - r1DocsSubmittedCount;
            const nowSimulated = getSimulatedCESTTime();
            
            if (round1NavBadge) { 
                if (selectedDelegation && pendingR1 > 0 && (nowSimulated.getUTCFullYear() === SIMULATION_YEAR && nowSimulated.getUTCMonth() === SIMULATION_MONTH_JS && nowSimulated.getUTCDate() === 23) ) {
                    round1NavBadge.style.display = 'inline-block';
                    round1NavBadge.textContent = pendingR1;
                } else {
                    round1NavBadge.style.display = 'none';
                }
            }
            
            const currentSimulatedHourCEST = nowSimulated.getUTCHours() + 2;
            const currentRoundActivityEl = document.getElementById('currentRoundActivity');
            const currentRoundActivityDetailEl = document.getElementById('currentRoundActivityDetail');

            if (nowSimulated.getUTCDate() === 24 && nowSimulated.getUTCFullYear() === SIMULATION_YEAR && nowSimulated.getUTCMonth() === SIMULATION_MONTH_JS) { 
                if (currentSimulatedHourCEST >= 9 && currentSimulatedHourCEST < 12) {
                    currentRoundActivityEl.textContent = "Round 2";
                    currentRoundActivityDetailEl.textContent = "Strategic Negotiation & Drafting";
                } else if (currentSimulatedHourCEST >= 13 && currentSimulatedHourCEST < 16) {
                    currentRoundActivityEl.textContent = "Round 3";
                    currentRoundActivityDetailEl.textContent = "Public Communication";
                } else if (currentSimulatedHourCEST >= 16) {
                     currentRoundActivityEl.textContent = "Post-Rounds";
                    currentRoundActivityDetailEl.textContent = "Awaiting Closing";
                } else {
                    currentRoundActivityEl.textContent = "Pre-Round 2";
                    currentRoundActivityDetailEl.textContent = "Awaiting R2 Start";
                }
            } else if (nowSimulated.getUTCDate() === 23 && nowSimulated.getUTCFullYear() === SIMULATION_YEAR && nowSimulated.getUTCMonth() === SIMULATION_MONTH_JS) { 
                 currentRoundActivityEl.textContent = "Round 1";
                 let r1ActiveDetail = "Information Management & Crisis";
                 // Simplified detail for dashboard if R1
                 const r1TimelineItemActive = document.querySelector('#dashboard .timeline-item.active h4');
                 if (r1TimelineItemActive) r1ActiveDetail = r1TimelineItemActive.textContent;
                 currentRoundActivityDetailEl.textContent = r1ActiveDetail;
            } else {
                currentRoundActivityEl.textContent = "Pre-Simulation";
                currentRoundActivityDetailEl.textContent = "Awaiting Start";
            }
            
            const dashboardR1Indicator = document.getElementById('dashboardRound1StatusIndicator');
            if (dashboardR1Indicator) {
                if (nowSimulated.getUTCDate() >= 24 && nowSimulated.getUTCFullYear() === SIMULATION_YEAR && nowSimulated.getUTCMonth() === SIMULATION_MONTH_JS) { 
                    dashboardR1Indicator.textContent = "Completed";
                    dashboardR1Indicator.className = 'status-indicator completed';
                } else if (nowSimulated.getUTCDate() === 23 && nowSimulated.getUTCFullYear() === SIMULATION_YEAR && nowSimulated.getUTCMonth() === SIMULATION_MONTH_JS) {
                     dashboardR1Indicator.textContent = "In Progress / Concluded"; 
                     dashboardR1Indicator.className = 'status-indicator active'; // Or 'completed' if past 17:00 CEST
                     if(currentSimulatedHourCEST >= 17) {
                        dashboardR1Indicator.textContent = "Concluded";
                        dashboardR1Indicator.className = 'status-indicator completed';
                     }
                } else {
                     dashboardR1Indicator.textContent = "Upcoming";
                     dashboardR1Indicator.className = 'status-indicator upcoming';
                }
            }
        }
        
        function updateActivityStatus(activityId, newStatus) {
            activityStatuses[activityId] = newStatus;
            localStorage.setItem('activityStatuses', JSON.stringify(activityStatuses));
            
            document.querySelectorAll(`.timeline-item[data-activity-id="${activityId}"]`).forEach(item => {
                updateActivityStatusUI(item, newStatus);
                const selectElement = item.querySelector('.activity-status-editor select');
                if (selectElement && selectElement.value !== newStatus) {
                    selectElement.value = newStatus;
                }
            });
            showNotification('info', '🔄', `Status of activity "${activityId.replace(/-/g, ' ')}" updated to ${newStatus}.`);
            updateDashboardStats(); 
            checkDeadlinesAndTimeline(); 
        }

        function updateActivityStatusUI(timelineItem, status) {
            timelineItem.classList.remove('upcoming', 'active', 'completed', 'manual-progress', 'manual-upcoming');
            const statusIndicator = timelineItem.querySelector('.time-label .status-indicator');
            let statusText = status.charAt(0).toUpperCase() + status.slice(1);

            if (status === 'active') { timelineItem.classList.add('active'); statusText="In Progress"; }
            else if (status === 'completed') { timelineItem.classList.add('completed'); }
            else if (status === 'upcoming') { timelineItem.classList.add('upcoming'); }
            
            if (statusIndicator) {
                statusIndicator.textContent = statusText;
                statusIndicator.className = `status-indicator ${status}`;
            }
        }

        function copyToClipboard(button) { 
            const textElement = button.nextElementSibling;
            if (textElement && textElement.textContent) {
                navigator.clipboard.writeText(textElement.textContent.trim())
                    .then(() => {
                        const originalText = button.textContent;
                        button.textContent = '✓ Copied!';
                        button.style.background = 'var(--success-color)';
                        setTimeout(() => {
                            button.textContent = originalText;
                            button.style.background = '#374151';
                        }, 2000);
                    })
                    .catch(err => {
                        console.error('Failed to copy text: ', err);
                        showNotification('danger', '❌', 'Failed to copy text.');
                    });
            }
        }
        function saveNotes(roundKey) { 
            const notesTextarea = document.getElementById(`${roundKey}Notes`);
            if (notesTextarea) {
                roundNotes[roundKey] = notesTextarea.value;
                localStorage.setItem(`${roundKey}Notes`, notesTextarea.value);
                showNotification('success', '💾', `Notes for <strong>${roundKey.replace('round', 'Round ')}</strong> saved.`);
            }
        }
        function checkForUpdates() { 
             showNotification('info', '🔄', 'Checking for portal updates...');
            setTimeout(() => {
                showNotification('success', '✅', 'Portal is up-to-date.');
            }, 1500);
        }
        function showSignalInstructions() { 
            const instructionsDiv = document.getElementById('signalInstructions');
            if (instructionsDiv) {
                const isHidden = instructionsDiv.style.display === 'none' || instructionsDiv.style.display === '';
                instructionsDiv.style.display = isHidden ? 'block' : 'none';
                if (isHidden) instructionsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
         }
        
        function formatICSDate(date) {
            return date.getUTCFullYear() +
                String(date.getUTCMonth() + 1).padStart(2, '0') +
                String(date.getUTCDate()).padStart(2, '0') + 'T' +
                String(date.getUTCHours()).padStart(2, '0') +
                String(date.getUTCMinutes()).padStart(2, '0') +
                String(date.getUTCSeconds()).padStart(2, '0') + 'Z';
        }

        function exportSchedule() {
            const nowSimulated = getSimulatedCESTTime(); // Use simulated year for event dates
            const simYear = nowSimulated.getUTCFullYear();

            let icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//COACH PRO Portal//Malta Dialogue Schedule//EN
CALSCALE:GREGORIAN
`;

            const scheduleEvents = [
                { summary: "Inauguration Session (Webex)", dtstart: new Date(Date.UTC(simYear, 4, 23, 9-2, 0, 0)), dtend: new Date(Date.UTC(simYear, 4, 23, 12-2, 0, 0)), location: "Webex", description: "Expert panels and keynote speeches. Open to public." },
                { summary: "ROUND 1: Info Management & Positioning", dtstart: new Date(Date.UTC(simYear, 4, 23, 13-2, 0, 0)), dtend: new Date(Date.UTC(simYear, 4, 23, 17-2, 0, 0)), location: "Zoom", description: "Full Round 1 activities." },
                { summary: "R1 - Official Opening", dtstart: new Date(Date.UTC(simYear, 4, 23, 14-2, 0, 0)), dtend: new Date(Date.UTC(simYear, 4, 23, 14-2, 20, 0)), location: "Zoom Plenary" },
                { summary: "R1 - Prelim. Position Paper Deadline", dtstart: new Date(Date.UTC(simYear, 4, 23, 15-2, 15, 0)), dtend: new Date(Date.UTC(simYear, 4, 23, 15-2, 15, 0)), location: "Google Drive", description: "Deadline for Preliminary Position Paper." },
                { summary: "R1 - Final Position Paper Deadline", dtstart: new Date(Date.UTC(simYear, 4, 23, 17-2, 0, 0)), dtend: new Date(Date.UTC(simYear, 4, 23, 17-2, 0, 0)), location: "Google Drive", description: "Deadline for Final Updated Position Paper." },
                
                { summary: "ROUND 2: Strategic Negotiation & Drafting", dtstart: new Date(Date.UTC(simYear, 4, 24, 9-2, 0, 0)), dtend: new Date(Date.UTC(simYear, 4, 24, 12-2, 0, 0)), location: "Zoom", description: "Full Round 2 activities." },
                { summary: "R2 - Amendment Proposals Deadline", dtstart: new Date(Date.UTC(simYear, 4, 24, 12-2, 0, 0)), dtend: new Date(Date.UTC(simYear, 4, 24, 12-2, 0, 0)), location: "Google Drive", description: "Deadline for Final Amendment Proposals." },

                { summary: "ROUND 3: Public Communication", dtstart: new Date(Date.UTC(simYear, 4, 24, 13-0, 0)), dtend: new Date(Date.UTC(simYear, 4, 24, 16-2, 0, 0)), location: "Zoom", description: "Full Round 3 activities." },
                { summary: "R3 - Written Statement Deadline", dtstart: new Date(Date.UTC(simYear, 4, 24, 14-2, 0, 0)), dtend: new Date(Date.UTC(simYear, 4, 24, 14-2, 0, 0)), location: "Google Drive", description: "Deadline for Final Written Statement." },
                
                { summary: "Closing Ceremony and Awards (Webex)", dtstart: new Date(Date.UTC(simYear, 4, 24, 16-2, 30, 0)), dtend: new Date(Date.UTC(simYear, 4, 24, 17-2, 0, 0)), location: "Webex", description: "Delivery of excellence certificates and closing remarks." }
            ];

            scheduleEvents.forEach(event => {
                icsContent += `BEGIN:VEVENT
UID:${event.dtstart.toISOString()}-${event.summary.replace(/\s/g, '')}@coachpro.portal
DTSTAMP:${formatICSDate(new Date())}
DTSTART:${formatICSDate(event.dtstart)}
DTEND:${formatICSDate(event.dtend)}
SUMMARY:${event.summary}
LOCATION:${event.location || ''}
DESCRIPTION:${event.description || ''}
END:VEVENT
`;
            });

            icsContent += "END:VCALENDAR";

            const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.setAttribute("download", "MaltaDialogue_Schedule.ics");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showNotification('success', '📅', 'Schedule downloaded as MaltaDialogue_Schedule.ics');
        }

        function toggleNotificationPanel() { 
            // This is a placeholder. A real implementation would show/hide a notification list panel.
            if(currentNotificationCount > 0) {
                 alert(`You have ${currentNotificationCount} active notification(s). Check the individual pop-ups.`);
            } else {
                alert('No new notifications.');
            }
        }

    </script>
</body>
</html>
